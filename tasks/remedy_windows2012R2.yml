---
  - name: Include Actualfact
    include: tasks/actualfact_windows2012R2.yml

  - name: Include Database
    include: tasks/before_windows.yml

####REMEDY####

  - name: Fetching the type of server
    win_shell: wmic.exe ComputerSystem get DomainRole | where{$_ -ne ""}
    register: server_type
    tags:
      - always

  - name: 1.1.1 - Fetching the enfpwdhist value from ansible facts
    win_shell: C:\facts\enfpwdhist_111_audit.ps1
    register: enfpwdhist
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enfpwdhist
      - 1.1.1
      - one
      - remedy
      - all

  - name: "1.1.1 - 'Enforce password history' is set to '24 or more password'"
    win_security_policy:
      section: system access
      key: PasswordHistorySize
      value: 24
    when:
      - enfpwdhist.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enfpwdhist
      - 1.1.1
      - one
      - remedy
      - all

  - name: 1.1.2 - Fetching the maxpwdage value from ansible facts
    win_shell: C:\facts\maxpwdage_112_audit.ps1
    register: maxpwdage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - maxpwdage
      - 1.1.2
      - one
      - remedy
      - all

  - name: "1.1.2 - 'Maximum password age' is set to '60 or fewer days, but not 0'"
    win_security_policy:
      section: system access
      key: MaximumPasswordAge
      value: "42"
    when:
      - maxpwdage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - maxpwdage
      - 1.1.2
      - one
      - remedy
      - all

  - name: 1.1.3 - Fetching the minpwdage value from ansible facts
    win_shell: C:\facts\minpwdage_113_audit.ps1
    register: minpwdage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minpwdage
      - 1.1.3
      - one
      - remedy
      - all

  - name: "1.1.3 - 'Minimum password age' is set to '1 or more day(s)'"
    win_security_policy:
      section: system access
      key: MinimumPasswordAge
      value: "1"
    when:
      - minpwdage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minpwdage
      - 1.1.3
      - one
      - remedy
      - all

  - name: 1.1.4 - Fetching the minpwdlen value from ansible facts
    win_shell: C:\facts\minpwdlen_114_audit.ps1
    register: minpwdlen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minpwdlen
      - 1.1.4
      - one
      - remedy
      - all

  - name: "1.1.4 - 'Minimum password length' is set to '14 or more character(s)'"
    win_security_policy:
      section: system access
      key: MinimumPasswordLength
      value: "14"
    when:
      - minpwdlen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minpwdlen
      - 1.1.4
      - one
      - remedy
      - all

  - name: 1.1.5 - Fetching the pwdcomplex value from ansible facts
    win_shell: C:\facts\pwdcomplex_115_audit.ps1
    register: pwdcomplex
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcomplex
      - 1.1.5
      - one
      - remedy
      - all

  - name: "1.1.5 - 'Password must meet complexity requirements' is set to 'Enabled'"
    win_security_policy:
      section: system access
      key: PasswordComplexity
      value: "1"
    when:
      - pwdcomplex.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcomplex
      - 1.1.5
      - one
      - remedy
      - all
      
  - name: 1.1.6 - Fetching the reversepath value from ansible facts
    win_shell: C:\facts\reversepath_116_audit.ps1
    register: reversepath
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - reversepath
      - 1.1.6
      - one
      - remedy
      - all

  - name: "1.1.6 - 'Store passwords using reversible encryption' is set to 'Disabled'"
    win_security_policy:
      section: system access
      key: "ClearTextPassword"
      value: "0"
    when:
      - reversepath.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - reversepath
      - 1.1.6
      - one
      - remedy
      - all

  - name: 1.2.1 - Fetching the acclockdur value from ansible facts
    win_shell: C:\facts\acclockdur_121_audit.ps1
    register: acclockdur
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - acclockdur
      - 1.2.1
      - one
      - remedy
      - all

  - name: "1.2.1 - 'Account lockout duration' is set to '15 or more minute(s)'"
    win_security_policy:
      section: system access
      key: LockoutDuration
      value: "30"
    when:
      - acclockdur.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - acclockdur
      - 1.2.1
      - one
      - remedy
      - all

  - name: 1.2.2 - Fetching the acclockthres value from ansible facts
    win_shell: C:\facts\acclockthres_122_audit.ps1
    register: acclockthres
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - acclockthres
      - 1.2.2
      - one
      - remedy
      - all

  - name: "1.2.2 - 'Account lockout threshold' is set to '10 or fewer invalid logon attempt(s), but not 0'"
    win_security_policy:
      section: system access
      key: LockoutBadCount
      value: "10"
    when:
      - acclockthres.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - acclockthres
      - 1.2.2
      - one
      - remedy
      - all

  - name: 1.2.3 - Fetching the resetacclock value from ansible facts
    win_shell: C:\facts\resetacclock_123_audit.ps1
    register: resetacclock
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - resetacclock
      - 1.2.3
      - one
      - remedy
      - all

  - name: "1.2.3 - 'Reset account lockout counter after' is set to '15 or more minute(s)'"
    win_security_policy:
      section: system access
      key: lockoutwin
      value: "15"
    when:
      - resetacclock.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - resetacclock
      - 1.2.3
      - one
      - remedy
      - all
 
  - name: 2.2.1 Fetching the accesscredmgr value from ansible facts
    win_shell: c:\facts\accesscredmgr_221_audit.ps1
    register: accesscredmgr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - accesscredmgr
      - 2.2.1
      - two
      - remedy
      - all

  - name: "2.2.1 'Access Credential Manager as a trusted caller' is set to 'No One'"
    win_security_policy:
      section: Privilege Rights
      key: SeTrustedCredManAccessPrivilege
      value: ""
    when:
      - accesscredmgr.stdout.find("FAILED") != -1
    tags:
      - accesscredmgr
      - 2.2.1
      - two
      - remedy
      - all

  - name: 2.2.2 Fetching the accesscompdc value from ansible facts
    win_shell: c:\facts\accesscompdc_222_audit.ps1
    register: accesscompdc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - accesscompdc
      - 2.2.2
      - two
      - remedy
      - all

  - name: "2.2.2 'Access this computer from the network' is set to 'Administrators, Authenticated Users, ENTERPRISE DOMAIN CONTROLLERS' (DC only)"
    win_user_right:
       name: SeNetworkLogonRight
       users:
       - Administrators
       - Authenticated Users
       - ENTERPRISE DOMAIN CONTROLLERS
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - accesscompdc.stdout.find("FAILED") != -1
    tags:
      - accesscompdc
      - 2.2.2
      - two
      - remedy
      - all

  - name: 2.2.3 Fetching the accesscompms value from ansible facts
    win_shell: c:\facts\accesscompms_223_audit.ps1
    register: accesscompms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - accesscompms
      - 2.2.3
      - two
      - remedy
      - all

  - name: "2.2.3 'Access this computer from the network' is set to 'Administrators, Authenticated Users' (MS only)"
    win_user_right:
      name: SeNetworkLogonRight
      users:
      - Administrators
      - Authenticated Users
      action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - accesscompms.stdout.find("FAILED") != -1
    tags:
      - accesscompms
      - 2.2.3
      - two
      - remedy
      - all

  - name: 2.2.4 Fetching the actasos value from ansible facts
    win_shell: c:\facts\actasos_224_audit.ps1
    register: actasos
    ignore_errors: True
    tags:
      - actasos
      - 2.2.4
      - two
      - remedy
      - all

  - name: "2.2.4 Ensure 'Act as part of the operating system' is set to 'No One'"
    win_user_right:
       name: SeTcbPrivilege
       users: []
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - actasos
      - 2.2.4
      - two
      - remedy
      - all
 
  - name: 2.2.5 Fetching the addwsdomain value from ansible facts
    win_shell: c:\facts\addwsdomain_225_audit.ps1
    register: addwsdomain
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - addwsdomain
      - 2.2.5
      - two
      - remedy
      - all

  - name: "2.2.5 'Add workstations to domain' is set to 'Administrators' (DC only) "
    win_user_right:
       name: SeMachineAccountPrivilege
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - addwsdomain.stdout.find("FAILED") != -1
    tags:
      - addwsdomain
      - 2.2.5
      - two
      - remedy
      - all

  - name: 2.2.6 - Fetching the memquotaprocess value from ansible facts
    win_shell: c:\facts\memquotaprocess_226_audit.ps1
    register: memquotaprocess
    ignore_errors: True
    tags:
      - memquotaprocess
      - 2.2.6
      - two
      - remedy
      - all

  - name: "2.2.6 - 'Adjust memory quotas for a process' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE'"
    win_user_right:
       name: SeIncreaseQuotaPrivilege
       users:
       - Administrators
       - Local Service
       - Network Service
       action: set
    when:
      - memquotaprocess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - memquotaprocess
      - 2.2.6
      - two
      - remedy
      - all
      
  - name: 2.2.7 - Fetching the cramfs value from ansible facts
    win_shell: c:\facts\allowloglocal_227_audit.ps1
    register: allowloglocal
    ignore_errors: True
    tags:
      - remedy
      - allowloglocal
      - 2.2.7
      - two
      - remedy
      - all

  - name: "2.2.7 - 'Allow log on locally' is set to 'Administrators'"
    win_user_right:
       name: SeInteractiveLogonRight
       users:
       - Administrators
       action: set
    when:
      - allowloglocal.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remedy
      - allowloglocal
      - 2.2.7
      - two
      - remedy
      - all
      
  - name: 2.2.8 - Fetching the allowlogremdeskdc value from ansible facts
    win_shell: c:\facts\allowlogremdeskdc_228_audit.ps1
    register: allowlogremdeskdc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - allowlogremdeskdc
      - 2.2.8
      - two
      - remedy
      - all
       
  - name: "2.2.8 - 'Allow log on through Remote Desktop Services' is set to 'Administrators' (DC only)"
    win_user_right:
       name: SeRemoteInteractiveLogonRight
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - allowlogremdeskdc.stdout.find("FAILED") != -1
    tags:
      - remedy
      - allowlogremdeskdc
      - 2.2.8
      - two
      - all
     
  - name: 2.2.9 - Fetching the allowlogremdeskms value from ansible facts
    win_shell: c:\facts\allowlogremdeskms_229_audit.ps1
    register: allowlogremdeskms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - remedy
      - allowlogremdeskms
      - 2.2.9
      - two
      - all
      
  - name: "2.2.9 - 'Allow log on through Remote Desktop Services' is set to 'Administrators, Remote Desktop Users' (MS only)"
    win_user_right:
       name: SeRemoteInteractiveLogonRight
       users:
       - Administrators
       - Remote Desktop Users
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - allowlogremdeskms.stdout.find("FAILED") != -1
    tags:
      - remedy
      - allowlogremdeskms
      - 2.2.9
      - two
      - remedy
      - all

  - name: 2.2.10 - Fetching the backupfiledirs value from ansible facts
    win_shell: c:\facts\backupfiledirs_2210_audit.ps1
    register: backupfiledirs
    ignore_errors: True
    tags:
      - backupfiledirs
      - 2.2.10
      - two
      - remedy
      - all

  - name: "2.2.10 - 'Back up files and directories' is set to 'Administrators'"
    win_user_right:
       name: SeBackupPrivilege
       users:
       - Administrators
       action: set
    when:
      - backupfiledirs.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - backupfiledirs
      - 2.2.10
      - two
      - remedy
      - all

  - name: 2.2.11 - Fetching the chgsystime value from ansible facts
    win_shell: c:\facts\chgsystime_2211_audit.ps1
    register: chgsystime
    ignore_errors: True
    tags:
      - chgsystime
      - 2.2.11
      - two
      - remedy
      - all

  - name: "2.2.11 -'Change the system time' is set to 'Administrators, LOCAL SERVICE' (Scored)"
    win_user_right:
       name: SeSystemtimePrivilege
       users:
       - Administrators
       - Local Service
       action: set
    when:
      - chgsystime.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - chgsystime
      - 2.2.11
      - two
      - remedy
      - all

  - name: 2.2.12 - Fetching the chgtimezone value from ansible facts
    win_shell: c:\facts\chgtimezone_2212_audit.ps1
    register: chgtimezone
    ignore_errors: True
    tags:
      - chgtimezone
      - 2.2.12
      - two
      - remedy
      - all

  - name: "2.2.12 - 'Change the time zone' is set to 'Administrators, LOCAL SERVICE'"
    win_user_right:
       name: SeTimeZonePrivilege
       users:
       - Administrators
       - Local Service
       action: set
    when:
      - chgtimezone.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - chgtimezone
      - 2.2.12
      - two
      - remedy
      - all

  - name: 2.2.13 - Fetching the pagefile value from ansible facts
    win_shell: c:\facts\pagefile_2213_audit.ps1
    register: pagefile
    ignore_errors: True
    tags:
      - pagefile
      - 2.2.13
      - two
      - remedy
      - all

  - name: "2.2.13 - 'Create a pagefile' is set to 'Administrators'"
    win_user_right:
       name: SeCreatePagefilePrivilege
       users:
       - Administrators
       action: set
    when:
      - pagefile.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pagefile
      - 2.2.13
      - two
      - remedy
      - all

  - name: 2.2.14 - Fetching the tokenobj value from ansible facts
    win_shell: c:\facts\tokenobj_2214_audit.ps1
    register: tokenobj
    ignore_errors: True
    tags:
      - tokenobj
      - 2.2.14
      - two
      - remedy
      - all

  - name: "2.2.14 - 'Create a token object' is set to 'No One' (Scored)"
    win_user_right:
       name: SeCreateTokenPrivilege
       users: []
    when:
      - tokenobj.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tokenobj
      - 2.2.14
      - two
      - remedy
      - all
      
  - name: 2.2.15 Fetching the globalobj value from ansible facts
    win_shell: c:\facts\globalobj_2215_audit.ps1
    register: globalobj
    ignore_errors: True
    tags:
      - globalobj
      - 2.2.15
      - two
      - remedy
      - all

  - name: "2.2.15 'Create global objects' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE' (Scored)"
    win_user_right:
       name: SeCreateGlobalPrivilege
       users:
       - Administrators
       - Local Service
       - Network Service
       - Service
       action: set
    when:
      - globalobj.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - globalobj
      - 2.2.15
      - two
      - remedy
      - all

  - name: 2.2.16 - Fetching the permsharedobj value from ansible facts
    win_shell: c:\facts\permsharedobj_2216_audit.ps1
    register: permsharedobj
    ignore_errors: True
    tags:
      - permsharedobj
      - 2.2.16
      - two
      - remedy
      - all

  - name: "2.2.16 - 'Create permanent shared objects' is set to 'No One'"
    win_user_right:
       name: SeCreateGlobalPrivilege
       users: []
    when:
      - permsharedobj.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - permsharedobj
      - 2.2.16
      - two
      - remedy
      - all
 
  - name: 2.2.17 Fetching the symboliclinksdc value from ansible facts
    win_shell: c:\facts\symboliclinksdc_2217_audit.ps1
    register: symboliclinksdc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - symboliclinksdc
      - 2.2.17
      - two
      - remedy
      - all

  - name: "2.2.17 'Create symbolic links' is set to 'Administrators' (DC only)"
    win_user_right:
       name: SeCreateSymbolicLinkPrivilege
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - symboliclinksdc.stdout.find("FAILED") != -1
    tags:
      - symboliclinksdc
      - 2.2.17
      - two
      - remedy
      - all
      
  - name: 2.2.18 - Fetching the symboliclinksms value from ansible facts
    win_shell: c:\facts\sysboliclinksms_2218_audit.ps1
    register: sysboliclinksms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - sysboliclinksms
      - 2.2.18
      - two
      - remedy
      - all

  - name: "2.2.18 - 'Create symbolic links' is set to 'Administrators, NT VIRTUAL MACHINE or Virtual Machines' (MS only)"
    win_user_right:
       name: SeCreateSymbolicLinkPrivilege
       users:
       - Administrators
##       - NT Virtual Machines/Virtual Machines  ###when the Hyper-V Role is installed###
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - sysboliclinksms.stdout.find("FAILED") != -1
    tags:
      - sysboliclinksms
      - 2.2.18
      - two
      - remedy
      - all

  - name: 2.2.19 - Fetching the debugprog value from ansible facts
    win_shell: c:\facts\debugprog_2219_audit.ps1
    register: debugprog
    ignore_errors: True
    tags:
      - debugprog
      - 2.2.19
      - two
      - remedy
      - all

  - name: "2.2.19 - 'Debug programs' is set to 'Administrators'"
    win_user_right:
       name: SeDebugPrivilege
       users:
       - Administrators
       action: set
    when:
      - debugprog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - debugprog
      - 2.2.19
      - two
      - remedy
      - all

#  - name: "2.2.20 Fetching the denyaccessdc value from ansible facts"
#    win_shell: c:\facts\denyaccessdc_2220_audit.ps1
#    register: denyaccessdc
#    ignore_errors: True
#    when:
#      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
#    tags:
#      - denyaccessdc
#      - 2.2.20
#      - two
#      - remedy
#      - all
      
#  - name: "2.2.20 'Deny access to this computer from the network' to include 'Guests' (DC only)"
#    win_user_right:
#       name: SeDenyNetworkLogonRight
#       users:
#       - Guests
#       action: set
#    when:
#      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
#      - denyaccessdc.stdout.find("FAILED") != -1
#    tags:
#      - denyaccessdc
#      - 2.2.20
#      - two
#      - remedy
#      - all
      
#  - name: "2.2.21 - Fetching the denyaccessms value from ansible facts
#    win_shell: c:\facts\denyaccessms.ps1
#    register: denyaccessms
#    ignore_errors: True
#      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
#    tags:
#      - denyaccessms
#      - 2.2.21
#      - two
#      - remedy
#      - all
      
#  - name: "2.2.21 - 'Deny access to this computer from the network' is set to 'Guests, Local account and member of Administrators group' (MS only)"
#    win_user_right:
#       name: SeDenyNetworkLogonRight
#       users:
#       - Guests
#       - Local account
#       - Administrators group
#       action: set
#     when:
#      - denyaccessms.stdout.find("FAILED") != -1
#      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
#    tags:
#      - denyaccessms
#      - 2.2.21
#      - two
#      - remedy
#      - all
      
  - name: 2.2.22 Fetching the denylogbatchjob value from ansible facts
    win_shell: c:\facts\denylogbatchjob_2222_audit.ps1
    register: denylogbatchjob
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - denylogbatchjob
      - 2.2.22
      - two
      - remedy
      - all
      
  - name: "2.2.22 Ensure 'Deny log on as a batch job' to include 'Guests'"
    win_user_right:
       name: SeDenyBatchLogonRight
       users:
       - Guests
       action: set
    when:
      - denylogbatchjob.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - denylogbatchjob
      - 2.2.22
      - two
      - remedy
      - all
      
  - name: 2.2.23 Fetching the denylogservice value from ansible facts
    win_shell: c:\facts\denylogservice_2223_audit.ps1
    register: denylogservice
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - denylogservice
      - 2.2.23
      - two
      - remedy
      - all
      
  - name: "2.2.23 'Deny log on as a service' to include 'Guests'"
    win_user_right:
       name: SeDenyServiceLogonRight
       users:
       - Guests
       action: set
    when:
      - denylogservice.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - denylogservice
      - 2.2.23
      - two
      - remedy
      - all
      
  - name: 2.2.24 Fetching the denyloglocally value from ansible facts
    win_shell: c:\facts\denyloglocally_2224_audit.ps1
    register: denyloglocally
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - denyloglocally
      - 2.2.24
      - two
      - remedy
      - all
      
  - name: 2.2.24 'Deny log on locally' to include 'Guests'
    win_user_right:
       name: SeDenyInteractiveLogonRight
       users:
       - Guests
       action: set
    when:
      - denyloglocally.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - denyloglocally
      - 2.2.24
      - two
      - remedy
      - all
      
#  - name: "2.2.25 Fetching the denylogremdeskdc value from ansible facts
#    win_shell: c:\facts\denylogremdeskdc_2225_audit.ps1
#    register: denylogremdeskdc
#    ignore_errors: True
#    when:
#      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
#    tags:
#      - denylogremdeskdc
#      - 2.2.25
#      - two
#      - remedy
#      - all
      
#  - name: "2.2.25 'Deny log on through Remote Desktop Services' is set to 'Guests' (DC only)"
#    win_user_right:
#       name: SeDenyRemoteInteractiveLogonRight
#       users:
#       - Guests
#       action: set
#    when:
#      - denylogremdeskdc.stdout.find("FAILED") != -1
#      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
#    tags:
#      - denylogremdeskdc
#      - 2.2.25
#      - two
#      - remedy
#      - all
      
#  - name: "2.2.26 Fetching the denylogremdeskms value from ansible facts
#    win_shell: c:\facts\denylogremdeskms_2226_audit.ps1
#    register: denylogremdeskms
#    ignore_errors: True
#     when:
#      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
#    tags:
#      - denylogremdeskms
#      - 2.2.26
#      - two
#      - remedy
#      - all
      
#  - name: "2.2.26 'Deny log on through Remote Desktop Services' is set to 'Guests, Local account' (MS only)"
#    win_user_right:
#       name: SeDenyRemoteInteractiveLogonRight
#       users:
#       - Guests
#       - Local account
#       action: set
#    when:
#      - denylogremdeskms.stdout.find("FAILED") != -1
#      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
#    tags:
#      - denylogremdeskms
#      - 2.2.26
#      - two
#      - remedy
#      - all
   
  - name: 2.2.27 Fetching the enbcompusraccdc value from ansible facts
    win_shell: c:\facts\enbcompusraccdc_2227_audit.ps1
    register: enbcompusraccdc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - enbcompusraccdc
      - 2.2.27
      - two
      - remedy
      - all
      
  - name: "2.2.27 'Enable computer and user accounts to be trusted for delegation' is set to 'Administrators' (DC only)"
    win_user_right:
       name: SeEnableDelegationPrivilege
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - enbcompusraccdc.stdout.find("FAILED") != -1
    tags:
      - enbcompusraccdc
      - 2.2.27
      - two
      - remedy
      - all
      
  - name: 2.2.28 Fetching the enbcompusraccms value from ansible facts
    win_shell: c:\facts\enbcompusraccms_2228_audit.ps1
    register: enbcompusraccms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - enbcompusraccms
      - 2.2.28
      - two
      - remedy
      - all     

  - name: "2.2.28 'Enable computer and user accounts to be trusted for delegation is set to No One' (MS only)"
    win_user_right:
       name: SeEnableDelegationPrivilege
       users: []
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - enbcompusraccms.stdout.find("FAILED") != -1
    tags:
      - enbcompusraccms
      - 2.2.28
      - two
      - remedy
      - all
      
  - name: 2.2.29 - Fetching the forceshutdown value from ansible facts
    win_shell: c:\facts\forceshutdown_2229_audit.ps1
    register: forceshutdown
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forceshutdown
      - 2.2.29
      - two
      - remedy
      - all

  - name: "2.2.29 - 'Force shutdown from a remote system' is set to 'Administrators'"
    win_user_right:
       name: SeRemoteShutdownPrivilege
       users:
       - Administrators
       action: set
    when:
      - forceshutdown.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forceshutdown
      - 2.2.29
      - two
      - remedy
      - all

  - name: 2.2.30 - Fetching the securityaudits value from ansible facts
    win_shell: c:\facts\securityaudits_2230_audit.ps1
    register: securityaudits
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securityaudits
      - 2.2.30
      - two
      - remedy
      - all

  - name: "2.2.30 - 'Generate security audits' is set to 'LOCAL SERVICE, NETWORK SERVICE'"
    win_user_right:
       name: SeAuditPrivilege
       users:
       - Local Service
       - Network Service
       action: set
    when:
      - securityaudits.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securityaudits
      - 2.2.30
      - two
      - remedy
      - all

  - name: 2.2.31 - Fetching the clientauthendc value from ansible facts
    win_shell: c:\facts\clientauthendc_2231_audit.ps1
    register: clientauthendc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - clientauthendc
      - 2.2.31
      - two
      - remedy
      - all

  - name: "2.2.31 - 'Impersonate a client after authentication' is set to 'Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE' (DC only)"
    win_user_right:
       name: SeImpersonatePrivilege
       users:
       - Local Service
       - Network Service
       - Service
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - clientauthendc.stdout.find("FAILED") != -1
    tags:
      - clientauthendc
      - 2.2.31
      - two
      - remedy
      - all

  - name: 2.2.32 - Fetching the clientauthenms value from ansible facts
    win_shell: c:\facts\clientauthenms_2232_audit.ps1
    register: clientauthenms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - clientauthenms
      - 2.2.32
      - two
      - remedy
      - all

  - name: "2.2.32 - 'Impersonate a client after authentication is set to Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE and (when the Web Server (IIS) Role with Web Services Role Service is installed) IIS_IUSRS' "
    win_user_right:
       name: SeImpersonatePrivilege
       users:
       - Administrators
       - Local Service
       - Network Service
       - Service
       - IIS_IUSRS
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - clientauthenms.stdout.find("FAILED") != -1
    tags:
      - clientauthenms
      - 2.2.32
      - two
      - remedy
      - all

  - name: 2.2.33 - Fetching the incschedprior value from ansible facts
    win_shell: c:\facts\incschedprior_2233_audit.ps1
    register: incschedprior
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - incschedprior
      - 2.2.33
      - two
      - remedy
      - all

  - name: "2.2.33 - 'Increase scheduling priority is set to Administrators' "
    win_user_right:
       name: SeIncreaseBasePriorityPrivilege
       users:
       - Administrators
       action: set
    when:
      - incschedprior.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - incschedprior
      - 2.2.33
      - two
      - remedy
      - all

  - name: 2.2.34 - Fetching the loadunloaddevdriver value from ansible facts
    win_shell: c:\facts\loadunloaddevdriver_2234_audit.ps1
    register: loadunloaddevdriver
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - loadunloaddevdriver
      - 2.2.34
      - two
      - remedy
      - all

  - name: "2.2.34 - 'Load and unload device drivers is set to Administrators'"
    win_user_right:
       name: SeLoadDriverPrivilege
       users:
       - Administrators
       action: set
    when:
      - loadunloaddevdriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - loadunloaddevdriver
      - 2.2.34
      - two
      - remedy
      - all

  - name: 2.2.35 Fetching the lockpagemem value from ansible facts
    win_shell: c:\facts\lockpagemem_2235_audit.ps1
    register: lockpagemem
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - lockpagemem
      - 2.2.35
      - two
      - remedy
      - all

  - name: "2.2.35 Lock pages in memory is set to No One"
    win_user_right:
       name: SeLockMemoryPrivilege
       users: []
    when:
      - lockpagemem.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - lockpagemem
      - 2.2.35
      - two
      - remedy
      - all

  - name: 2.2.36 (L2) - Fetching the logbatchjob value from ansible facts
    win_shell: c:\facts\logbatchjob_2236_audit.ps1
    register: logbatchjob
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - logbatchjob
      - 2.2.36
      - two
      - remedy
      - all

  - name: "2.2.36 (L2) - Log on as a batch job is set to Administrators (DC Only)"
    win_user_right:
       name: SeBatchLogonRight
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - logbatchjob.stdout.find("FAILED") != -1
    tags:
      - logbatchjob
      - 2.2.36
      - two
      - remedy
      - all

  - name: 2.2.37 - Fetching the audsecurlogdc value from ansible facts
    win_shell: c:\facts\audsecurlogdc_2237_audit.ps1
    register: audsecurlogdc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - audsecurlogdc
      - 2.2.37
      - two
      - remedy
      - all
      
  - name: "2.2.37 - Manage auditing and security log is set to Administrators and (when Exchange is running in the environment) Exchange Servers (DC only)"
    win_user_right:
       name: SeSecurityPrivilege
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - audsecurlogdc.stdout.find("FAILED") != -1
    tags:
      - audsecurlogdc
      - 2.2.37
      - two
      - remedy
      - all

  - name: 2.2.38 - Fetching the audsecurlogms value from ansible facts
    win_shell: c:\facts\audsecurlogms_2238_audit.ps1
    register: audsecurlogms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - audsecurlogms
      - 2.2.38
      - two
      - remedy
      - all

  - name: "2.2.38 - Manage auditing and security log is set to Administrators (MS only)"
    win_user_right:
       name: SeSecurityPrivilege
       users:
       - Administrators
       action: set
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - audsecurlogms.stdout.find("FAILED") != -1
    tags:
      - audsecurlogms
      - 2.2.38
      - two
      - remedy
      - all

  - name: 2.2.39 Fetching the modobjlabel value from ansible facts
    win_shell: c:\facts\modobjlabel_2239_audit.ps1
    register: modobjlabel
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - modobjlabel
      - 2.2.39
      - two
      - remedy
      - all

  - name: "2.2.39 Modify an object label is set to No One"
    win_user_right:
       name: SeReLabelPrivilege
       users: []
    when:
      - modobjlabel.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - modobjlabel
      - 2.2.39
      - two
      - remedy
      - all

  - name: 2.2.40 - Fetching the modfirmenv value from ansible facts
    win_shell: c:\facts\modfirmenv_2240_audit.ps1
    register: modfirmenv
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - modfirmenv
      - 2.2.40
      - two
      - remedy
      - all

  - name: "2.2.40 - Modify firmware environment values is set to Administrators"
    win_user_right:
       name: SeSystemEnvironmentPrivilege
       users:
       - Administrators
       action: set
    when:
      - modfirmenv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - modfirmenv
      - 2.2.40
      - two
      - remedy
      - all

  - name: 2.2.41 - Fetching the volmaintasks value from ansible facts
    win_shell: c:\facts\volmaintasks_2241_audit.ps1
    register: volmaintasks
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - volmaintasks
      - 2.2.41
      - two
      - remedy
      - all

  - name: "2.2.41 - Perform volume maintenance tasks is set to Administrators"
    win_user_right:
       name: SeManageVolumePrivilege
       users:
       - Administrators
       action: set
    when:
      - volmaintasks.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - volmaintasks
      - 2.2.41
      - two
      - remedy
      - all

  - name: 2.2.42 - Fetching the profsinglepro value from ansible facts
    win_shell: c:\facts\profsinglepro_2242_audit.ps1
    register: profsinglepro
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - profsinglepro
      - 2.2.42
      - two
      - remedy
      - all

  - name: "2.2.42 - Profile single process is set to Administrators"
    win_user_right:
       name: SeProfileSingleProcessPrivilege
       users:
       - Administrators
       action: set
    when:
      - profsinglepro.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - profsinglepro
      - 2.2.42
      - two
      - remedy
      - all

  - name: 2.2.43 - Fetching the profsysperf value from ansible facts
    win_shell: c:\facts\profsysperf_2243_audit.ps1
    register: profsysperf
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - profsysperf
      - 2.2.43
      - two
      - remedy
      - all

  - name: "2.2.43 - Profile system performance is set to Administrators, NT SERVICE or WdiServiceHost"
    win_user_right:
       name: SeSystemProfilePrivilege
       users:
       - Administrators
       - NT SERVICE\WdiServiceHost
       action: set
    when:
      - profsysperf.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - profsysperf
      - 2.2.43
      - two
      - remedy
      - all

  - name: 2.2.44 - Fetching the replprotoken value from ansible facts
    win_shell: c:\facts\replprotoken_2244_audit.ps1
    register: replprotoken
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - replprotoken
      - 2.2.44
      - two
      - remedy
      - all

  - name: "2.2.44 - Replace a process level token is set to LOCAL SERVICE, NETWORK SERVICE"
    win_user_right:
       name: SeAssignPrimaryTokenPrivilege
       users:
       - LOCAL SERVICE
       - NETWORK SERVICE
       action: set
    when:
      - replprotoken.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - replprotoken
      - 2.2.44
      - two
      - remedy
      - all

  - name: 2.2.45 - Fetching the restorefiledirs value from ansible facts
    win_shell: c:\facts\restorefiledirs_2245_audit.ps1
    register: restorefiledirs
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restorefiledirs
      - 2.2.45
      - two
      - remedy
      - all

  - name: "2.2.45 - Restore files and directories is set to Administrators"
    win_user_right:
       name: SeRestorePrivilege
       users:
       - Administrators
       action: set
    when:
      - restorefiledirs.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restorefiledirs
      - 2.2.45
      - two
      - remedy
      - all


  - name: 2.2.46 - Fetching the shutdownsys value from ansible facts
    win_shell: c:\facts\shutdownsys_2246_audit.ps1
    register: shutdownsys
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - shutdownsys
      - 2.2.46
      - two
      - remedy
      - all

  - name: "2.2.46 - Shut down the system is set to Administrators"
    win_user_right:
       name: SeShutdownPrivilege
       users:
       - Administrators
       action: set
    when:
      - shutdownsys.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - shutdownsys
      - 2.2.46
      - two
      - remedy
      - all

  - name: 2.2.47 Fetching the syncdirserdata value from ansible facts
    win_shell: c:\facts\syncdirserdata_2247_audit.ps1
    register: syncdirserdata
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - syncdirserdata
      - 2.2.47
      - two
      - remedy
      - all

  - name: "2.2.47 Synchronize directory service data is set to No One (DC only)"
    win_user_right:
       name: SeSyncAgentPrivilege
       users: []
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - syncdirserdata.stdout.find("FAILED") != -1
    tags:
      - syncdirserdata
      - 2.2.47
      - two
      - remedy
      - all

  - name: 2.2.48 - Fetching the ownershipfile value from ansible facts
    win_shell: c:\facts\ownershipfile_2248_audit.ps1
    register: ownershipfile
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ownershipfile
      - 2.2.48
      - two
      - remedy
      - all

  - name: "2.2.48 - Take ownership of files or other objects is set to Administrators"
    win_user_right:
       name: SeTakeOwnershipPrivilege
       users:
       - Administrators
       action: set
    when:
      - ownershipfile.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ownershipfile
      - 2.2.48
      - two
      - remedy
      - all

  - name: 2.3.1.1 - Fetching the admaccstat value from ansible facts
    win_shell: c:\facts\admaccstat_2311_audit.ps1
    register: admaccstat
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - admaccstat
      - 2.3.1.1
      - two
      - remedy
      - all

  - name: "2.3.1.1 - Accounts: Administrator account status is set to Disabled"
    win_security_policy:
       section: System Access
       key: EnableAdminAccount
       value: 0
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - admaccstat.stdout.find("FAILED") != -1
    tags:
      - admaccstat
      - 2.3.1.1
      - two
      - remedy
      - all

  - name: 2.3.1.2 - Fetching the blockmsacc value from ansible facts
    win_shell: c:\facts\blockmsacc_2312_audit.ps1
    register: blockmsacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - blockmsacc
      - 2.3.1.2
      - two
      - remedy
      - all

  - name: "2.3.1.2 - Accounts: Block Microsoft accounts is set to Users cant add or log on with Microsoft accounts"
    win_regedit:
       path: HKLM:\Software\Microsoft\Windows\Currentversion\Policies\System
       name: "NoConnectedUser"
       data: "3"
       type: dword
    when:
      - blockmsacc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - blockmsacc
      - 2.3.1.2
      - two
      - remedy
      - all

  - name: 2.3.1.3 Fetching the guestaccstat value from ansible facts
    win_shell: c:\facts\guestaccstat_2313_audit.ps1
    register: guestaccstat
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - guestaccstat
      - 2.3.1.3
      - two
      - remedy
      - all

  - name: "2.3.1.3 Accounts: Guest account status is set to Disabled"
    win_security_policy:
       section: System Access
       key: EnableGuestAccount
       value: 0
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - guestaccstat.stdout.find("FAILED") != -1
    tags:
      - guestaccstat
      - 2.3.1.3
      - two
      - remedy
      - all

  - name: 2.3.1.4 - Fetching the limitlocaccuse value from ansible facts
    win_shell: c:\facts\limitlocaccuse_2314_audit.ps1
    register: limitlocaccuse
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - limitlocaccuse
      - 2.3.1.4
      - two
      - remedy
      - all

  - name: "2.3.1.4 - Accounts: Limit local account use of blank passwords to console logon only is set to Enabled"
    win_regedit:
       path: HKLM:\System\Currentcontrolset\Control\Lsa
       name: "LimitBlankPasswordUse"
       data: "1"
       type: dword
    when:
      - limitlocaccuse.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - limitlocaccuse
      - 2.3.1.4
      - two
      - remedy
      - all

  - name: 2.3.1.5 - Fetching the renameadmacc value from ansible facts
    win_shell: c:\facts\renameadmacc_2315_audit.ps1
    register: renameadmacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - renameadmacc
      - 2.3.1.5
      - two
      - remedy
      - all

  - name: "2.3.1.5 - Configure Accounts: Rename administrator account"
    win_security_policy:
       section: System Access
       key: NewAdministratorName
       value: NewAdmin
    when:
      - renameadmacc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - renameadmacc
      - 2.3.1.5
      - two
      - remedy
      - all

  - name: 2.3.1.6 - Fetching the renameguestacc value from ansible facts
    win_shell: c:\facts\renameguestacc_2316_audit.ps1
    register: renameguestacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - renameguestacc
      - 2.3.1.6
      - two
      - remedy
      - all

  - name: "2.3.1.6 - Configure Accounts: Rename guest account"
    win_security_policy:
       section: System Access
       key: NewGuestName
       value: NewGuest
    when:
      - renameguestacc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - renameguestacc
      - 2.3.1.6
      - two
      - remedy
      - all

  - name: 2.3.2.1 - Fetching the forceaudpolicy value from ansible facts
    win_shell: c:\facts\forceaudpolicy_2321_audit.ps1
    register: forceaudpolicy
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forceaudpolicy
      - 2.3.2.1
      - two
      - remedy
      - all

  - name: "2.3.2.1 - Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings is set to Enabled"
    win_regedit:
       path: HKLM:\System\Currentcontrolset\Control\Lsa
       name: "SCENoApplyLegacyAuditPolicy"
       data: "1"
       type: dword
    when:
      - forceaudpolicy.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forceaudpolicy
      - 2.3.2.1
      - two
      - remedy
      - all

  - name: 2.3.2.2 - Fetching the sysshutdownsecuraud value from ansible facts
    win_shell: c:\facts\sysshutdownsecuraud_2322_audit.ps1
    register: sysshutdownsecuraud
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sysshutdownsecuraud
      - 2.3.2.2
      - two
      - remedy
      - all

  - name: 2.3.2.2 - 'Audit Shut down system immediately if unable to log security audits' is set to 'Disabled'"
    win_regedit:
       path: HKLM:\System\Currentcontrolset\Control\Lsa
       name: "CrashOnAuditFail"
       data: "0"
       type: dword
    when:
      - sysshutdownsecuraud.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sysshutdownsecuraud
      - 2.3.2.2
      - two
      - remedy
      - all

  - name: 2.3.4.1 - Fetching the allowremovmedia value from ansible facts
    win_shell: c:\facts\allowremovmedia_2341_audit.ps1
    register: allowremovmedia
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremovmedia
      - 2.3.4.1
      - two
      - remedy
      - all

  - name: "2.3.4.1 - 'Devices: Allowed to format and eject removable media' is set to 'Administrators'"
    win_regedit:
       path: HKLM:\Software\Microsoft\Windows Nt\Currentversion\Winlogon
       name: "AllocateDASD"
       data: "0"
       type: string
    when:
      - allowremovmedia.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remedy
      - allowremovmedia
      - 2.3.4.1
      - two
      - remedy
      - all

  - name: 2.3.4.2 - Fetching the preventusr value from ansible facts
    win_shell: c:\facts\preventusr_2342_audit.ps1
    register: preventusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventusr
      - 2.3.4.2
      - two
      - remedy
      - all

  - name: "2.3.4.2 - 'Devices: Prevent users from installing printer drivers' is set to 'Enabled'"
    win_regedit:
       path: HKLM:\System\Currentcontrolset\Control\Print\Providers\Lanman Print Services\Servers
       name: "AddPrinterDrivers"
       data: "1"
       type: dword
    when:
      - preventusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventusr
      - 2.3.4.2
      - two
      - remedy
      - all
      
  - name: 2.3.5.1 Fetching the allowservschedtask value from ansible facts
    win_shell: c:\facts\allowservschedtask_2351_audit.ps1
    register: allowservschedtask
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - remedy
      - allowservschedtask
      - 2.3.5.1
      - two
      - remedy
      - all

  - name: "2.3.5.1 'Domain controller: Allow server operators to schedule tasks' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: SubmitControl
      data: 0
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - allowservschedtask.stdout.find("FAILED") != -1
    tags:
      - remedy
      - allowservschedtask
      - 2.3.5.1
      - two
      - remedy
      - all

  - name: 2.3.5.2 Fetching the ldapservsign value from ansible facts
    win_shell: c:\facts\ldapservsign_2352_audit.ps1
    register: ldapservsign
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - ldapservsign
      - 2.3.5.2
      - two
      - remedy
      - all

  - name: 2.3.5.2 Domain controller LDAP server signing requirements is set to Require signing
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters
      name: LDAPServerIntegrity
      data: 2
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - ldapservsign.stdout.find("FAILED") != -1
    tags:
      - ldapservsign
      - 2.3.5.2
      - two
      - remedy
      - all

  - name: 2.3.5.3 Fetching the refusemachaccpwd value from ansible facts
    win_shell: c:\facts\refusemachaccpwd_2353_audit.ps1
    register: refusemachaccpwd
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - refusemachaccpwd
      - 2.3.5.3
      - two
      - remedy
      - all

  - name: 2.3.5.3 'Domain controller Refuse machine account password changes' is set to 'Disabled'
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      name: RefusePasswordChange
      data: 0
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - refusemachaccpwd.stdout.find("FAILED") != -1
    tags:
      - refusemachaccpwd
      - 2.3.5.3
      - two
      - remedy
      - all

  - name: 2.3.6.1 - Fetching the digiencryptsign value from ansible facts
    win_shell: c:\facts\digiencryptsign_2361_audit.ps1
    register: digiencryptsign
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digiencryptsign
      - 2.3.6.1
      - two
      - remedy
      - all

  - name: "2.3.6.1 - 'Domain member Digitally encrypt or sign secure channel data (always)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      name: RequireSignOrSeal
      data: 1
      type: dword
    when:
      - digiencryptsign.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digiencryptsign
      - 2.3.6.1
      - two
      - remedy
      - all

  - name: 2.3.6.2 - Fetching the digiencrypsecdata value from ansible facts
    win_shell: c:\facts\digiencrypsecdata_2362_audit.ps1
    register: digiencrypsecdata
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digiencrypsecdata
      - 2.3.6.2
      - two
      - remedy
      - all

  - name: "2.3.6.2 - 'Domain member Digitally encrypt secure channel data (when possible)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      name: SealSecureChannel
      data: 1
      type: dword
    when:
      - digiencrypsecdata.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digiencrypsecdata
      - 2.3.6.2
      - two
      - remedy
      - all

  - name: 2.3.6.3 - Fetching the digisignsecdata value from ansible facts
    win_shell: c:\facts\digisignsecdata_2363_audit.ps1
    register: digisignsecdata
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignsecdata
      - 2.3.6.3
      - two
      - remedy
      - all

  - name: "2.3.6.3 - 'Domain member Digitally sign secure channel data (when possible)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      name: SignSecureChannel
      data: 1
      type: dword
    when:
      - digisignsecdata.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignsecdata
      - 2.3.6.3
      - two
      - remedy
      - all

  - name: 2.3.6.4 Fetching the dismachaccpwdchg value from ansible facts
    win_shell: c:\facts\dismachaccpwdchg_2364_audit.ps1
    register: dismachaccpwdchg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dismachaccpwdchg
      - 2.3.6.4
      - two
      - remedy
      - all

  - name: "2.3.6.4 'Domain member Disable machine account password changes' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters
      name: DisablePasswordChange
      data: 0
      type: dword
    when:
      - dismachaccpwdchg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dismachaccpwdchg
      - 2.3.6.4
      - two
      - remedy
      - all

  - name: 2.3.6.5 - Fetching the maxmachaccpwdage value from ansible facts
    win_shell: c:\facts\maxmachaccpwdage_2365_audit.ps1
    register: maxmachaccpwdage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - maxmachaccpwdage
      - 2.3.6.5
      - two
      - remedy
      - all

  - name: "2.3.6.5 - 'Domain member: Maximum machine account password age' is set to '30 or fewer days, but not 0'"
    win_regedit:
      path: HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters
      name: MaximumPasswordAge
      data: 30
      type: dword
    when:
      - maxmachaccpwdage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - maxmachaccpwdage
      - 2.3.6.5
      - two
      - remedy
      - all
    
  - name: 2.3.6.6 - Fetching the reqsessionkey value from ansible facts
    win_shell: c:\facts\reqsessionkey_2366_audit.ps1
    register: reqsessionkey
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - reqsessionkey
      - 2.3.6.6
      - two
      - remedy
      - all

  - name: "2.3.6.6 - 'Domain member: Require strong (Windows 2000 or later) session key' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters
      name: RequireStrongKey
      data: 1
      type: dword
    when:
      - reqsessionkey.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - reqsessionkey
      - 2.3.6.6
      - two
      - remedy
      - all

  - name: 2.3.7.1 Fetching the dontdisplastusrname value from ansible facts
    win_shell: c:\facts\dontdisplastusrname_2371_audit.ps1
    register: dontdisplastusrname
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdisplastusrname
      - 2.3.7.1
      - two
      - remedy
      - all

  - name: "2.3.7.1 'Interactive logon: Do not display last user name' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
      name: DontDisplayLastUserName
      data: 1
      type: dword
    when:
      - dontdisplastusrname.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdisplastusrname
      - 2.3.7.1
      - two
      - remedy
      - all

  - name: 2.3.7.2 - Fetching the dontreqctrlaltdel value from ansible facts
    win_shell: c:\facts\dontreqctrlaltdel_2372_audit.ps1
    register: dontreqctrlaltdel
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontreqctrlaltdel
      - 2.3.7.2
      - two
      - remedy
      - all

  - name: "2.3.7.2 - 'Interactive logon: Do not require CTRL+ALT+DEL' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
      name: DisableCAD
      data: 0
      type: dword
    when:
      - dontreqctrlaltdel.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontreqctrlaltdel
      - 2.3.7.2
      - two
      - remedy
      - all
      
  - name: 2.3.7.3 Fetching the machinactlimit value from ansible facts
    win_shell: c:\facts\machinactlimit_2373_audit.ps1
    register: machinactlimit
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - machinactlimit
      - 2.3.7.3
      - two
      - remedy
      - all

  - name: "2.3.7.3 'Interactive logon: Machine inactivity limit' is set to '900 or fewer second(s), but not 0'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: InactivityTimeoutSecs
      data: 900
      type: dword
    when:
      - machinactlimit.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - machinactlimit
      - 2.3.7.3
      - two
      - remedy
      - all

  - name: 2.3.7.4 - Fetching the msgtextusr value from ansible facts
    win_shell: c:\facts\msgtextusr_2374_audit.ps1
    register: msgtextusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msgtextusr
      - 2.3.7.4
      - two
      - remedy
      - all

  - name: "2.3.7.4 - Configure 'Interactive logon: Message text for users attempting to log on'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: LegalNoticeText
      data: Welcome to windows
      type: expandstring
    when:
      - msgtextusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msgtextusr
      - 2.3.7.4
      - two
      - remedy
      - all

  - name: 2.3.7.5 Fetching the msgtitleusr value from ansible facts
    win_shell: c:\facts\msgtitleusr_2375_audit.ps1
    register: msgtitleusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msgtitleusr
      - 2.3.7.5
      - two
      - remedy
      - all

  - name: "2.3.7.5 Configure 'Interactive logon: Message title for users attempting to log on'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: LegalNoticeCaption
      data: message for user
      type: expandstring
    when:
      - msgtitleusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msgtitleusr
      - 2.3.7.5
      - two
      - remedy
      - all

  - name: 2.3.7.6 (L2) - Fetching the countprevlogons value from ansible facts
    win_shell: c:\facts\countprevlogons_2376_audit.ps1
    register: countprevlogons
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - countprevlogons
      - 2.3.7.6
      - two
      - remedy
      - all

  - name: "2.3.7.6 (L2) - 'Interactive logon: Number of previous logons to cache (in case domain controller is not available)' is set to '4 or fewer logon(s)'"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon
      name: CachedLogonsCount
      data: 4
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - countprevlogons.stdout.find("FAILED") != -1
    tags:
      - countprevlogons
      - 2.3.7.6
      - two
      - remedy
      - all

  - name: 2.3.7.7 - Fetching the promptusrchgpwd value from ansible facts
    win_shell: c:\facts\promptusrchgpwd_2377_audit.ps1
    register: promptusrchgpwd
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - promptusrchgpwd
      - 2.3.7.7
      - two
      - remedy
      - all

  - name: "2.3.7.7 - 'Interactive logon: Prompt user to change password before expiration' is set to 'between 5 and 14 days'"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon
      name: PasswordExpiryWarning
      data: 5
      type: dword
    when:
      - promptusrchgpwd.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - promptusrchgpwd
      - 2.3.7.7
      - two
      - remedy
      - all

  - name: 2.3.7.8 - Fetching the dcauthenunlockws value from ansible facts
    win_shell: c:\facts\dcauthenunlockws_2378_audit.ps1
    register: dcauthenunlockws
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - dcauthenunlockws
      - 2.3.7.8
      - two
      - remedy
      - all

  - name: "2.3.7.8 - 'Interactive logon: Require Domain Controller Authentication to unlock workstation' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon
      name: ForceUnlockLogon
      data: 1
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - dcauthenunlockws.stdout.find("FAILED") != -1
    tags:
      - dcauthenunlockws
      - 2.3.7.8
      - two
      - remedy
      - all

  - name: 2.3.7.9 - Fetching the smartcardremoval value from ansible facts
    win_shell: c:\facts\smartcardremoval_2379_audit.ps1
    register: smartcardremoval
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - smartcardremoval
      - 2.3.7.9
      - two
      - remedy
      - all

  - name: "2.3.7.9 - 'Interactive logon: Smart card removal behavior' is set to 'Lock Workstation' or higher"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon
      name: ScRemoveOption
      data: 1
      type: string
    when:
      - smartcardremoval.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - smartcardremoval
      - 2.3.7.9
      - two
      - remedy
      - all
      
  - name: 2.3.8.1 Fetching the digisignclient value from ansible facts
    win_shell: c:\facts\digisignclient_2381_audit.ps1
    register: digisignclient
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignclient
      - 2.3.8.1
      - two
      - remedy
      - all

  - name: "2.3.8.1 'Microsoft network client: Digitally sign communications (always)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters
      name: RequireSecuritySignature
      data: 1
      type: dword
    when:
      - digisignclient.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignclient
      - 2.3.8.1
      - two
      - remedy
      - all

  - name: 2.3.8.2 Fetching the digisignservagree value from ansible facts
    win_shell: c:\facts\digisignservagree_2382_audit.ps1
    register: digisignservagree
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignservagree
      - 2.3.8.2
      - two
      - remedy
      - all

  - name: "2.3.8.2 'Microsoft network client: Digitally sign communications (if server agrees)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters
      name: EnableSecuritySignature
      data: 1
      type: dword
    when:
      - digisignservagree.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignservagree
      - 2.3.8.2
      - two
      - remedy
      - all

  - name: 2.3.8.3 - Fetching the sendunencryppwd value from ansible facts
    win_shell: c:\facts\sendunencryppwd_2383_audit.ps1
    register: sendunencryppwd
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sendunencryppwd
      - 2.3.8.3
      - two
      - remedy
      - all

  - name: "2.3.8.3 - 'Microsoft network client: Send unencrypted password to third-party SMB servers' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\System\CurrentControlSet\Services\LanmanWorkstation\Parameters
      name: EnablePlainTextPassword
      data: 0
      type: dword
    when:
      - sendunencryppwd.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sendunencryppwd
      - 2.3.8.3
      - two
      - remedy
      - all

  - name: 2.3.9.1 - Fetching the setidletime value from ansible facts
    win_shell: c:\facts\setidletime_2391_audit.ps1
    register: setidletime
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setidletime
      - 2.3.9.1
      - two
      - remedy
      - all

  - name: "2.3.9.1 - Ensure 'Microsoft network server: Amount of idle time required before suspending session' is set to '15 or fewer minute(s), but not 0'"
    win_regedit:
      path: HKLM:\System\Currentcontrolset\Services\Lanmanserver\Parameters
      name: AutoDisconnect
      data: 15
      type: dword
    when:
      - setidletime.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setidletime
      - 2.3.9.1
      - two
      - remedy
      - all

  - name: 2.3.9.2 - Fetching the digisignserv value from ansible facts
    win_shell: c:\facts\digisignserv_2392_audit.ps1
    register: digisignserv
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignserv
      - 2.3.9.2
      - two
      - remedy
      - all

  - name: "2.3.9.2 - 'Microsoft network server: Digitally sign communications (always)' is set to 'Enabled' "
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: RequireSecuritySignature
      data: 1
      type: dword
    when:
      - digisignserv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisignserv
      - 2.3.9.2
      - two
      - remedy
      - all

  - name: 2.3.9.3 - Fetching the digisigncliagree value from ansible facts
    win_shell: c:\facts\digisigncliagree_2393_audit
    register: digisigncliagree
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisigncliagree
      - 2.3.9.3
      - two
      - remedy
      - all

  - name: "2.3.9.3 - Ensure 'Microsoft network server: Digitally sign communications (if client agrees)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: EnableSecuritySignature
      data: 1
      type: dword
    when:
      - digisigncliagree.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - digisigncliagree
      - 2.3.9.3
      - two
      - remedy
      - all

  - name: 2.3.9.4 - Fetching the disconclilogonhrexp value from ansible facts
    win_shell: c:\facts\disconclilogonhrexp_2394_audit.ps1
    register: disconclilogonhrexp
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disconclilogonhrexp
      - 2.3.9.4
      - two
      - remedy
      - all

  - name: "2.3.9.4 - 'Microsoft network server: Disconnect clients when logon hours expire' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: enableforcedlogoff
      data: 1
      type: dword
    when:
      - disconclilogonhrexp.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disconclilogonhrexp
      - 2.3.9.4
      - two
      - remedy
      - all

  - name: 2.3.9.5 - Fetching the spnnamevalidation value from ansible facts
    win_shell: c:\facts\spnnamevalidation_2395_audit.ps1
    register: spnnamevalidation
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - spnnamevalidation
      - 2.3.9.5
      - two
      - remedy
      - all

  - name: "2.3.9.5 - Microsoft network server: Server SPN target name validation level is set to Accept if provided by client or higher"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: SMBServerNameHardeningLevel
      data: 1
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - spnnamevalidation.stdout.find("FAILED") != -1
    tags:
      - spnnamevalidation
      - 2.3.9.5
      - two
      - remedy
      - all

  - name: 2.3.10.1 Fetching the allowanonysid value from ansible facts
    win_shell: c:\facts\allowanonysid_23101_audit.ps1
    register: allowanonysid
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remedy
      - allowanonysid
      - 2.3.10.1
      - two
      - remedy
      - all

  - name: "2.3.10.1 Network access: Allow anonymous SID/Name translation is set to Disabled"
    win_security_policy:
      section: System Access
      key: LSAAnonymousNameLookup
      value: 0
    when:
      - allowanonysid.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowanonysid
      - 2.3.10.1
      - two
      - remedy
      - all

  - name: 2.3.10.2 Fetching the dontallowanonysamacc value from ansible facts
    win_shell: c:\facts\dontallowanonysamacc_23102_audit.ps1
    register: dontallowanonysamacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - dontallowanonysamacc
      - 2.3.10.2
      - two
      - remedy
      - all

  - name: "2.3.10.2 Network access: Do not allow anonymous enumeration of SAM accounts is set to Enabled"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: RestrictAnonymousSAM
      data: 1
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - dontallowanonysamacc.stdout.find("FAILED") != -1
    tags:
      - dontallowanonysamacc
      - 2.3.10.2
      - two
      - remedy
      - all

  - name: 2.3.10.3 Fetching the dontallowanonysamaccshares value from ansible facts
    win_shell: c:\facts\dontallowanonysamaccshares_23103_audit.ps1
    register: dontallowanonysamaccshares
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - dontallowanonysamaccshares
      - 2.3.10.3
      - two
      - remedy
      - all

  - name: "2.3.10.3 Network access: Do not allow anonymous enumeration of SAM accounts and shares is set to Enabled"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: RestrictAnonymous
      data: 1
      type: dword
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - dontallowanonysamaccshares.stdout.find("FAILED") != -1
    tags:
      - dontallowanonysamaccshares
      - 2.3.10.3
      - two
      - remedy
      - all

  - name: 2.3.10.4 (L2) - Fetching the dontallowstoragepwdcred value from ansible facts
    win_shell: c:\facts\dontallowstoragepwdcred_23104_audit.ps1
    register: dontallowstoragepwdcred
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowstoragepwdcred
      - 2.3.10.4
      - two
      - remedy
      - all

  - name: "2.3.10.4 (L2) - Network access: Do not allow storage of passwords and credentials for network authentication is set to Enabled"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: DisableDomainCreds
      data: 1
      type: dword
    when:
      - dontallowstoragepwdcred.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowstoragepwdcred
      - 2.3.10.4
      - two
      - remedy
      - all

  - name: 2.3.10.5 - Fetching the anonyusrperm value from ansible facts
    win_shell: c:\facts\anonyusrperm_23105_audit.ps1
    register: anonyusrperm
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - anonyusrperm
      - 2.3.10.5
      - two
      - remedy
      - all

  - name: "2.3.10.5 - Network access: Let Everyone permissions apply to anonymous users is set to Disabled"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: EveryoneIncludesAnonymous
      data: 0
      type: dword
    when:
      - anonyusrperm.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - anonyusrperm
      - 2.3.10.5
      - two
      - remedy
      - all

  - name: 2.3.10.6 - Fetching the namedpipesdc value from ansible facts
    win_shell: c:\facts\namedpipesdc_23106_audit.ps1
    register: namedpipesdc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - namedpipesdc
      - 2.3.10.6
      - two
      - remedy
      - all

  - name: "2.3.10.6 - Configure Network access: Named Pipes that can be accessed anonymously (DC only)"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: NullSessionPipes
      data: "LSARPC,NETLOGON,SAMR,BROWSER"
      type: multistring
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - namedpipesdc.stdout.find("FAILED") != -1
    tags:
      - namedpipesdc
      - 2.3.10.6
      - two
      - remedy
      - all 
  
  - name: 2.3.10.7 Fetching the namedpipesms value from ansible facts
    win_shell: c:\facts\namedpipesms_23107_audit.ps1
    register: namedpipesms
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - namedpipesms
      - 2.3.10.7
      - two
      - remedy
      - all

  - name: "2.3.10.7 Configure Network access Named Pipes that can be accessed anonymously"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: NullSessionPipes
      data: "BROWSER"
      type: multistring
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - namedpipesms.stdout.find("FAILED") != -1
    tags:
      - namedpipesms
      - 2.3.10.7
      - two
      - remedy
      - all

  - name: 2.3.10.8 Fetching the remoteaccesregpath value from ansible facts
    win_shell: c:\facts\remoteaccesregpath_23108_audit.ps1
    register: remoteaccesregpath
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remoteaccesregpath
      - 2.3.10.8
      - two
      - remedy
      - all

  - name: 2.3.10.8 Configure 'Network access Remotely accessible registry paths'
    win_regedit:
       path: HKLM:\System\Currentcontrolset\Control\Securepipeservers\Winreg\Allowedexactpaths
       name: Machine
       data: ['System\CurrentControlSet\Control\ProductOptions','System\CurrentControlSet\Control\Server Applications','Software\Microsoft\Windows NT\CurrentVersion']
       type: multistring
    when:
      - remoteaccesregpath.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remoteaccesregpath
      - 2.3.10.8
      - two
      - remedy
      - all

  - name: 2.3.10.9 Fetching the remoteaccesregsubpath value from ansible facts
    win_shell: c:\facts\remoteaccesregsubpath_23109_audit.ps1
    register: remoteaccesregsubpath
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remoteaccesregsubpath
      - 2.3.10.9
      - two
      - remedy
      - all

  - name: "2.3.10.9 Configure Network access Remotely accessible registry paths and sub-paths"
    win_regedit:
      path: HKLM:\System\Currentcontrolset\Control\Securepipeservers\Winreg\Allowedpaths
      name: Machine
      data: ['System\CurrentControlSet\Control\Print\Printers','System\CurrentControlSet\Services\Eventlog','Software\Microsoft\OLAP Server','Software\Microsoft\Windows NT\CurrentVersion\Print','Software\Microsoft\Windows NT\CurrentVersion\Windows','System\CurrentControlSet\Control\ContentIndex','System\CurrentControlSet\Control\Terminal Server','System\CurrentControlSet\Control\Terminal Server\UserConfig','System\CurrentControlSet\Control\Terminal Server\DefaultUserConfiguration','Software\Microsoft\Windows NT\CurrentVersion\Perflib','System\CurrentControlSet\Services\SysmonLog']
      type: multistring
    when:
      - remoteaccesregsubpath.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remoteaccesregsubpath
      - 2.3.10.9
      - two
      - remedy
      - all

  - name: 2.3.10.10 - Fetching the restrictanonyacces value from ansible facts
    win_shell: c:\facts\restrictanonyacces_231010_audit.ps1
    register: restrictanonyacces
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restrictanonyacces
      - 2.3.10.10
      - two
      - remedy
      - all

  - name: "2.3.10.10 - Network access Restrict anonymous access to Named Pipes and Shares is set to Enabled"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: RestrictNullSessAccess
      data: 1
      type: dword
    when:
      - restrictanonyacces.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restrictanonyacces
      - 2.3.10.10
      - two
      - remedy
      - all

  - name: 2.3.10.11 - Fetching the sharesaccess value from ansible facts
    win_shell: c:\facts\sharesaccess_231011_audit.ps1
    register: sharesaccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sharesaccess
      - 2.3.10.11
      - two
      - remedy
      - all

  - name: "2.3.10.11 - Network access Shares that can be accessed anonymously is set to None"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters
      name: NullSessionShares
      type: multistring
    when:
      - sharesaccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sharesaccess
      - 2.3.10.11
      - two
      - remedy
      - all

  - name: 2.3.10.12 Fetching the sharesecurlocalacc value from ansible facts
    win_shell: c:\facts\sharesecurlocalacc_231012_audit.ps1
    register: sharesecurlocalacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sharesecurlocalacc
      - 2.3.10.12
      - two
      - remedy
      - all

  - name: "2.3.10.12 Network access Sharing and security model for local accounts is set to Classic - local users authenticate as themselves"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: ForceGuest
      data: 0
      type: dword
    when:
      - sharesecurlocalacc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sharesecurlocalacc
      - 2.3.10.12
      - two
      - remedy
      - all

  - name: 2.3.11.1 - Fetching the allowlocalsys value from ansible facts 
    win_shell: c:\facts\allowlocalsys_23111_audit.ps1
    register: allowlocalsys
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowlocalsys
      - 2.3.11.1
      - two
      - remedy
      - all

  - name: "2.3.11.1 - 'Network security Allow Local System to use computer identity for NTLM' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: UseMachineId
      data: 1
      type: dword
    when:
      - allowlocalsys.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowlocalsys
      - 2.3.11.1
      - two
      - remedy
      - all

  - name: 2.3.11.2 Fetching the allowlocalsysnull value from ansible facts
    win_shell: c:\facts\allowlocalsysnull_23112_audit.ps1
    register: allowlocalsysnull
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowlocalsysnull
      - 2.3.11.2
      - two
      - remedy
      - all

  - name: "2.3.11.2 'Network security Allow LocalSystem NULL session fallback' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0
      name: AllowNullSessionFallback
      data: 0
      type: dword
    when:
      - allowlocalsysnull.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowlocalsysnull
      - 2.3.11.2
      - two
      - remedy
      - all

  - name: 2.3.11.3 Fetching the allowpku2uauthen value from ansible facts
    win_shell: c:\facts\allowpku2uauthen_23113_audit.ps1
    register: allowpku2uauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowpku2uauthen
      - 2.3.11.3
      - two
      - remedy
      - all

  - name: "2.3.11.3 'Network Security Allow PKU2U authentication requests to this computer to use online identities' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\pku2u
      name: AllowOnlineID
      data: 0
      type: dword
    when:
      - allowpku2uauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowpku2uauthen
      - 2.3.11.3
      - two
      - remedy
      - all

  - name: 2.3.11.4 Fetching the kerberosencryp value from ansible facts
    win_shell: c:\facts\kerberosencryp_23114_audit.ps1
    register: kerberosencryp
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - kerberosencryp
      - 2.3.11.4
      - two
      - remedy
      - all

  - name: "2.3.11.4 'Network security Configure encryption types allowed for Kerberos' is set to 'AES128_HMAC_SHA1,AES256_HMAC_SHA1, Future encryption types'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters
      name: SupportedEncryptionTypes
      data: 0x7ffffff8
      type: dword
    when:
      - kerberosencryp.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - kerberosencryp
      - 2.3.11.4
      - two
      - remedy
      - all

  - name: 2.3.11.5 Fetching the dontstorelanhashval value from ansible facts
    win_shell: c:\facts\dontstorelanhashval_23115_audit.ps1
    register: dontstorelanhashval
    ignore_errors: True
    tags:
      - dontstorelanhashval
      - 2.3.11.5
      - two
      - remedy
      - all

  - name: "2.3.11.5 'Network security Do not store LAN Manager hash value on next password change' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: NoLMHash
      data: 1
      type: dword
    when:
      - dontstorelanhashval.stdout.find("FAILED") != -1
    tags:
      - dontstorelanhashval
      - 2.3.11.5
      - two
      - remedy
      - all

  - name: 2.3.11.6 Fetching the forcelogoff value from ansible facts
    win_shell: c:\facts\forcelogoff_23116_audit.ps1
    register: forcelogoff
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forcelogoff
      - 2.3.11.6
      - two
      - remedy
      - all

  - name: "2.3.11.6 'Network security Force logoff when logon hours expire' is set to 'Enabled'"
    win_security_policy:
      section: System Access
      key: ForceLogoffWhenHourExpire
      value: 1
    when:
      - forcelogoff.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forcelogoff
      - 2.3.11.6
      - two
      - remedy
      - all

  - name: 2.3.11.7 Fetching the lanmgrauthen value from ansible facts
    win_shell: c:\facts\lanmgrauthen_23117_audit.ps1
    register: lanmgrauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - lanmgrauthen
      - 2.3.11.7
      - two
      - remedy
      - all

  - name: "2.3.11.7 'Network security LAN Manager authentication level' is set to 'Send NTLMv2 response only. Refuse LM & NTLM'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa
      name: LmCompatibilityLevel
      data: 5
      type: dword
    when:
      - lanmgrauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - lanmgrauthen
      - 2.3.11.7
      - two
      - remedy
      - all

  - name: 2.3.11.8 Fetching the ldapclisign value from ansible facts
    win_shell: c:\facts\ldapclisign_23118_audit.ps1
    register: ldapclisign
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ldapclisign
      - 2.3.11.8
      - two
      - remedy
      - all

  - name: "2.3.11.8 'Network security LDAP client signing requirements' is set to 'Negotiate signing' or higher"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LDAP
      name: LDAPClientIntegrity
      data: 1
      type: dword
    when:
      - ldapclisign.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ldapclisign
      - 2.3.11.8
      - two
      - remedy
      - all

  - name: 2.3.11.9 Fetching the minsessionsecurcli value from ansible facts
    win_shell: c:\facts\minsessionsecurcli_23119_audit.ps1
    register: minsessionsecurcli
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minsessionsecurcli
      - 2.3.11.9
      - two
      - remedy
      - all

  - name: "2.3.11.9 'Network security Minimum session security for NTLM SSP based (including secure RPC) clients' is set to 'Require NTLMv2 session security, Require 128-bit encryption'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0
      name: NTLMMinClientSec
      data: 537395200
      type: dword
    when:
      - minsessionsecurcli.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minsessionsecurcli
      - 2.3.11.9
      - two
      - remedy
      - all

  - name: 2.3.11.10 Fetching the minsessionsecurserv value from ansible facts
    win_shell: c:\facts\minsessionsecurserv_231110_audit.ps1
    register: minsessionsecurserv
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minsessionsecurserv
      - 2.3.11.10
      - two
      - remedy
      - all

  - name: "2.3.11.10 'Network security Minimum session security for NTLM SSP based (including secure RPC) servers' is set to 'Require NTLMv2 session security, Require 128-bit encryption'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0
      name: NTLMMinServerSec
      data: 537395200
      type: dword
    when:
      - minsessionsecurserv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minsessionsecurserv
      - 2.3.11.10
      - two
      - remedy
      - all

  - name: 2.3.13.1 Fetching the allowsysshutdown value from ansible facts
    win_shell: c:\facts\allowsysshutdown_23131_audit.ps1
    register: allowsysshutdown
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remedy
      - allowsysshutdown
      - 2.3.13.1
      - two
      - remedy
      - all

  - name: "2.3.13.1 'Shutdown Allow system to be shut down without having to log on' is set to 'Disabled'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: ShutdownWithoutLogon
      data: 0
      type: dword
    when:
      - allowsysshutdown.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remedy
      - allowsysshutdown
      - 2.3.13.1
      - two
      - remedy
      - all

  - name: 2.3.15.1 Fetching the caseinsensnonwins value from ansible facts
    win_shell: c:\facts\caseinsensnonwins_23151_audit.ps1
    register: caseinsensnonwins
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - caseinsensnonwins
      - 2.3.15.1
      - two
      - remedy
      - all

  - name: "2.3.15.1 'System objects: Require case insensitivity for nonWindows subsystems' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\SessionManager\Kernel
      name: ObCaseInsensitive
      data: 1
      type: dword
    when:
      - caseinsensnonwins.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - caseinsensnonwins
      - 2.3.15.1
      - two
      - remedy
      - all

  - name: 2.3.15.2 Fetching the strengthdefaultperm value from ansible facts
    win_shell: c:\facts\strengthdefaultperm_23152_audit.ps1
    register: strengthdefaultperm
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - strengthdefaultperm
      - 2.3.15.2
      - two
      - remedy
      - all

  - name: "2.3.15.2 'System objects: Strengthen default permissions of internal system objects (e.g. Symbolic Links)' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Control\SessionManager
      name: ProtectionMode
      data: 1
      type: dword
    when:
      - strengthdefaultperm.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - strengthdefaultperm
      - 2.3.15.2
      - two
      - remedy
      - all

  - name: 2.3.17.1 Fetching the setusraccctrl value from ansible facts
    win_shell: c:\facts\setusraccctrl_23171_audit.ps1
    register: setusraccctrl
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setusraccctrl
      - 2.3.17.1
      - two
      - remedy
      - all

  - name: "2.3.17.1 'User Account Control: Admin Approval Mode for the Built-in Administrator account' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\System
      name: FilterAdministratorToken
      data: 1
      type: dword
    when:
      - setusraccctrl.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setusraccctrl
      - 2.3.17.1
      - two
      - remedy
      - all

  - name: 2.3.17.2 Fetching the elevationpromptadmin value from ansible facts
    win_shell: c:\facts\elevationpromptadmin_23172_audit.ps1
    register: elevationpromptadmin
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevationpromptadmin
      - 2.3.17.2
      - two
      - remedy
      - all

  - name: "2.3.17.2 'User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode' is set to 'Prompt for consent on the secure desktop'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: ConsentPromptBehaviorAdmin
      data: 2
      type: dword
    when:
      - elevationpromptadmin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevationpromptadmin
      - 2.3.17.2
      - two
      - remedy
      - all

  - name: 2.3.17.3 Fetching the elevationpromptusr value from ansible facts
    win_shell: c:\facts\elevationpromptusr_23173_audit.ps1
    register: elevationpromptusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevationpromptusr
      - 2.3.17.3
      - two
      - remedy
      - all

  - name: "2.3.17.3 'User Account Control: Behavior of the elevation prompt for standard users' is set to 'Automatically deny elevation requests'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: ConsentPromptBehaviorUser
      data: 0
      type: dword
    when:
      - elevationpromptusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevationpromptusr
      - 2.3.17.3
      - two
      - remedy
      - all

  - name: 2.3.17.4 Fetching the detectappinstal value from ansible facts
    win_shell: c:\facts\detectappinstal_23174_audit.ps1
    register: detectappinstal
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - detectappinstal
      - 2.3.17.4
      - two
      - remedy
      - all

  - name: "2.3.17.4 'User Account Control: Detect application installations and prompt for elevation' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: EnableInstallerDetection
      data: 1
      type: dword
    when:
      - detectappinstal.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - detectappinstal
      - 2.3.17.4
      - two
      - remedy
      - all

  - name: 2.3.17.5 Fetching the elevateuiaccess value from ansible facts
    win_shell: c:\facts\elevateuiaccess_23175_audit.ps1
    register: elevateuiaccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevateuiaccess
      - 2.3.17.5
      - two
      - remedy
      - all

  - name: "2.3.17.5 'User Account Control: Only elevate UIAccess applications that are installed in secure locations' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: EnableSecureUIAPaths
      data: 1
      type: dword
    when:
      - elevateuiaccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevateuiaccess
      - 2.3.17.5
      - two
      - remedy
      - all

  - name: 2.3.17.6 Fetching the runalladministrator value from ansible facts
    win_shell: c:\facts\runalladministrator_23176_audit.ps1
    register: runalladministrator
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - runalladministrator
      - 2.3.17.6
      - two
      - remedy
      - all

  - name: "2.3.17.6 'User Account Control: Run all administrators in Admin Approval Mode' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: EnableLUA
      data: 1
      type: dword
    when:
      - runalladministrator.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - runalladministrator
      - 2.3.17.6
      - two
      - remedy
      - all

  - name: 2.3.17.7 Fetching the switchsecuredesktop value from ansible facts
    win_shell: c:\facts\switchsecuredesktop_23177_audit.ps1
    register: switchsecuredesktop
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - switchsecuredesktop
      - 2.3.17.7
      - two
      - remedy
      - all

  - name: "2.3.17.7 'User Account Control: Switch to the secure desktop when prompting for elevation' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: PromptOnSecureDesktop
      data: 1
      type: dword
    when:
      - switchsecuredesktop.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - switchsecuredesktop
      - 2.3.17.7
      - two
      - remedy
      - all

  - name: 2.3.17.8 Fetching the virtualizefileregistry value from ansible facts
    win_shell: c:\facts\virtualizefileregistry_23178_audit.ps1
    register: virtualizefileregistry
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - virtualizefileregistry
      - 2.3.17.8
      - two
      - remedy
      - all

  - name: "2.3.17.8 'User Account Control: Virtualize file and registry write failures to per-user locations' is set to 'Enabled'"
    win_regedit:
      path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System
      name: EnableVirtualization
      data: 1
      type: dword
    when:
      - virtualizefileregistry.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - virtualizefileregistry
      - 2.3.17.8
      - two
      - remedy
      - all

  - name: 9.1.1 - Fetching the domainfirewallstate value from ansible facts
    win_shell: c:\facts\domainfirewallstate_911_audit.ps1     
    register: domainfirewallstate
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - domainfirewallstate
      - 9.1.1
      - nine
      - remedy
      - all

  - name: 9.1.1 - 'Windows Firewall Domain Firewall state' is set to 'On (recommended)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile
      name: "EnableFirewall"
      data: "1"
      type: dword
    when:
      - domainfirewallstate.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - domainfirewallstate
      - 9.1.1
      - nine
      - remedy
      - all

  - name: 9.1.2 Fetching the inboundconn value from ansible facts
    win_shell: c:\facts\inboundconn_912_audit.ps1     
    register: inboundconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - inboundconn
      - 9.1.2
      - nine
      - remedy
      - all

  - name: 9.1.2 'Windows Firewall Domain Inbound connections' is set to 'Block (default)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile
      name: "DefaultInboundAction"
      data: "1"
      type: dword
    when:
      - inboundconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - inboundconn
      - 9.1.2
      - nine
      - remedy
      - all

  - name: 9.1.3 Fetching the outboundconn value from ansible facts
    win_shell: c:\facts\outboundconn_913_audit.ps1     
    register: outboundconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - outboundconn
      - 9.1.3
      - nine
      - remedy
      - all

  - name: 9.1.3 'Windows Firewall Domain Outbound connections' is set to 'Allow (default)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile
      name: "DefaultOutboundAction"
      data: "0"
      type: dword
    when:
      - outboundconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - outboundconn
      - 9.1.3
      - nine
      - remedy
      - all

  - name: 9.1.4 - Fetching the disablenotificdisplay value from ansible facts
    win_shell: c:\facts\disablenotificdisplay_914_audit.ps1     
    register: disablenotificdisplay
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disablenotificdisplay
      - 9.1.4
      - nine
      - remedy
      - all

  - name: 9.1.4 - 'Windows Firewall Domain Settings Display a notification' is set to 'No'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile
      name: "DisableNotifications"
      data: "1"
      type: dword
    when:
      - disablenotificdisplay.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disablenotificdisplay
      - 9.1.4
      - nine
      - remedy
      - all

  - name: 9.1.5 - Fetching the loggingname value from ansible facts
    win_shell: c:\facts\loggingname_915_audit.ps1     
    register: loggingname
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - loggingname
      - 9.1.5
      - nine
      - remedy
      - all

  - name: 9.1.5 - 'Windows Firewall Domain Logging Name' is set to '%SYSTEMROOT%\System32\logfiles\firewall\domainfw.log'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging
      name: "LogFilePath"
      data: "%SYSTEMROOT%\\System32\\logfiles\\firewall\\domainfw.log"
      type: string
    when:
      - loggingname.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - loggingname
      - 9.1.5
      - nine
      - remedy
      - all

  - name: 9.1.6 - Fetching the loggingsizelimit value from ansible facts
    win_shell: c:\facts\loggingsizelimit_916_audit.ps1     
    register: loggingsizelimit
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - loggingsizelimit
      - 9.1.6
      - nine
      - remedy
      - all

  - name: 9.1.6 - 'Windows Firewall Domain Logging Size limit (KB)' is set to '16,384 KB or greater'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging
      name: "LogFileSize"
      data: "16384"
      type: dword
    when:
      - loggingsizelimit.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - loggingsizelimit
      - 9.1.6
      - nine
      - remedy
      - all

  - name: 9.1.7 - Fetching the logginglogdroppack value from ansible facts
    win_shell: c:\facts\logginglogdroppack_917_audit.ps1     
    register: logginglogdroppack
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - logginglogdroppack
      - 9.1.7
      - nine
      - remedy
      - all

  - name: 9.1.7 - 'Windows Firewall Domain Logging Log dropped packets' is set to 'Yes'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging
      name: "LogDroppedPackets"
      data: "1"
      type: dword
    when:
      - logginglogdroppack.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - logginglogdroppack
      - 9.1.7
      - nine
      - remedy
      - all

  - name: 9.1.8 - Fetching the logginglogsuccess value from ansible facts
    win_shell: c:\facts\logginglogsuccess_918_audit.ps1     
    register: logginglogsuccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - logginglogsuccess
      - 9.1.8
      - nine
      - remedy
      - all

  - name: 9.1.8 - 'Windows Firewall Domain Logging Log successful connections' is set to 'Yes'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging
      name: "LogSuccessfulConnections"
      data: "1"
      type: dword
    when:
      - logginglogsuccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - logginglogsuccess
      - 9.1.8
      - nine
      - remedy
      - all

  - name: 9.2.1 - Fetching the pvtfirewallstate value from ansible facts
    win_shell: c:\facts\pvtfirewallstate_921_audit.ps1     
    register: pvtfirewallstate
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtfirewallstate
      - 9.2.1
      - nine
      - remedy
      - all
      
  - name: 9.2.1 - 'Windows Firewall Private Firewall state' is set to 'On (recommended)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile
      name: "EnableFirewall"
      data: "1"
      type: dword
    when:
      - pvtfirewallstate.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtfirewallstate
      - 9.2.1
      - nine
      - remedy
      - all

  - name: 9.2.2 - Fetching the pvtinboundconn value from ansible facts
    win_shell: c:\facts\pvtinboundconn_922_audit.ps1     
    register: pvtinboundconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtinboundconn
      - 9.2.2
      - nine
      - remedy
      - all

  - name: 9.2.2 - 'Windows Firewall Private Inbound connections' is set to 'Block (default)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile
      name: "DefaultInboundAction"
      data: "1"
      type: dword
    when:
      - pvtinboundconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtinboundconn
      - 9.2.2
      - nine
      - remedy
      - all

  - name: 9.2.3 - Fetching the pvtinboundconn value from ansible facts
    win_shell: c:\facts\pvtoutboundconn_923_audit.ps1     
    register: pvtoutboundconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtoutboundconn
      - 9.2.3
      - nine
      - remedy
      - all
      
  - name: 9.2.3 - 'Windows Firewall Private Outbound connections' is set to 'Allow (default)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile
      name: "DefaultOutboundAction"
      data: "0"
      type: dword
    when:
      - pvtoutboundconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtoutboundconn
      - 9.2.3
      - nine
      - remedy
      - all

  - name: 9.2.4 - Fetching the pvtdisablenotification value from ansible facts
    win_shell: c:\facts\pvtdisablenotification_924_audit.ps1     
    register: pvtdisablenotification
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtdisablenotification
      - 9.2.4
      - nine
      - remedy
      - all

  - name: 9.2.4 - 'Windows Firewall Private Settings Display a notification' is set to 'No'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile
      name: "DisableNotifications"
      data: "1"
      type: dword
    when:
      - pvtdisablenotification.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtdisablenotification
      - 9.2.4
      - nine
      - remedy
      - all
      
  - name: 9.2.5 - Fetching the pvtloggingname value from ansible facts
    win_shell: c:\facts\pvtloggingname_925_audit.ps1     
    register: pvtloggingname
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtloggingname
      - 9.2.5
      - nine
      - remedy
      - all

  - name: 9.2.5 - 'Windows Firewall Private Logging Name' is set to '%SYSTEMROOT%\System32\logfiles\firewall\Privatefw.log'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging
      name: "LogFilePath"
      data: "%SYSTEMROOT%\\System32\\logfiles\\firewall\\Privatefw.log"
      type: string
    when:
      - pvtloggingname.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtloggingname
      - 9.2.5
      - nine
      - remedy
      - all

  - name: 9.2.6 - Fetching the pvtloggingsizelimit value from ansible facts
    win_shell: c:\facts\pvtloggingsizelimit_926_audit.ps1     
    register: pvtloggingsizelimit
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtloggingsizelimit
      - 9.2.6
      - nine
      - remedy
      - all
      
  - name: 9.2.6 - 'Windows Firewall Private Logging Size limit (KB)' is set to '16,384 KB or greater'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging
      name: "LogFileSize"
      data: "16384"
      type: dword
    when:
      - pvtloggingsizelimit.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtloggingsizelimit
      - 9.2.6
      - nine
      - remedy
      - all

  - name: 9.2.7 - Fetching the pvtlogginglogdroppack value from ansible facts
    win_shell: c:\facts\pvtlogginglogdroppack_927_audit.ps1     
    register: pvtlogginglogdroppack
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtlogginglogdroppack
      - 9.2.7
      - nine
      - remedy
      - all

  - name: 9.2.7 - 'Windows Firewall Private Logging Log dropped packets' is set to 'Yes'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging
      name: "LogDroppedPackets"
      data: "1"
      type: dword
    when:
      - pvtlogginglogdroppack.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtlogginglogdroppack
      - 9.2.7
      - nine
      - remedy
      - all

  - name: 9.2.8 - Fetching the pvtlogginglogsuccess value from ansible facts
    win_shell: c:\facts\pvtlogginglogsuccess_928_audit.ps1     
    register: pvtlogginglogsuccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtlogginglogsuccess
      - 9.2.8
      - nine
      - remedy
      - all

  - name: 9.2.8 - 'Windows Firewall Private Logging Log successful connections' is set to 'Yes'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging
      name: "LogSuccessfulConnections"
      data: "1"
      type: dword
    when:
      - pvtlogginglogsuccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pvtlogginglogsuccess
      - 9.2.8
      - nine
      - remedy
      - all
      
  - name: 9.3.1 - Fetching the pubfirewallstate value from ansible facts
    win_shell: c:\facts\pubfirewallstate_931_audit.ps1     
    register: pubfirewallstate
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pubfirewallstate
      - 9.3.1
      - nine
      - remedy
      - all

  - name: 9.3.1 - 'Windows Firewall Public Firewall state' is set to 'On (recommended)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile
      name: "EnableFirewall"
      data: "1"
      type: dword
    when:
      - pubfirewallstate.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pubfirewallstate
      - 9.3.1
      - nine
      - remedy
      - all  

  - name: 9.3.2 - Fetching the pubinboundconn value from ansible facts
    win_shell: c:\facts\pubinboundconn_932_audit.ps1     
    register: pubinboundconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pubinboundconn
      - 9.3.2
      - nine
      - remedy
      - all

  - name: 9.3.2 - 'Windows Firewall Public Inbound connections' is set to 'Block (default)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile
      name: "DefaultInboundAction"
      data: "1"
      type: dword
    when:
      - pubinboundconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pubinboundconn
      - 9.3.2
      - nine
      - remedy
      - all

  - name: 9.3.3 - Fetching the puboutboundconn value from ansible facts
    win_shell: c:\facts\puboutboundconn_933_audit.ps1     
    register: puboutboundconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - puboutboundconn
      - 9.3.3
      - nine
      - remedy
      - all

  - name: 9.3.3 - 'Windows Firewall Public Outbound connections' is set to 'Allow (default)'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile
      name: "DefaultOutboundAction"
      data: "0"
      type: dword
    when:
      - puboutboundconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - puboutboundconn
      - 9.3.3
      - nine
      - remedy
      - all

  - name: 9.3.4 - Fetching the pubdisablenotification value from ansible facts
    win_shell: c:\facts\pubdisablenotification_934_audit.ps1     
    register: pubdisablenotification
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pubdisablenotification
      - 9.3.4
      - nine
      - remedy
      - all

  - name: 9.3.4 - 'Windows Firewall Public Settings Display a notification' is set to 'No'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile
      name: "DisableNotifications"
      data: "1"
      type: dword
    when:
      - pubdisablenotification.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pubdisablenotification
      - 9.3.4
      - nine
      - remedy
      - all

  - name: 9.3.5 - Fetching the localfirewallrules value from ansible facts
    win_shell: c:\facts\localfirewallrules_935_audit.ps1     
    register: localfirewallrules
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - localfirewallrules
      - 9.3.5
      - nine
      - remedy
      - all

  - name: 9.3.5 - 'Windows Firewall Public Settings Apply local firewall rules' is set to 'No'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile
      name: "AllowLocalPolicyMerge"
      data: "0"
      type: dword
    when:
      - localfirewallrules.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - localfirewallrules
      - 9.3.5
      - nine
      - remedy
      - all

  - name: 9.3.6 - Fetching the localconnsecurules value from ansible facts
    win_shell: c:\facts\localconnsecurules_936_audit.ps1     
    register: localconnsecurules
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - localconnsecurules
      - 9.3.6
      - nine
      - remedy
      - all

  - name: 9.3.6 - 'Windows Firewall Public Settings Apply local connection security rules' is set to 'No'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile
      name: "AllowLocalIPsecPolicyMerge"
      data: "0"
      type: dword
    when:
      - localconnsecurules.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - localconnsecurules
      - 9.3.6
      - nine
      - remedy
      - all
      
  - name: 9.3.7 Fetching the publoggingname value from ansible facts
    win_shell: c:\facts\publoggingname_937_audit.ps1     
    register: publoggingname
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - publoggingname
      - 9.3.7
      - nine
      - remedy
      - all

  - name: 9.3.7 'Windows Firewall Public Logging Name' is set to '%SYSTEMROOT%\System32\logfiles\firewall\publicfw.log'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging
      name: "LogFilePath"
      data: "%SYSTEMROOT%\\System32\\logfiles\\firewall\\Publicfw.log"
      type: string
    when:
      - publoggingname.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - publoggingname
      - 9.3.7
      - nine
      - remedy
      - all

  - name: 9.3.8 Fetching the publoggingsizelimit value from ansible facts
    win_shell: c:\facts\publoggingsizelimit_938_audit.ps1     
    register: publoggingsizelimit
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - publoggingsizelimit
      - 9.3.8
      - nine
      - remedy
      - all
      
  - name: 9.3.8 'Windows Firewall Public Logging Size limit (KB)' is set to '16,384 KB or greater'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging
      name: "LogFileSize"
      data: "16384"
      type: dword
    when:
      - publoggingsizelimit.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - publoggingsizelimit
      - 9.3.8
      - nine
      - remedy
      - all

  - name: 9.3.9 Fetching the publogginglogdroppack value from ansible facts
    win_shell: c:\facts\publogginglogdroppack_939_audit.ps1     
    register: publogginglogdroppack
    ignore_errors: True
    tags:
      - publogginglogdroppack
      - 9.3.9
      - nine
      - remedy
      - all
      
  - name: 9.3.9 'Windows Firewall Public Logging Log dropped packets' is set to 'Yes'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging
      name: "LogDroppedPackets"
      data: "1"
      type: dword
    when:
      - publogginglogdroppack.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - publogginglogdroppack
      - 9.3.9
      - nine
      - remedy
      - all
      
  - name: 9.3.10 Fetching the publogginglogsuccess value from ansible facts
    win_shell: c:\facts\publogginglogsuccess_9310_audit.ps1     
    register: publogginglogsuccess
    ignore_errors: True
    tags:
      - publogginglogsuccess
      - 9.3.10
      - nine
      - remedy
      - all

  - name: 9.3.10 'Windows Firewall Public Logging Log successful connections' is set to 'Yes'
    win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging
      name: "LogSuccessfulConnections"
      data: "1"
      type: dword
    when:
      - publogginglogsuccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - publogginglogsuccess
      - 9.3.10
      - nine
      - remedy
      - all    

  - name: 17.1.1 Fetching the audcredvalidation value from ansible facts
    win_shell: c:\facts\audcredvalidation_1711_audit.ps1
    register: audcredvalidation
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audcredvalidation
      - 17.1.1
      - seventeen
      - remedy
      - all

  - name: 17.1.1 'Audit Credential Validation' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Credential Validation
      audit_type: success, failure
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audcredvalidation
      - 17.1.1
      - seventeen
      - remedy
      - all

  - name: 17.1.2 Fetching the audkerbauthservice value from ansible facts 
    win_shell: c:\facts\audkerberosauthen_1712_audit.ps1
    register: audkerberosauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - audkerberosauthen
      - 17.1.2
      - seventeen
      - remedy
      - all   
 
  - name: 17.1.2 'Audit Kerberos Authentication Service' is set to 'Success and Failure' 
    win_audit_policy_system:
      subcategory: Kerberos Authentication service
      audit_type: success, failure
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - audkerberosauthen.stdout.find("FAILED") != -1
    tags:
      - audkerberosauthen
      - 17.1.2
      - seventeen
      - remedy
      - all

  - name: 17.1.3 Fetching the audkerbservtickoperation value from ansible facts
    win_shell: c:\facts\audkerberossrvtick_1713_audit.ps1
    register: audkerberossrvtick
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - audkerberossrvtick
      - 17.1.3
      - seventeen
      - remedy
      - all
  
  - name: 17.1.3 'Audit Kerberos Service Ticket Operations' is set to 'Success and Failure' 
    win_audit_policy_system:
      subcategory: Kerberos Service Ticket Operations
      audit_type: success, failure
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - audkerberossrvtick.stdout.find("FAILED") != -1
    tags:
      - audkerberossrvtick
      - 17.1.3
      - seventeen
      - remedy
      - all

  - name: 17.2.1 - Fetching the audappgrpmangment value from ansible facts
    win_shell: c:\facts\audappgrpmangment_1721_audit.ps1
    register: audappgrpmangment
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audappgrpmangment
      - 17.2.1
      - seventeen
      - remedy
      - all

  - name: 17.2.1 - 'Audit Application Group Management' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Application Group Management
      audit_type: success, failure
    when:
      - audappgrpmangment.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audappgrpmangment
      - 17.2.1
      - seventeen
      - remedy
      - all

  - name: 17.2.2 - Fetching the audcompaccmangment value from ansible facts
    win_shell: c:\facts\audcompaccmangment_1722_audit.ps1
    register: audcompaccmangment
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - audcompaccmangment
      - 17.2.2
      - seventeen
      - remedy
      - all

  - name: 17.2.2 - 'Audit Computer Account Management' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Computer Account Management
      audit_type: success
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - audcompaccmangment.stdout.find("FAILED") != -1
    tags:
      - audcompaccmangment
      - 17.2.2
      - seventeen
      - remedy
      - all

  - name: 17.2.3 - Fetching the auddistribgrpmangment value from ansible facts
    win_shell: c:\facts\auddistribgrpmangment_1723_audit.ps1
    register: auddistribgrpmangment
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - auddistribgrpmangment
      - 17.2.3
      - seventeen
      - remedy
      - all

  - name: 17.2.3 -'Audit Distribution Group Management' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Distribution Group Management
      audit_type: success
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - auddistribgrpmangment.stdout.find("FAILED") != -1
    tags:
      - auddistribgrpmangment
      - 17.2.3
      - seventeen
      - remedy
      - all

  - name: 17.2.4 - Fetching the audotheraccmangment value from ansible facts
    win_shell: c:\facts\audotheraccmangment_1724_audit.ps1
    register: audotheraccmangment
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - audotheraccmangment
      - 17.2.4
      - seventeen
      - remedy
      - all

  - name: 17.2.4 - 'Audit Other Account Management Events' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Other Account Management Events
      audit_type: success
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - audotheraccmangment.stdout.find("FAILED") != -1
    tags:
      - audotheraccmangment
      - 17.2.4
      - seventeen
      - remedy
      - all

  - name: 17.2.5 - Fetching the audsecurgrpmangment value from ansible facts
    win_shell: c:\facts\audsecurgrpmangment_1725_audit.ps1
    register: audsecurgrpmangment
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audsecurgrpmangment
      - 17.2.5
      - seventeen
      - remedy
      - all

  - name: 17.2.5 - 'Audit Security Group Management' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Security Group Management
      audit_type: success
    when:
      - audsecurgrpmangment.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audsecurgrpmangment
      - 17.2.5
      - seventeen
      - remedy
      - all

  - name: 17.2.6 - Fetching the audusraccmangment value from ansible facts
    win_shell: c:\facts\audusraccmangment_1726_audit.ps1
    register: audusraccmangment
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audusraccmangment
      - 17.2.6
      - seventeen
      - remedy
      - all

  - name: 17.2.6 - 'Audit User Account Management' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: User Account Management
      audit_type: success, failure
    when:
      - audusraccmangment.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audusraccmangment
      - 17.2.6
      - seventeen
      - remedy
      - all

  - name: 17.3.1 - Fetching the auditprocesscreation value from ansible facts
    win_shell: c:\facts\auditprocesscreation_1731_audit.ps1
    register: auditprocesscreation
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditprocesscreation
      - 17.3.1
      - seventeen
      - remedy
      - all

  - name: 17.3.1 - 'Audit Process Creation' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Process Creation
      audit_type: success
    when:
      - auditprocesscreation.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditprocesscreation
      - 17.3.1
      - seventeen
      - remedy
      - all

  - name: 17.4.1 - Fetching the auditdirservaccess value from ansible facts
    win_shell: c:\facts\auditdirservaccess_1741_audit.ps1
    register: auditdirservaccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - auditdirservaccess
      - 17.4.1
      - seventeen
      - remedy
      - all

  - name: 17.4.1 - 'Audit Directory Service Access' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Directory Service Access
      audit_type: failure
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - auditdirservaccess.stdout.find("FAILED") != -1
    tags:
      - auditdirservaccess
      - 17.4.1
      - seventeen
      - remedy
      - all

  - name: 17.4.2 - Fetching the auditdirservchg value from ansible facts
    win_shell: c:\facts\auditdirservchg_1742_audit.ps1
    register: auditdirservchg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - auditdirservchg
      - 17.4.2
      - seventeen
      - remedy
      - all 

  - name: 17.4.2 - 'Audit Directory Service Changes' is set to include 'Success ans Failure'
    win_audit_policy_system:
      subcategory: Directory Service Changes
      audit_type: success
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - auditdirservchg.stdout.find("FAILED") != -1
    tags:
      - auditdirservchg
      - 17.4.2
      - seventeen
      - remedy
      - all

  - name: 17.5.1 - Fetching the auditacclockout value from ansible facts
    win_shell: c:\facts\auditacclockout_1751_audit.ps1
    register: auditacclockout
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditacclockout
      - 17.5.1
      - seventeen
      - remedy
      - all
        
  - name: 17.5.1 - 'Audit Account Lockout' is set to include 'Failure'
    win_audit_policy_system:
      subcategory: Account Lockout
      audit_type: failure
    when:
      - auditacclockout.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditacclockout
      - 17.5.1
      - seventeen
      - remedy
      - all

  - name: 17.5.2 - Fetching the auditlogoff value from ansible facts
    win_shell: c:\facts\auditlogoff_1752_audit.ps1
    register: auditlogoff
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditlogoff
      - 17.5.2
      - seventeen
      - remedy
      - all
   
  - name: 17.5.2 - 'Audit Logoff' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Logoff
      audit_type: success
    when:
      - auditlogoff.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditlogoff
      - 17.5.2
      - seventeen
      - remedy
      - all

  - name: 17.5.3 - Fetching the auditlogon value from ansible facts
    win_shell: c:\facts\auditlogon_1753_audit.ps1
    register: auditlogon
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditlogon
      - 17.5.3
      - seventeen
      - remedy
      - all

  - name: 17.5.3 - 'Audit Logon' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Logon
      audit_type: success, failure
    when:
      - auditlogon.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditlogon
      - 17.5.3
      - seventeen
      - remedy
      - all

  - name: 17.5.4 - Fetching the auditotherlogonoff value from ansible facts
    win_shell: c:\facts\auditotherlogonoff_1754_audit.ps1
    register: auditotherlogonoff
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditotherlogonoff
      - 17.5.4
      - seventeen
      - remedy
      - all
 
  - name: 17.5.4 - 'Audit Other Logon/Logoff Events' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Other Logon/Logoff Events
      audit_type: success, failure
    when:
      - auditotherlogonoff.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditotherlogonoff
      - 17.5.4
      - seventeen
      - remedy
      - all

  - name: 17.5.5 - Fetching the auditspeciallogon value from ansible facts
    win_shell: c:\facts\auditspeciallogon_1755_audit.ps1
    register: auditspeciallogon
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditspeciallogon
      - 17.5.5
      - seventeen
      - remedy
      - all

  - name: 17.5.5 - 'Audit Special Logon' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Special Logon
      audit_type: success
    when:
      - auditspeciallogon.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditspeciallogon
      - 17.5.5
      - seventeen
      - remedy
      - all

  - name: 17.6.1 Fetching the auddtailedfileshre value from ansible facts
    win_shell: c:\facts\auddtailedfileshre_1761_audit.ps1
    register: auddtailedfileshre
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auddtailedfileshre
      - 17.6.1
      - seventeen
      - remedy
      - all
  
  - name: 17.6.1 'Audit Detailed File Share' is set to include 'Failure'
    win_audit_policy_system:
      subcategory: Detailed File Share
      audit_type: failure
    when:
      - auddtailedfileshre.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auddtailedfileshre
      - 17.6.1
      - seventeen
      - remedy
      - all

  - name: 17.6.2 Fetching the audfileshare value from ansible facts
    win_shell: c:\facts\audfileshare_1762_audit.ps1
    register: audfileshare
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audfileshare
      - 17.6.2
      - seventeen
      - remedy
      - all

  - name: 17.6.2 'Audit File Share' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: File Share
      audit_type: success, failure
    when:
      - audfileshare.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audfileshare
      - 17.6.2
      - seventeen
      - remedy
      - all

  - name: 17.6.3 - Fetching the auditotherobjaccess value from ansible facts
    win_shell: c:\facts\auditotherobjaccess_1763_audit.ps1
    register: auditotherobjaccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditotherobjaccess
      - 17.6.3
      - seventeen
      - remedy
      - all
  
  - name: 17.6.3 - 'Audit Other Object Access Events' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Other Object Access Events
      audit_type: success, failure
    when:
      - auditotherobjaccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditotherobjaccess
      - 17.6.3
      - seventeen
      - remedy
      - all

  - name: 17.6.4 - Fetching the auditremovablestorage value from ansible facts
    win_shell: c:\facts\auditremovablestorage_1764_audit.ps1
    register: auditremovablestorage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditremovablestorage
      - 17.6.4
      - seventeen
      - remedy
      - all
      
  - name: 17.6.4 - 'Audit Removable Storage' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Removable Storage
      audit_type: success, failure
    when:
      - auditremovablestorage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditremovablestorage
      - 17.6.4
      - seventeen
      - remedy
      - all

  - name: 17.7.1 - Fetching the auditpolicychg value from ansible facts
    win_shell: c:\facts\auditpolicychg_1771_audit.ps1
    register: auditpolicychg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditpolicychg
      - 17.7.1
      - seventeen
      - remedy
      - all
  
  - name: 17.7.1 - 'Audit Audit Policy Change' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Audit Policy Change
      audit_type: success
    when:
      - auditpolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditpolicychg
      - 17.7.1
      - seventeen
      - remedy
      - all

  - name: 17.7.2 - Fetching the auditauthenpolicychg value from ansible facts
    win_shell: c:\facts\auditauthenpolicychg_1772_audit.ps1
    register: auditauthenpolicychg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditauthenpolicychg
      - 17.7.2
      - seventeen
      - remedy
      - all

  - name: 17.7.2 - 'Audit Authentication Policy Change' is set to  'Success'
    win_audit_policy_system:
      subcategory: Authentication Policy Change
      audit_type: success
    when:
      - auditauthenpolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditauthenpolicychg
      - 17.7.2
      - seventeen
      - remedy
      - all

  - name: 17.7.3 - Fetching the auditauthompolicychg value from ansible facts
    win_shell: c:\facts\auditauthornpolicychg_1773_audit.ps1
    register: auditauthornpolicychg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditauthornpolicychg
      - 17.7.3
      - seventeen
      - remedy
      - all

  - name: 17.7.3 - 'Audit Authorization Policy Change' is set to  'Success'
    win_audit_policy_system:
      subcategory: Authorization Policy Change
      audit_type: success
    when:
      - auditauthornpolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditauthornpolicychg
      - 17.7.3
      - seventeen
      - remedy
      - all

  - name: 17.7.4 Fetching the auditmprulelevpolicychg value from ansible facts
    win_shell: c:\facts\audmpssvcrulelevelpolicychg_1774_audit.ps1
    register: audmpssvcrulelevelpolicychg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audmpssvcrulelevelpolicychg
      - 17.7.4
      - seventeen
      - remedy
      - all

  - name: 17.7.4 'Audit MPSSVC Rule-Level Policy Change' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: MPSSVC Rule-Level Policy Change
      audit_type: success, failure
    when:
      - audmpssvcrulelevelpolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audmpssvcrulelevelpolicychg
      - 17.7.4
      - seventeen
      - remedy
      - all
    
  - name: 17.7.5 Fetching the auditotherpolicychg value from ansible facts
    win_shell: c:\facts\audothrpolicychg_1775_audit.ps1
    register: audothrpolicychg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audothrpolicychg
      - 17.7.5
      - seventeen
      - remedy
      - all

  - name: 17.7.5 'Audit Other Policy Change Events' is set to include 'Failure' (Scored)
    win_audit_policy_system:
      subcategory: Other Policy Change Events
      audit_type: failure
    when:
      - audothrpolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - audothrpolicychg
      - 17.7.5
      - seventeen
      - remedy
      - all

  - name: 17.8.1 - Fetching the auditsensitiveprivuse value from ansible facts
    win_shell: c:\facts\auditsensitiveprivuse_1781_audit.ps1
    register: auditsensitiveprivuse
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsensitiveprivuse
      - 17.8.1
      - seventeen
      - remedy
      - all

  - name: 17.8.1 - 'Audit Sensitive Privilege Use' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Sensitive Privilege Use
      audit_type: success, failure
    when:
      - auditsensitiveprivuse.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsensitiveprivuse
      - 17.8.1
      - seventeen
      - remedy
      - all

  - name: 17.9.1 - Fetching the auditipsecdriver value from ansible facts
    win_shell: c:\facts\auditipsecdriver_1791_audit.ps1
    register: auditipsecdriver
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditipsecdriver
      - 17.9.1
      - seventeen
      - remedy
      - all

  - name: 17.9.1 - 'Audit IPsec Driver' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: IPsec Driver
      audit_type: success, failure
    when:
      - auditipsecdriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditipsecdriver
      - 17.9.1
      - seventeen
      - remedy
      - all

  - name: 17.9.2 - Fetching the auditothersysevents value from ansible facts
    win_shell: c:\facts\auditothersysevents_1792_audit.ps1
    register: auditothersysevents
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditothersysevents
      - 17.9.2
      - seventeen
      - remedy
      - all
 
  - name: 17.9.2 - 'Audit Other System Events' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: Other System Events
      audit_type: success, failure
    when:
      - auditothersysevents.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditothersysevents
      - 17.9.2
      - seventeen
      - remedy
      - all

  - name: 17.9.3 - Fetching the auditsecurstatechg value from ansible facts
    win_shell: c:\facts\auditsecurstatechg_1793_audit.ps1
    register: auditsecurstatechg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsecurstatechg
      - 17.9.3
      - seventeen
      - remedy
      - all

  - name: 17.9.3 - 'Audit Security State Change' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Security State Change
      audit_type: success
    when:
      - auditsecurstatechg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsecurstatechg
      - 17.9.3
      - seventeen
      - remedy
      - all

  - name: 17.9.4 - Fetching the auditsecursysext value from ansible facts
    win_shell: c:\facts\auditsecursysext_1794_audit.ps1
    register: auditsecursysext
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsecursysext
      - 17.9.4
      - seventeen
      - remedy
      - all

  - name: 17.9.4 - 'Audit Security System Extension' is set to include 'Success'
    win_audit_policy_system:
      subcategory: Security System Extension
      audit_type: success
    when:
      - auditsecursysext.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsecursysext
      - 17.9.4
      - seventeen
      - remedy
      - all

  - name: 17.9.5 - Fetching the auditsysintegrity value from ansible facts
    win_shell: c:\facts\auditsysintegrity_1795_audit.ps1
    register: auditsysintegrity
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsysintegrity
      - 17.9.5
      - seventeen
      - remedy
      - all

  - name: 17.9.5 - 'Audit System Integrity' is set to 'Success and Failure'
    win_audit_policy_system:
      subcategory: System Integrity
      audit_type: success, failure
    when:
      - auditsysintegrity.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - auditsysintegrity
      - 17.9.5
      - seventeen
      - remedy
      - all

  - name: creating directory for policyfiles and lgpo
    win_file:
      path: C:\facts\{{ item }}
      state: directory
    with_items:
      - policyfiles
      - Lgpo
    tags:
      - always

  - name: transfering the LGPO.exe
    win_copy:
      src: ../files/Lgpo_exe/LGPO.exe
      dest: C:\facts\Lgpo\LGPO.exe
    tags:
      - always

  - name: 18.1.1.1 - Fetching the enablelockscreencam value from ansible facts
    win_shell: c:\facts\enablelockscreencam_18111_audit.ps1
    register: enablelockscreencam
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablelockscreencam
      - eighteen
      - 18.1.1.1
      - remedy
      - all

  - name: 18.1.1.1 - Transfering the enablelockscreencam.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enablelockscreencam_18111.pol
      dest: C:\facts\policyfiles\enablelockscreencam_18111.pol
    when:
      - enablelockscreencam.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablelockscreencam
      - eighteen
      - 18.1.1.1
      - remedy
      - all

  - name: 18.1.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enablelockscreencam_18111.pol
    when:
      - enablelockscreencam.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablelockscreencam
      - eighteen
      - 18.1.1.1
      - remedy
      - all

  - name: 18.1.1.2 - Fetching the enablelockscreenslide value from ansible facts
    win_shell: c:\facts\enablelockscreenslide_18112_audit.ps1
    register: enablelockscreenslide
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablelockscreenslide
      - eighteen
      - 18.1.1.2
      - remedy
      - all

  - name: 18.1.1.2 - Transfering the enablelockscreenslide.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enablelockscreenslide_18112.pol
      dest: C:\facts\policyfiles\enablelockscreenslide_18112.pol
    when:
      - enablelockscreenslide.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablelockscreenslide
      - eighteen
      - 18.1.1.2
      - remedy
      - all

  - name: 18.1.1.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enablelockscreenslide_18112.pol
    when:
      - enablelockscreenslide.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablelockscreenslide
      - eighteen
      - 18.1.1.2
      - remedy
      - all
      
  - name: 18.2.1 - Fetching the lapsadmpwd value from ansible facts
    win_shell: c:\facts\lapsadmpwd_1821_audit.ps1
    register: lapsadmpwd
    ignore_errors: True
    when: (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - lapsadmpwd
      - eighteen
      - 18.2.1
      - remedy
      - all

  - name: 18.2.1 - Creating directory for laps.msi [C:\facts\laps]
    win_file: 
      path: C:\facts\laps
      state: directory
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - lapsadmpwd.stdout.find("FAILED") != -1
    tags:
      - lapsadmpwd
      - eighteen
      - 18.2.1
      - all

  - name: 18.2.1 - downloading LAPS for 64 bit
    win_get_url:
      url: https://download.microsoft.com/download/C/7/A/C7AAD914-A8A6-4904-88A1-29E657445D03/LAPS.x64.msi
      dest: C:\facts\laps\LAPS.x64.msi
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - lapsadmpwd.stdout.find("FAILED") != -1
      - ansible_architecture == "64-bit"
    tags:
      - lapsadmpwd
      - eighteen
      - 18.2.1
      - all

  - name: 18.2.1 - installing LAPS for 64 bit
    win_shell: "{{ item }}"
    with_items:
       - MsiExec.exe /i C:\facts\laps\LAPS.x64.msi ADDLOCAL=CSE ALLUSERS=1 /qn
       - MsiExec.exe /i C:\facts\laps\LAPS.x64.msi ADDLOCAL=Management.ADMX ALLUSERS=1 /qn
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - lapsadmpwd.stdout.find("FAILED") != -1
      - ansible_architecture == "64-bit"
    tags:
      - lapsadmpwd
      - eighteen
      - 18.2.1
      - all

  - name: 18.2.1 - downloading LAPS for 32 bit
    win_get_url:
      url: https://download.microsoft.com/download/C/7/A/C7AAD914-A8A6-4904-88A1-29E657445D03/LAPS.x86.msi
      dest: C:\facts\laps\LAPS.x86.msi
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - lapsadmpwd.stdout.find("FAILED") != -1
      - ansible_architecture != "64-bit"
    tags:
      - lapsadmpwd
      - eighteen
      - 18.2.1
      - all

  - name: 18.2.1 - installing LAPS for 32 bit
    win_shell: "{{ item }}"
    with_items:
       - MsiExec.exe /i C:\facts\laps\LAPS.x86.msi ADDLOCAL=CSE ALLUSERS=1 /qn
       - MsiExec.exe /i C:\facts\laps\LAPS.x86.msi ADDLOCAL=Management.ADMX ALLUSERS=1 /qn
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - lapsadmpwd.stdout.find("FAILED") != -1
      - ansible_architecture != "64-bit"
    tags:
      - lapsadmpwd
      - eighteen
      - 18.2.1
      - all
      
  - name: 18.2.2 - Fetching the dontallowpwdexpirtime value from ansible facts
    win_shell: c:\facts\dontallowpwdexpirtime_1822_audit.ps1
    register: dontallowpwdexpirtime
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - dontallowpwdexpirtime
      - eighteen
      - 18.2.2
      - remedy
      - all
      
  - name: 18.2.2 - Transfering the dontallowpwdexpirtime.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontallowpwdexpirtime_1822.pol
      dest: C:\facts\policyfiles\dontallowpwdexpirtime_1822.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - dontallowpwdexpirtime.stdout.find("FAILED") != -1
    tags:
      - dontallowpwdexpirtime
      - eighteen
      - 18.2.2
      - remedy
      - all

  - name: 18.2.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontallowpwdexpirtime_1822.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - dontallowpwdexpirtime.stdout.find("FAILED") != -1
    tags:
      - dontallowpwdexpirtime
      - eighteen
      - 18.2.2
      - remedy
      - all
      
  - name: 18.2.3 - Fetching the localadmpwdmangment value from ansible facts
    win_shell: c:\facts\localadmpwdmangment_1823_audit.ps1
    register: localadmpwdmangment
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - localadmpwdmangment
      - eighteen
      - 18.2.3
      - remedy
      - all
      
  - name: 18.2.3 - Transfering the localadmpwdmangment.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/localadmpwdmangment_1823.pol
      dest: C:\facts\policyfiles\localadmpwdmangment_1823.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - localadmpwdmangment.stdout.find("FAILED") != -1
    tags:
      - localadmpwdmangment
      - eighteen
      - 18.2.3
      - remedy
      - all

  - name: 18.2.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\localadmpwdmangment_1823.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - localadmpwdmangment.stdout.find("FAILED") != -1
    tags:
      - localadmpwdmangment
      - eighteen
      - 18.2.3
      - remedy
      - all
      
  - name: 18.2.4 - Fetching the pwdcomplexity value from ansible facts
    win_shell: c:\facts\pwdcomplexity_1824_audit.ps1
    register: pwdcomplexity
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - pwdcomplexity
      - eighteen
      - 18.2.4
      - remedy
      - all
      
  - name: 18.2.4 - Transfering pwdcomplexity.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdcomplexity_1824.pol
      dest: C:\facts\policyfiles\pwdcomplexity_1824.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - pwdcomplexity.stdout.find("FAILED") != -1
    tags:
      - pwdcomplexity
      - eighteen
      - 18.2.4
      - remedy
      - all

  - name: 18.2.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdcomplexity_1824.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - pwdcomplexity.stdout.find("FAILED") != -1
    tags:
      - pwdcomplexity
      - eighteen
      - 18.2.4
      - remedy
      - all
      
  - name: 18.2.5 - Fetching the pwdlength value from ansible facts
    win_shell: c:\facts\pwdlength_1825_audit.ps1
    register: pwdlength
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - pwdlength
      - eighteen
      - 18.2.5
      - remedy
      - all
       
  - name: 18.2.5 - Transfering pwdlength.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdlength_1825.pol
      dest: C:\facts\policyfiles\pwdlength_1825.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - pwdlength.stdout.find("FAILED") != -1
    tags:
      - pwdlength
      - eighteen
      - 18.2.5
      - remedy
      - all

  - name: 18.2.5 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdlength_1825.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - pwdlength.stdout.find("FAILED") != -1
    tags:
      - pwdlength
      - eighteen
      - 18.2.5
      - remedy
      - all
      
  - name: 18.2.6 - Fetching the pwdage value from ansible facts
    win_shell: c:\facts\pwdage_1826_audit.ps1
    register: pwdage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - pwdage
      - eighteen
      - 18.2.6
      - remedy
      - all
      
  - name: 18.2.6 - Transfering pwdage.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdage_1826.pol
      dest: C:\facts\policyfiles\pwdage_1826.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - pwdage.stdout.find("FAILED") != -1
    tags:
      - pwdage
      - eighteen
      - 18.2.6
      - remedy
      - all

  - name: 18.2.6 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdage_1826.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - pwdage.stdout.find("FAILED") != -1
    tags:
      - pwdage
      - eighteen
      - 18.2.6
      - remedy
      - all

  - name: checking if SecGuide.admx and SecGuide.adml templates exists
    win_shell: (Get-ChildItem -Path C:\Windows\PolicyDefinitions  -Filter SecGuide* -Recurse -ErrorAction SilentlyContinue -Force | foreach { $_.Name }) -join ', '
    register: SecGuide_file_out
    tags:
      - uacrestrictlocalacc
      - 18.3.1
      - confsmbclient
      - 18.3.2
      - confsmbserver
      - 18.3.3
      - enablesehop
      - 18.3.4
      - enableexprotldap
      - 18.3.5
      - netbiosnodetype
      - 18.3.6
      - wdigestauthen
      - 18.3.7
      - remedy
      - all

  - name: copying templates to PolicyDefinitions
    win_copy:
      src: '{{ item.src }}'
      dest: '{{ item.dest }}'
    with_items:
      - { src: '../files/windows_templates/windows2012r2/SecGuide.adml', dest: 'C:\Windows\PolicyDefinitions\en-US\SecGuide.adml' }
      - { src: '../files/windows_templates/windows2012r2/SecGuide.admx', dest: 'C:\Windows\PolicyDefinitions\SecGuide.admx' }
    when: 
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - (SecGuide_file_out.stdout | regex_search('SecGuide.admx, SecGuide.adml')) != "SecGuide.admx, SecGuide.adml"
    tags:
      - uacrestrictlocalacc
      - 18.3.1
      - confsmbclient
      - 18.3.2
      - confsmbserver
      - 18.3.3
      - enablesehop
      - 18.3.4
      - enableexprotldap
      - 18.3.5
      - netbiosnodetype
      - 18.3.6
      - wdigestauthen
      - 18.3.7
      - remedy
      - all

  - pause: seconds=1
    tags:
      - uacrestrictlocalacc
      - 18.3.1
      - confsmbclient
      - 18.3.2
      - confsmbserver
      - 18.3.3
      - enablesehop
      - 18.3.4
      - enableexprotldap
      - 18.3.5
      - netbiosnodetype
      - 18.3.6
      - wdigestauthen
      - 18.3.7
      - remedy
      - all

  - name: 18.3.1 - Fetching the uacrestrictlocalacc value from ansible facts
    win_shell: c:\facts\uacrestrictlocalacc_1831_audit.ps1
    register: uacrestrictlocalacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - uacrestrictlocalacc
      - eighteen
      - 18.3.1
      - remedy
      - all
      
  - name: 18.3.1 - Transfering uacrestrictlocalacc.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/uacrestrictlocalacc_1831.pol
      dest: C:\facts\policyfiles\uacrestrictlocalacc_1831.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - uacrestrictlocalacc.stdout.find("FAILED") != -1
    tags:
      - uacrestrictlocalacc
      - eighteen
      - 18.3.1
      - remedy
      - all

  - name: 18.3.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\uacrestrictlocalacc_1831.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - uacrestrictlocalacc.stdout.find("FAILED") != -1
    tags:
      - uacrestrictlocalacc
      - eighteen
      - 18.3.1
      - remedy
      - all
      
  - name: 18.3.2 - Fetching the confsmbclient value from ansible facts
    win_shell: c:\facts\confsmbclient_1832_audit.ps1
    register: confsmbclient
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsmbclient
      - eighteen
      - 18.3.2
      - remedy
      - all
      
  - name: 18.3.2 - Transfering confsmbclient.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confsmbclient_1832.pol
      dest: C:\facts\policyfiles\confsmbclient_1832.pol
    when:
      - confsmbclient.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsmbclient
      - eighteen
      - 18.3.2
      - remedy
      - all

  - name: 18.3.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confsmbclient_1832.pol
    when:
      - confsmbclient.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsmbclient
      - eighteen
      - 18.3.2
      - remedy
      - all
      
  - name: 18.3.3 - Fetching the confsmbserver value from ansible facts
    win_shell: c:\facts\confsmbserver_1833_audit.ps1
    register: confsmbserver
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsmbserver
      - eighteen
      - 18.3.3
      - remedy
      - all
      
  - name: 18.3.3 - Transfering confsmbserver.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confsmbserver_1833.pol
      dest: C:\facts\policyfiles\confsmbserver_1833.pol
    when:
      - confsmbserver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsmbserver
      - eighteen
      - 18.3.3
      - remedy
      - all
      
  - name: 18.3.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confsmbserver_1833.pol
    when:
      - confsmbserver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsmbserver
      - eighteen
      - 18.3.3
      - remedy
      - all
      
  - name: 18.3.4 - Fetching the enablesehop value from ansible facts
    win_shell: c:\facts\enablesehop_1834_audit.ps1
    register: enablesehop
    ignore_errors: True
    tags:
      - enablesehop
      - eighteen
      - 18.3.4
      - remedy
      - all

  - name: 18.3.4 - Transfering enablesehop.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enablesehop_1834.pol
      dest: C:\facts\policyfiles\enablesehop_1834.pol
    when:
      - enablesehop.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablesehop
      - eighteen
      - 18.3.4
      - remedy
      - all
      
  - name: 18.3.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enablesehop_1834.pol
    when:
      - enablesehop.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablesehop
      - eighteen
      - 18.3.4
      - remedy
      - all

  - name: 18.3.5 - Fetching the enableexportldap value from ansible facts
    win_shell: c:\facts\enableexprotldap_1835_audit.ps1
    register: enableexprotldap
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
    tags:
      - enableexprotldap
      - eighteen
      - 18.3.5
      - remedy
      - all

  - name: 18.3.5 - Transfering enableexprotldap.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enableexprotldap_1835.pol
      dest: C:\facts\policyfiles\enableexprotldap_1835.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - enableexprotldap.stdout.find("FAILED") != -1
    tags:
      - enableexprotldap
      - eighteen
      - 18.3.5
      - remedy
      - all
      
  - name: 18.3.5 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enableexprotldap_1835.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5'
      - enableexprotldap.stdout.find("FAILED") != -1
    tags:
      - enableexprotldap
      - eighteen
      - 18.3.5
      - remedy
      - all
      
  - name: 18.3.6 - Fetching the netbiosnodetype value from ansible facts
    win_shell: c:\facts\netbiosnodetype_1836_audit.ps1
    register: netbiosnodetype
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - netbiosnodetype
      - eighteen
      - 18.3.6
      - remedy
      - all
      
  - name: 18.3.6 - Transfering netbiosnodetype.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/netbiosnodetype_1836.pol
      dest: C:\facts\policyfiles\netbiosnodetype_1836.pol
    when:
      - netbiosnodetype.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - netbiosnodetype
      - eighteen
      - 18.3.6
      - remedy
      - all
      
  - name: 18.3.6 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\netbiosnodetype_1836.pol
    when:
      - netbiosnodetype.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - netbiosnodetype
      - eighteen
      - 18.3.6
      - remedy
      - all

  - name: 18.3.7 - Fetching the wdigestauthen value from ansible facts
    win_shell: c:\facts\wdigestauthen_1837_audit.ps1
    register: wdigestauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - wdigestauthen
      - eighteen
      - 18.3.7
      - remedy
      - all
      
  - name: 18.3.7 - Transfering wdigestauthen.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/wdigestauthen_1837.pol
      dest: C:\facts\policyfiles\wdigestauthen_1837.pol
    when:
      - wdigestauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - wdigestauthen
      - eighteen
      - 18.3.7
      - remedy
      - all
      
  - name: 18.3.7 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\wdigestauthen_1837.pol
    when:
      - wdigestauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - wdigestauthen
      - eighteen
      - 18.3.7
      - remedy
      - all

  - name: checking if MSS-legacy.admx and MSS-legacy.adml templates exists
    win_shell: (Get-ChildItem -Path C:\Windows\PolicyDefinitions  -Filter MSS-legacy* -Recurse -ErrorAction SilentlyContinue -Force | foreach { $_.Name }) -join ', '
    register: MSS_legacy_file_out
    tags:
      - eighteen
      - autologon
      - 18.4.1
      - ipsourcerouting
      - 18.4.2
      - ipsourceroutprotect
      - 18.4.3
      - icmpredirects
      - 18.4.4
      - keepalivetime
      - 18.4.5
      - nonamerelease
      - 18.4.6
      - perfroutdiscovery
      - 18.4.7
      - safedllsearchmode
      - 18.4.8
      - screensavertime
      - 18.4.9
      - tcpmaxdataretransipv6
      - 18.4.10
      - tcpmaxdataretrans
      - 18.4.11
      - warninglevel
      - 18.4.12
      - remedy
      - all

  - name: copying templates to PolicyDefinitions
    win_copy:
      src: '{{ item.src }}'
      dest: '{{ item.dest }}'
    with_items:
      - { src: '../files/windows_templates/windows2012r2/MSS-legacy.adml', dest: 'C:\Windows\PolicyDefinitions\en-US\MSS-legacy.adml' }
      - { src: '../files/windows_templates/windows2012r2/MSS-legacy.admx', dest: 'C:\Windows\PolicyDefinitions\MSS-legacy.admx' }
    when: 
      - (MSS_legacy_file_out.stdout | regex_search('MSS-legacy.admx, MSS-legacy.adml')) != "MSS-legacy.admx, MSS-legacy.adml"
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - eighteen
      - autologon
      - 18.4.1
      - ipsourcerouting
      - 18.4.2
      - ipsourceroutprotect
      - 18.4.3
      - icmpredirects
      - 18.4.4
      - keepalivetime
      - 18.4.5
      - nonamerelease 
      - 18.4.6
      - perfroutdiscovery
      - 18.4.7
      - safedllsearchmode
      - 18.4.8
      - screensavertime 
      - 18.4.9
      - tcpmaxdataretransipv6
      - 18.4.10
      - tcpmaxdataretrans
      - 18.4.11
      - warninglevel
      - 18.4.12
      - remedy
      - all

  - pause: seconds=1
    tags:
      - eighteen
      - autologon
      - 18.4.1
      - ipsourcerouting
      - 18.4.2
      - ipsourceroutprotect
      - 18.4.3
      - icmpredirects
      - 18.4.4
      - keepalivetime
      - 18.4.5
      - nonamerelease
      - 18.4.6
      - perfroutdiscovery
      - 18.4.7
      - safedllsearchmode
      - 18.4.8
      - screensavertime
      - 18.4.9
      - tcpmaxdataretransipv6
      - 18.4.10
      - tcpmaxdataretrans
      - 18.4.11
      - warninglevel
      - 18.4.12
      - remedy
      - all
      
  - name: 18.4.1 - Fetching the autologon value from ansible facts
    win_shell: c:\facts\autologon_1841_audit.ps1
    register: autologon
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - autologon
      - eighteen
      - 18.4.1
      - remedy
      - all

  - name: 18.4.1 - Transfering autologon.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/autologon_1841.pol
      dest: C:\facts\policyfiles\autologon_1841.pol
    when:
      - autologon.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - autologon
      - eighteen
      - 18.4.1
      - remedy
      - all
      
  - name: 18.4.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\autologon_1841.pol
    when:
      - autologon.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - autologon
      - eighteen
      - 18.4.1
      - remedy
      - all

  - name: 18.4.2 - Fetching the ipsourcerouting value from ansible facts
    win_shell: c:\facts\ipsourcerouting_1842_audit.ps1
    register: ipsourcerouting
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ipsourcerouting
      - eighteen
      - 18.4.2
      - remedy
      - all

  - name: 18.4.2 - Transfering ipsourcerouting.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/ipsourcerouting_1842.pol
      dest: C:\facts\policyfiles\ipsourcerouting_1842.pol
    when:
      - ipsourcerouting.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ipsourcerouting
      - eighteen
      - 18.4.2
      - remedy
      - all
      
  - name: 18.4.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\ipsourcerouting_1842.pol
    when:
      - ipsourcerouting.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ipsourcerouting
      - eighteen
      - 18.4.2
      - remedy
      - all

  - name: 18.4.3 - Fetching the ipsourceroutprotect value from ansible facts
    win_shell: c:\facts\ipsourceroutprotect_1843_audit.ps1
    register: ipsourceroutprotect
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ipsourceroutprotect
      - eighteen
      - 18.4.3
      - remedy
      - all

  - name: 18.4.3 - Transfering netbiosnodetype.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/ipsourcerouting_1842.pol
      dest: C:\facts\policyfiles\ipsourcerouting_1842.pol
    when:
      - ipsourceroutprotect.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ipsourceroutprotect
      - eighteen
      - 18.4.3
      - remedy
      - all
      
  - name: 18.4.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\ipsourcerouting_1842.pol
    when:
      - ipsourceroutprotect.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ipsourceroutprotect
      - eighteen
      - 18.4.3
      - remedy
      - all

  - name: 18.4.4 - Fetching the icmpredirects value from ansible facts
    win_shell: c:\facts\icmpredirects_1844_audit.ps1
    register: icmpredirects
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - icmpredirects
      - eighteen
      - 18.4.4
      - remedy
      - all

  - name: 18.4.4 - Transfering icmpredirects.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/icmpredirects_1844.pol
      dest: C:\facts\policyfiles\icmpredirects_1844.pol
    when:
      - icmpredirects.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - icmpredirects
      - eighteen
      - 18.4.4
      - remedy
      - all
      
  - name: 18.4.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\icmpredirects_1844.pol
    when:
      - icmpredirects.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - icmpredirects
      - eighteen
      - 18.4.4
      - remedy
      - all
      
  - name: 18.4.5 (L2) - Fetching the keepalivetime value from ansible facts
    win_shell: c:\facts\keepalivetime_1845_audit.ps1
    register: keepalivetime
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - keepalivetime
      - eighteen
      - 18.4.5
      - remedy
      - all

  - name: 18.4.5 (L2) - Transfering keepalivetime.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/keepalivetime_1845.pol
      dest: C:\facts\policyfiles\keepalivetime_1845.pol
    when:
      - keepalivetime.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - keepalivetime
      - eighteen
      - 18.4.5
      - remedy
      - all
      
  - name: 18.4.5 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\keepalivetime_1845.pol
    when:
      - keepalivetime.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - keepalivetime
      - eighteen
      - 18.4.5
      - remedy
      - all

  - name: 18.4.6 - Fetching the nonamerelease value from ansible facts
    win_shell: c:\facts\nonamerelease_1846_audit.ps1
    register: nonamerelease
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - nonamerelease
      - eighteen
      - 18.4.6
      - remedy
      - all
      
  - name: 18.4.6 - Transfering nonamerelease.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/nonamerelease_1846.pol
      dest: C:\facts\policyfiles\nonamerelease_1846.pol
    when:
      - nonamerelease.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - nonamerelease
      - eighteen
      - 18.4.6
      - remedy
      - all
      
  - name: 18.4.6 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\nonamerelease_1846.pol
    when:
      - nonamerelease.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - nonamerelease
      - eighteen
      - 18.4.6
      - remedy
      - all
      
  - name: 18.4.7 (L2) - Fetching the perfroutdiscovery value from ansible facts
    win_shell: c:\facts\perfroutdiscovery_1847_audit.ps1
    register: perfroutdiscovery
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - perfroutdiscovery
      - eighteen
      - 18.4.7
      - remedy
      - all

  - name: 18.4.7 (L2) - Transfering perfroutdiscovery.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/perfroutdiscovery_1847.pol
      dest: C:\facts\policyfiles\perfroutdiscovery_1847.pol
    when:
      - perfroutdiscovery.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - perfroutdiscovery
      - eighteen
      - 18.4.7
      - remedy
      - all
      
  - name: 18.4.7 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\perfroutdiscovery_1847.pol
    when:
      - perfroutdiscovery.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - perfroutdiscovery
      - eighteen
      - 18.4.7
      - remedy
      - all

  - name: 18.4.8 - Fetching the safedllsearchmode value from ansible facts
    win_shell: c:\facts\safedllsearchmode_1848_audit.ps1
    register: safedllsearchmode
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - safedllsearchmode
      - eighteen
      - 18.4.8
      - remedy
      - all

  - name: 18.4.8 - Transfering safedllsearchmode.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/safedllsearchmode_1848.pol
      dest: C:\facts\policyfiles\safedllsearchmode_1848.pol
    when:
      - safedllsearchmode.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - safedllsearchmode
      - eighteen
      - 18.4.8
      - remedy
      - all
      
  - name: 18.4.8 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\safedllsearchmode_1848.pol
    when:
      - safedllsearchmode.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - safedllsearchmode
      - eighteen
      - 18.4.8
      - remedy
      - all

  - name: 18.4.9 - Fetching the screensavertime value from ansible facts
    win_shell: c:\facts\screensavertime_1849_audit.ps1
    register: screensavertime
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - screensavertime
      - eighteen
      - 18.4.9
      - remedy
      - all

  - name: 18.4.9 - Transfering screensavertime.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/screensavertime_1849.pol
      dest: C:\facts\policyfiles\screensavertime_1849.pol
    when:
      - screensavertime.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - screensavertime
      - eighteen
      - 18.4.9
      - remedy
      - all
      
  - name: 18.4.9 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\screensavertime_1849.pol
    when:
      - screensavertime.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - screensavertime
      - eighteen
      - 18.4.9
      - remedy
      - all

  - name: 18.4.10 (L2) - Fetching the tcpmaxdataretransipv6 value from ansible facts
    win_shell: c:\facts\tcpmaxdataretransipv6_18410_audit.ps1
    register: tcpmaxdataretransipv6
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tcpmaxdataretransipv6
      - eighteen
      - 18.4.10
      - remedy
      - all

  - name: 18.4.10 (L2) - Transfering tcpmaxdataretransipv6.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/tcpmaxdataretransipv6_18410.pol
      dest: C:\facts\policyfiles\tcpmaxdataretransipv6_18410.pol
    when:
      - tcpmaxdataretransipv6.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tcpmaxdataretransipv6
      - eighteen
      - 18.4.10
      - remedy
      - all
      
  - name: 18.4.10 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\tcpmaxdataretransipv6_18410.pol
    when:
      - tcpmaxdataretransipv6.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tcpmaxdataretransipv6
      - eighteen
      - 18.4.10
      - remedy
      - all
      
  - name: 18.4.11 (L2) - Fetching the tcpmaxdataretrans value from ansible facts
    win_shell: c:\facts\tcpmaxdataretrans_18411_audit.ps1
    register: tcpmaxdataretrans
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tcpmaxdataretrans
      - eighteen
      - 18.4.11
      - remedy
      - all

  - name: 18.4.11 (L2) - Transfering tcpmaxdataretrans.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/tcpmaxdataretrans_18411.pol
      dest: C:\facts\policyfiles\tcpmaxdataretrans_18411.pol
    when:
      - tcpmaxdataretrans.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tcpmaxdataretrans
      - eighteen
      - 18.4.11
      - remedy
      - all
      
  - name: 18.4.11 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\tcpmaxdataretrans_18411.pol
    when:
      - tcpmaxdataretrans.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - tcpmaxdataretrans
      - eighteen
      - 18.4.11
      - remedy
      - all

  - name: 18.4.12 - Fetching the warninglevel value from ansible facts
    win_shell: c:\facts\warninglevel_18412_audit.ps1
    register: warninglevel
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - warninglevel
      - eighteen
      - 18.4.12
      - remedy
      - all

  - name: 18.4.12 - Transfering warninglevel.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/warninglevel_18412.pol
      dest: C:\facts\policyfiles\warninglevel_18412.pol
    when:
      - warninglevel.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - warninglevel
      - eighteen
      - 18.4.12
      - remedy
      - all
      
  - name: 18.4.12 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\warninglevel_18412.pol
    when:
      - warninglevel.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - warninglevel
      - eighteen
      - 18.4.12
      - remedy
      - all
      
  - name: 18.5.4.1 - Fetching the turnoffmulticastname value from ansible facts
    win_shell: c:\facts\turnoffmulticastname_18541_audit.ps1
    register: turnoffmulticastname
    ignore_errors: True
    tags:
      - turnoffmulticastname
      - eighteen
      - 18.5.4.1
      - remedy
      - all
      
  - name: 18.5.4.1 - Transfering turnoffmulticastname.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffmulticastname_18541.pol
      dest: C:\facts\policyfiles\turnoffmulticastname_18541.pol
    when:
      - turnoffmulticastname.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffmulticastname
      - eighteen
      - 18.5.4.1
      - remedy
      - all
      
  - name: 18.5.4.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffmulticastname_18541.pol
    when:
      - turnoffmulticastname.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffmulticastname
      - eighteen
      - 18.5.4.1
      - remedy
      - all
      
  - name: 18.5.9.1 (L2) Fetching the mapperiodriver value from ansible facts
    win_shell: c:\facts\mapperiodriver_18591_audit.ps1
    register: mapperiodriver
    ignore_errors: True
    tags:
      - mapperiodriver
      - 18.5.9.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.9.1 (L2) - Transfering mapperiodriver.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/mapperiodriver_18591.pol
      dest: C:\facts\policyfiles\mapperiodriver_18591.pol
    when:
      - mapperiodriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - mapperiodriver
      - 18.5.9.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.9.1 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\mapperiodriver_18591.pol
    when:
      - mapperiodriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - mapperiodriver
      - 18.5.9.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.9.2 (L2) Fetching the responderdriver value from ansible facts
    win_shell: c:\facts\responderdriver_18592_audit.ps1
    register: responderdriver
    ignore_errors: True
    tags:
      - responderdriver
      - 18.5.9.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.9.2 (L2) - Transfering responderdriver.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/responderdriver_18592.pol
      dest: C:\facts\policyfiles\responderdriver_18592.pol
    when:
      - responderdriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - responderdriver
      - 18.5.9.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.9.2 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\responderdriver_18592.pol
    when:
      - responderdriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - responderdriver
      - 18.5.9.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.10.1 (L2) - Fetching the mspeernetserv value from ansible facts
    win_shell: c:\facts\mspeernetserv_185101_audit.ps1
    register: mspeernetserv
    ignore_errors: True
    tags:
      - mspeernetserv
      - 18.5.10.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.10.1 (L2) - Transfering mspeernetserv.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/mspeernetserv_185101.pol
      dest: C:\facts\policyfiles\mspeernetserv_185101.pol
    when:
      - mspeernetserv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - mspeernetserv
      - 18.5.10.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.10.1 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\mspeernetserv_185101.pol
    when:
      - mspeernetserv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - mspeernetserv
      - 18.5.10.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.11.2 - Fetching the confnetbridge value from ansible facts
    win_shell: c:\facts\confnetbridge_185112_audit.ps1
    register: confnetbridge
    ignore_errors: True
    tags:
      - confnetbridge
      - 18.5.11.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.11.2 - Transfering confnetbridge.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confnetbridge_185112.pol
      dest: C:\facts\policyfiles\confnetbridge_185112.pol
    when:
      - confnetbridge.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confnetbridge
      - 18.5.11.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.11.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confnetbridge_185112.pol
    when:
      - confnetbridge.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confnetbridge
      - 18.5.11.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.11.3 - Fetching the domainusrnetloc value from ansible facts
    win_shell: c:\facts\domainusrnetloc_185113_audit.ps1
    register: domainusrnetloc
    ignore_errors: True
    tags:
      - domainusrnetloc
      - 18.5.11.3
      - eighteen
      - remedy
      - all
      
  - name: 18.5.11.3 - Transfering domainusrnetloc.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/domainusrnetloc_185113.pol
      dest: C:\facts\policyfiles\domainusrnetloc_185113.pol
    when:
      - domainusrnetloc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - domainusrnetloc
      - 18.5.11.3
      - eighteen
      - remedy
      - all
      
  - name: 18.5.11.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\domainusrnetloc_185113.pol
    when:
      - domainusrnetloc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - domainusrnetloc
      - 18.5.11.3
      - eighteen
      - remedy
      - all
      
  - name: 18.5.14.1 - Fetching the hardeneduncpath value from ansible facts
    win_shell: c:\facts\hardeneduncpath_185141_audit.ps1
    register: hardeneduncpath
    ignore_errors: True
    tags:
      - hardeneduncpath
      - 18.5.14.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.14.1 - Transfering hardeneduncpath.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/hardeneduncpath_185141.pol
      dest: C:\facts\policyfiles\hardeneduncpath_185141.pol
    when:
      - hardeneduncpath.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - hardeneduncpath
      - 18.5.14.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.14.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\hardeneduncpath_185141.pol
    when:
      - hardeneduncpath.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - hardeneduncpath
      - 18.5.14.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.19.2.1 (L2) - Fetching the disableipv6 value from ansible facts
    win_shell: c:\facts\disableipv6_1851921_audit.ps1
    register: disableipv6
    ignore_errors: True
    when: 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disableipv6
      - 18.5.19.2.1
      - eighteen
      - remedy
      - all

  - name: 18.5.19.2.1 (L2) - Disable IPv6 (Ensure TCPIP6 Parameter 'DisabledComponents' is set to '0xff (255)')
    win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\TCPIP6\Parameters
      name: DisabledComponents
      data: 0xff
      type: dword
    ignore_errors: True
    when: 
      - disableipv6.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disableipv6
      - 18.5.19.2.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.20.1 (L2) - Fetching the confwirelessset value from ansible facts
    win_shell: c:\facts\confwirelessset_185201_audit.ps1
    register: confwirelessset
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwirelessset
      - 18.5.20.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.20.1 (L2) - Transfering confwirelessset.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confwirelessset_185201.pol
      dest: C:\facts\policyfiles\confwirelessset_185201.pol
    when:
      - confwirelessset.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwirelessset
      - 18.5.20.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.20.1 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confwirelessset_185201.pol
    when:
      - confwirelessset.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwirelessset
      - 18.5.20.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.20.2 (L2) - Fetching the winsconnectnowwiz value from ansible facts
    win_shell: c:\facts\winsconnectnowwiz_185202_audit.ps1
    register: winsconnectnowwiz
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winsconnectnowwiz
      - 18.5.20.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.20.2 (L2) - Transfering winsconnectnowwiz.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/winsconnectnowwiz_185202.pol
      dest: C:\facts\policyfiles\winsconnectnowwiz_185202.pol
    when:
      - winsconnectnowwiz.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winsconnectnowwiz
      - 18.5.20.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.20.2 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\winsconnectnowwiz_185202.pol
    when:
      - winsconnectnowwiz.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winsconnectnowwiz
      - 18.5.20.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.21.1 - Fetching the minimizeinetconn value from ansible facts
    win_shell: c:\facts\minimizeinetconn_185211_audit.ps1
    register: minimizeinetconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minimizeinetconn
      - 18.5.21.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.21.1 - Transfering minimizeinetconn.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/minimizeinetconn_185211.pol
      dest: C:\facts\policyfiles\minimizeinetconn_185211.pol
    when:
      - minimizeinetconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minimizeinetconn
      - 18.5.21.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.21.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\minimizeinetconn_185211.pol
    when:
      - minimizeinetconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - minimizeinetconn
      - 18.5.21.1
      - eighteen
      - remedy
      - all
      
  - name: 18.5.21.2 (L2) - Fetching the prohconnnondomnet value from ansible facts
    win_shell: c:\facts\prohconnnondomnet_185212_audit.ps1
    register: prohconnnondomnet
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - prohconnnondomnet
      - 18.5.21.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.21.2 (L2) - Transfering prohconnnondomnet.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/prohconnnondomnet_185212.pol
      dest: C:\facts\policyfiles\prohconnnondomnet_185212.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - prohconnnondomnet.stdout.find("FAILED") != -1
    tags:
      - prohconnnondomnet
      - 18.5.21.2
      - eighteen
      - remedy
      - all
      
  - name: 18.5.21.2 (L2) - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\prohconnnondomnet_185212.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - prohconnnondomnet.stdout.find("FAILED") != -1
    tags:
      - prohconnnondomnet
      - 18.5.21.2
      - eighteen
      - remedy
      - all
      
  - name: 18.7.1.1 (L2) Fetching the offnotifnetusage value from ansible facts
    win_shell: c:\facts\offnotifnetusage_18711_audit.ps1
    register: offnotifnetusage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - offnotifnetusage
      - 18.7.1.1
      - eighteen
      - remedy
      - all
      
  - name: 18.7.1.1 - Transfering offnotifnetusage.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/offnotifnetusage_18711.pol
      dest: C:\facts\policyfiles\offnotifnetusage_18711.pol
    when:
      - offnotifnetusage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - offnotifnetusage
      - 18.7.1.1
      - eighteen
      - remedy
      - all
      
  - name: 18.7.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\offnotifnetusage_18711.pol
    when:
      - offnotifnetusage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - offnotifnetusage
      - 18.7.1.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.3.1 - Fetching the cmdlineprocesscreate value from ansible facts
    win_shell: c:\facts\cmdlineprocesscreate_18831_audit.ps1
    register: cmdlineprocesscreate
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - cmdlineprocesscreate
      - 18.8.3.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.3.1 - Transfering cmdlineprocesscreate.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/cmdlineprocesscreate_18831.pol
      dest: C:\facts\policyfiles\cmdlineprocesscreate_18831.pol
    when:
      - cmdlineprocesscreate.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - cmdlineprocesscreate
      - 18.8.3.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.3.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\cmdlineprocesscreate_18831.pol
    when:
      - cmdlineprocesscreate.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - cmdlineprocesscreate
      - 18.8.3.1
      - eighteen
      - remedy
      - all

  - name: 18.8.4.1 Fetching the encryptoraclerem value from ansible facts
    win_shell: c:\facts\encryptoraclerem_18841_audit.ps1
    register: encryptoraclerem
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - encryptoraclerem
      - 18.8.4.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.4.1 - Transfering encryptoraclerem.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/encryptoraclerem_18841.pol
      dest: C:\facts\policyfiles\encryptoraclerem_18841.pol
    when:
      - encryptoraclerem.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - encryptoraclerem
      - 18.8.4.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.4.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\encryptoraclerem_18841.pol
    when:
      - encryptoraclerem.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - encryptoraclerem
      - 18.8.4.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.4.2 - Fetching the nonexportablecred value from ansible facts
    win_shell: c:\facts\nonexportablecred_18842_audit.ps1     
    register: nonexportablecred
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - nonexportablecred
      - 18.8.4.2
      - eighteen
      - remedy
      - all
      
  - name: 18.8.4.2 - Transfering nonexportablecred.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/nonexportablecred_18842.pol
      dest: C:\facts\policyfiles\nonexportablecred_18842.pol
    when:
      - nonexportablecred.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - nonexportablecred
      - 18.8.4.2
      - eighteen
      - remedy
      - all
      
  - name: 18.8.4.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\nonexportablecred_18842.pol
    when:
      - nonexportablecred.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - nonexportablecred
      - 18.8.4.2
      - eighteen
      - remedy
      - all

  - name: 18.8.14.1 - Fetching the bootstartdrivpolicy value from ansible facts
    win_shell: c:\facts\bootstartdrivpolicy_188141_audit.ps1
    register: bootstartdrivpolicy
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - bootstartdrivpolicy
      - 18.8.14.1
      - eighteen
      - remedy
      - all

  - name: 18.8.14.1 - Transfering the bootstartdrivpolicy.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/bootstartdrivpolicy_188141.pol
      dest: C:\facts\policyfiles\bootstartdrivpolicy_188141.pol
    when:
      - bootstartdrivpolicy.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - bootstartdrivpolicy
      - 18.8.14.1
      - eighteen
      - remedy
      - all

  - name: 18.8.14.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\bootstartdrivpolicy_188141.pol
    when:
      - bootstartdrivpolicy.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - bootstartdrivpolicy
      - 18.8.14.1
      - eighteen
      - remedy
      - all

  - name: 18.8.21.1 - Fetching the regpolbackgrdprocess value from ansible facts
    win_shell: c:\facts\regpolbackgrdprocess_188211_audit.ps1
    register: regpolbackgrdprocess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - regpolbackgrdprocess
      - 18.8.21.1
      - eighteen
      - remedy
      - all

  - name: 18.8.21.1 - Transfering the regpolbackgrdprocess.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/regpolbackgrdprocess_188211.pol
      dest: C:\facts\policyfiles\regpolbackgrdprocess_188211.pol
    when:
      - regpolbackgrdprocess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - regpolbackgrdprocess
      - 18.8.21.1
      - eighteen
      - remedy
      - all

  - name: 18.8.21.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\regpolbackgrdprocess_188211.pol
    when:
      - regpolbackgrdprocess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - regpolbackgrdprocess
      - 18.8.21.1
      - eighteen
      - remedy
      - all

  - name: 18.8.21.2 - Fetching the regpolgrppolicychg value from ansible facts
    win_shell: c:\facts\regpolgrppolicychg_188212_audit.ps1
    register: regpolgrppolicychg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - regpolgrppolicychg
      - 18.8.21.2
      - eighteen
      - remedy
      - all

  - name: 18.8.21.2 - Transfering the regpolgrppolicychg.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/regpolgrppolicychg_188212.pol
      dest: C:\facts\policyfiles\regpolgrppolicychg_188212.pol
    when:
      - regpolgrppolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - regpolgrppolicychg
      - 18.8.21.2
      - eighteen
      - remedy
      - all

  - name: 18.8.21.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\regpolgrppolicychg_188212.pol
    when:
      - regpolgrppolicychg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - regpolgrppolicychg
      - 18.8.21.2
      - eighteen
      - remedy
      - all

  - name: 18.8.21.3 - Fetching the backgrprefresh value from ansible facts
    win_shell: c:\facts\backgrprefresh_188213_audit.ps1
    register: backgrprefresh
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - backgrprefresh
      - 18.8.21.3
      - eighteen
      - remedy
      - all

  - name: 18.8.21.3 - Transfering the backgrprefresh.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/backgrprefresh_188213.pol
      dest: C:\facts\policyfiles\backgrprefresh_188213.pol
    when:
      - backgrprefresh.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - backgrprefresh
      - 18.8.21.3
      - eighteen
      - remedy
      - all

  - name: 18.8.21.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\backgrprefresh_188213.pol
    when:
      - backgrprefresh.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - backgrprefresh
      - 18.8.21.3
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.1 - Fetching the turnoffprintdriver value from ansible facts
    win_shell: c:\facts\turnoffprintdriver_1882211_audit.ps1
    register: turnoffprintdriver
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffprintdriver
      - 18.8.22.1.1
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.1 - Transfering the turnoffprintdriver.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffprintdriver_1882211.pol
      dest: C:\facts\policyfiles\turnoffprintdriver_1882211.pol
    when:
      - turnoffprintdriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffprintdriver
      - 18.8.22.1.1
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffprintdriver_1882211.pol
    when:
      - turnoffprintdriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffprintdriver
      - 18.8.22.1.1
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.2 (L2) Fetching the turnoffdatasharing value from ansible facts
    win_shell: c:\facts\turnoffdatasharing_1882212_audit.ps1     
    register: turnoffdatasharing
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffdatasharing
      - 18.8.22.1.2
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.2 - Transfering the turnoffdatasharing.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffdatasharing_1882212.pol
      dest: C:\facts\policyfiles\turnoffdatasharing_1882212.pol
    when:
      - turnoffdatasharing.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffdatasharing
      - 18.8.22.1.2
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffdatasharing_1882212.pol
    when:
      - turnoffdatasharing.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffdatasharing
      - 18.8.22.1.2
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.3 (L2) Fetching the turnofferrorreport value from ansible facts
    win_shell: c:\facts\turnofferrorreport_1882213_audit.ps1     
    register: turnofferrorreport
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofferrorreport
      - 18.8.22.1.3
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.3 - Transfering the turnofferrorreport.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnofferrorreport_1882213.pol
      dest: C:\facts\policyfiles\turnofferrorreport_1882213.pol
    when:
      - turnofferrorreport.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofferrorreport
      - 18.8.22.1.3
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnofferrorreport_1882213.pol
    when:
      - turnofferrorreport.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofferrorreport
      - 18.8.22.1.3
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.4 (L2) Fetching the turnoffinetconnwiz value from ansible facts
    win_shell: c:\facts\turnoffinetconnwiz_1882214_audit.ps1     
    register: turnoffinetconnwiz
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffinetconnwiz
      - 18.8.22.1.4
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.4 - Transfering the turnoffinetconnwiz.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffinetconnwiz_1882214.pol
      dest: C:\facts\policyfiles\turnoffinetconnwiz_1882214.pol
    when:
      - turnoffinetconnwiz.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffinetconnwiz
      - 18.8.22.1.4
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffinetconnwiz_1882214.pol
    when:
      - turnoffinetconnwiz.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffinetconnwiz
      - 18.8.22.1.4
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.5 Fetching the turnoffinetdownload value from ansible facts
    win_shell: c:\facts\turnoffinetdownload_1882215_audit.ps1
    register: turnoffinetdownload
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffinetdownload
      - 18.8.22.1.5
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.5 - Transfering the turnoffinetdownload.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffinetdownload_1882215.pol
      dest: C:\facts\policyfiles\turnoffinetdownload_1882215.pol
    when:
      - turnoffinetdownload.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffinetdownload
      - 18.8.22.1.5
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.5 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffinetdownload_1882215.pol
    when:
      - turnoffinetdownload.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffinetdownload
      - 18.8.22.1.5
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.6 Fetching the turnoffprinting value from ansible facts
    win_shell: c:\facts\turnoffprinting_1882216_audit.ps1
    register: turnoffprinting
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffprinting
      - 18.8.22.1.6
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.6 - Transfering the turnoffprinting.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffprinting_1882216.pol
      dest: C:\facts\policyfiles\turnoffprinting_1882216.pol
    when:
      - turnoffprinting.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffprinting
      - 18.8.22.1.6
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.6 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffprinting_1882216.pol
    when:
      - turnoffprinting.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffprinting
      - 18.8.22.1.6
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.7 (L2) Fetching the turnoffregistry value from ansible facts
    win_shell: c:\facts\turnoffregistry_1882217_audit.ps1
    register: turnoffregistry
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffregistry
      - 18.8.22.1.7
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.7 - Transfering the turnoffregistry.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffregistry_1882217.pol
      dest: C:\facts\policyfiles\turnoffregistry_1882217.pol
    when:
      - turnoffregistry.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffregistry
      - 18.8.22.1.7
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.7 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffregistry_1882217.pol
    when:
      - turnoffregistry.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffregistry
      - 18.8.22.1.7
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.8 (L2) Fetching the turnoffsearchcomp value from ansible facts
    win_shell: c:\facts\turnoffsearchcomp_1882218_audit.ps1
    register: turnoffsearchcomp
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffsearchcomp
      - 18.8.22.1.8
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.8 - Transfering the turnoffsearchcomp.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffsearchcomp_1882218.pol
      dest: C:\facts\policyfiles\turnoffsearchcomp_1882218.pol
    when:
      - turnoffsearchcomp.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffsearchcomp
      - 18.8.22.1.8
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.8 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffsearchcomp_1882218.pol
    when:
      - turnoffsearchcomp.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffsearchcomp
      - 18.8.22.1.8
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.9 (L2) Fetching the turnofforderprints value from ansible facts
    win_shell: c:\facts\turnofforderprints_1882219_audit.ps1
    register: turnofforderprints
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofforderprints
      - 18.8.22.1.9
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.9 - Transfering the turnofforderprints.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnofforderprints_1882219.pol
      dest: C:\facts\policyfiles\turnofforderprints_1882219
    when:
      - turnofforderprints.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofforderprints
      - 18.8.22.1.9
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.9 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnofforderprints_1882219
    when:
      - turnofforderprints.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofforderprints
      - 18.8.22.1.9
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.10 (L2) Fetching the turnoffpublishweb value from ansible facts
    win_shell: c:\facts\turnoffpublishweb_18822110_audit.ps1
    register: turnoffpublishweb
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpublishweb
      - 18.8.22.1.10
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.10 - Transfering the 18.8.22.1.10.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffpublishweb_18822110.pol
      dest: C:\facts\policyfiles\turnoffpublishweb_18822110.pol
    when:
      - turnoffpublishweb.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpublishweb
      - 18.8.22.1.10
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.10 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffpublishweb_18822110.pol
    when:
      - turnoffpublishweb.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpublishweb
      - 18.8.22.1.10
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.11 (L2) Fetching the turnoffwmceip value from ansible facts
    win_shell: c:\facts\turnoffwmceip_18822111_audit.ps1
    register: turnoffwmceip
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwmceip
      - 18.8.22.1.11
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.11 - Transfering the turnoffwmceip.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffwmceip_18822111.pol
      dest: C:\facts\policyfiles\turnoffwmceip_18822111.pol
    when:
      - turnoffwmceip.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwmceip
      - 18.8.22.1.11
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.11 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffwmceip_18822111.pol
    when:
      - turnoffwmceip.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwmceip
      - 18.8.22.1.11
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.12 (L2) Fetching the turnoffwceip value from ansible facts
    win_shell: c:\facts\turnoffwceip_18822112_audit.ps1
    register: turnoffwceip
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwceip
      - 18.8.22.1.12
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.12 - Transfering the turnoffwceip.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffwceip_18822112.pol
      dest: C:\facts\policyfiles\turnoffwceip_18822112.pol
    when:
      - turnoffwceip.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwceip
      - 18.8.22.1.12
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.12 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffwceip_18822112.pol
    when:
      - turnoffwceip.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwceip
      - 18.8.22.1.12
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.13 (L2) Fetching the turnoffwinerrorep value from ansible facts
    win_shell: c:\facts\turnoffwinerrorep_18822113_audit.ps1
    register: turnoffwinerrorep
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwinerrorep
      - 18.8.22.1.13
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.13 - Transfering the turnoffwinerrorep.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffwinerrorep_18822113.pol
      dest: C:\facts\policyfiles\turnoffwinerrorep_18822113.pol
    when:
      - turnoffwinerrorep.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwinerrorep
      - 18.8.22.1.13
      - eighteen
      - remedy
      - all

  - name: 18.8.22.1.13 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffwinerrorep_18822113.pol
    when:
      - turnoffwinerrorep.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwinerrorep
      - 18.8.22.1.13
      - eighteen
      - remedy
      - all

  - name: 18.8.27.1 (L2) Fetching the disallowcopyusrinput value from ansible facts
    win_shell: c:\facts\disallowcopyusrinput_188271_audit.ps1
    register: disallowcopyusrinput 
    ignore_errors: True
    tags:
      - disallowcopyusrinput
      - 18.8.27.1
      - eighteen
      - remedy
      - all
      
  - name: 18.8.27.1 - Transfering the disallowcopyusrinput.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/disallowcopyusrinput_188271.pol
      dest: C:\facts\policyfiles\disallowcopyusrinput_188271.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowcopyusrinput
      - 18.8.27.1
      - eighteen
      - remedy
      - all

  - name: 18.8.27.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\disallowcopyusrinput_188271.pol
    when:
      - disallowcopyusrinput.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowcopyusrinput
      - 18.8.27.1
      - eighteen
      - remedy
      - all

  - name: 18.8.28.1 Fetching the dontdisplaynetui value from ansible facts
    win_shell: c:\facts\dontdisplaynetui_188281_audit.ps1
    register: dontdisplaynetui
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdisplaynetui
      - 18.8.28.1
      - eighteen
      - remedy
      - all

  - name: 18.8.28.1 - Transfering the dontdisplaynetui.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontdisplaynetui_188281.pol
      dest: C:\facts\policyfiles\dontdisplaynetui_188281.pol
    when:
      - dontdisplaynetui.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdisplaynetui
      - 18.8.28.1
      - eighteen
      - remedy
      - all

  - name: 18.8.28.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontdisplaynetui_188281.pol
    when:
      - dontdisplaynetui.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdisplaynetui
      - 18.8.28.1
      - eighteen
      - remedy
      - all

  - name: 18.8.28.2 Fetching the dontenumconnusr value from ansible facts
    win_shell: c:\facts\dontenumconnusr_188282_audit.ps1
    register: dontenumconnusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontenumconnusr
      - 18.8.28.2
      - eighteen
      - remedy
      - all

  - name: 18.8.28.2 - Transfering the dontenumconnusr.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontenumconnusr_188282.pol
      dest: C:\facts\policyfiles\dontenumconnusr_188282.pol
    when:
      - dontenumconnusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontenumconnusr
      - 18.8.28.2
      - eighteen
      - remedy
      - all

  - name: 18.8.28.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontenumconnusr_188282.pol
    when:
      - dontenumconnusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontenumconnusr
      - 18.8.28.2
      - eighteen
      - remedy
      - all

  - name: 18.8.28.3 Fetching the enumlocalusr value from ansible facts
    win_shell: c:\facts\enumlocalusr_188283_audit.ps1
    register: enumlocalusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - enumlocalusr
      - 18.8.28.3
      - eighteen
      - remedy
      - all

  - name: 18.8.28.3 - Transfering the enumlocalusr.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enumlocalusr_188283.pol
      dest: C:\facts\policyfiles\enumlocalusr_188283.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - enumlocalusr.stdout.find("FAILED") != -1
    tags:
      - enumlocalusr
      - 18.8.28.3
      - eighteen
      - remedy
      - all

  - name: 18.8.28.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enumlocalusr_188283.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - enumlocalusr.stdout.find("FAILED") != -1
    tags:
      - enumlocalusr
      - 18.8.28.3
      - eighteen
      - remedy
      - all

  - name: 18.8.28.4 Fetching the turnoffappnotfic value from ansible facts
    win_shell: c:\facts\turnoffappnotfic_188284_audit.ps1
    register: turnoffappnotfic
    ignore_errors: True 
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffappnotfic
      - 18.8.28.4
      - eighteen
      - remedy
      - all

  - name: 18.8.28.4 - Transfering the turnoffappnotfic.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffappnotfic_188284.pol
      dest: C:\facts\policyfiles\turnoffappnotfic_188284.pol
    when:
      - turnoffappnotfic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffappnotfic
      - 18.8.28.4
      - eighteen
      - remedy
      - all

  - name: 18.8.28.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffappnotfic_188284.pol
    when:
      - turnoffappnotfic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffappnotfic
      - 18.8.28.4
      - eighteen
      - remedy
      - all

  - name: 18.8.28.5 Fetching the turnoffpicpwdsignin value from ansible facts
    win_shell: c:\facts\turnoffpicpwdsignin_188285_audit.ps1
    register: turnoffpicpwdsignin
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpicpwdsignin
      - 18.8.28.5
      - eighteen
      - remedy
      - all

  - name: 18.8.28.5 - Transfering the turnoffpicpwdsignin.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffpicpwdsignin_188285.pol
      dest: C:\facts\policyfiles\turnoffpicpwdsignin_188285.pol
    when:
      - turnoffpicpwdsignin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpicpwdsignin
      - 18.8.28.5
      - eighteen
      - remedy
      - all

  - name: 18.8.28.5 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffpicpwdsignin_188285.pol
    when:
      - turnoffpicpwdsignin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpicpwdsignin
      - 18.8.28.5
      - eighteen
      - remedy
      - all

  - name: 18.8.28.6 Fetching the turnoffpinsignin value from ansible facts
    win_shell: c:\facts\turnoffpinsignin_188286_audit.ps1
    register: turnoffpinsignin
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpinsignin
      - 18.8.28.6
      - eighteen
      - remedy
      - all

  - name: 18.8.28.6 - Transfering the turnoffpinsignin.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffpinsignin_188286.pol
      dest: C:\facts\policyfiles\turnoffpinsignin_188286.pol
    when:
      - turnoffpinsignin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpinsignin
      - 18.8.28.6
      - eighteen
      - remedy
      - all

  - name: 18.8.28.6 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffpinsignin_188286.pol
    when:
      - turnoffpinsignin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffpinsignin
      - 18.8.28.6
      - eighteen
      - remedy
      - all

  - name: 18.8.34.6.1 - Fetching the pwdcompwakesonbattery value from ansible facts
    win_shell: c:\facts\pwdcompwakesonbattery_1883461_audit.ps1
    register: pwdcompwakesonbattery
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcompwakesonbattery
      - 18.8.34.6.1
      - eighteen
      - remedy
      - all

  - name: 18.8.34.6.1 - Transfering the pwdcompwakesonbattery.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdcompwakesonbattery_1883461.pol
      dest: C:\facts\policyfiles\pwdcompwakesonbattery_1883461.pol
    when:
      - pwdcompwakesonbattery.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcompwakesonbattery
      - 18.8.34.6.1
      - eighteen
      - remedy
      - all

  - name: 18.8.34.6.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdcompwakesonbattery_1883461.pol
    when:
      - pwdcompwakesonbattery.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcompwakesonbattery
      - 18.8.34.6.1
      - eighteen
      - remedy
      - all

  - name: 18.8.34.6.2 - Fetching the pwdcompwakespluggedin value from ansible facts
    win_shell: c:\facts\pwdcompwakespluggedin_1883462_audit.ps1
    register: pwdcompwakespluggedin
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcompwakespluggedin
      - 18.8.34.6.2
      - eighteen
      - remedy
      - all

  - name: 18.8.34.6.2 - Transfering the pwdcompwakespluggedin.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdcompwakespluggedin_1883462.pol
      dest: C:\facts\policyfiles\pwdcompwakespluggedin_1883462.pol
    when:
      - pwdcompwakespluggedin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcompwakespluggedin
      - 18.8.34.6.2
      - eighteen
      - remedy
      - all

  - name: 18.8.34.6.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdcompwakespluggedin_1883462.pol
    when:
      - pwdcompwakespluggedin.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdcompwakespluggedin
      - 18.8.34.6.2
      - eighteen
      - remedy
      - all

  - name: 18.8.36.1 - Fetching the confofferremoteassist value from ansible facts
    win_shell: c:\facts\confofferremoteassist_188361_audit.ps1
    register: confofferremoteassist
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confofferremoteassist
      - 18.8.36.1
      - eighteen
      - remedy
      - all

  - name: 18.8.36.1 - Transfering the confofferremoteassist.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confofferremoteassist_188361.pol
      dest: C:\facts\policyfiles\confofferremoteassist_188361.pol
    when:
      - confofferremoteassist.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confofferremoteassist
      - 18.8.36.1
      - eighteen
      - remedy
      - all

  - name: 18.8.36.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confofferremoteassist_188361.pol
    when:
      - confofferremoteassist.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confofferremoteassist
      - 18.8.36.1
      - eighteen
      - remedy
      - all

  - name: 18.8.36.2 Fetching the confsolicremoteassist value from ansible facts
    win_shell: c:\facts\confsolicremoteassist_188362_audit.ps1
    register: confsolicremoteassist
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsolicremoteassist
      - 18.8.36.2
      - eighteen
      - remedy
      - all

  - name: 18.8.36.2 - Transfering the disallowcopyusrinput.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confsolicremoteassist_188362.pol
      dest: C:\facts\policyfiles\confsolicremoteassist_188362.pol
    when:
      - confsolicremoteassist.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsolicremoteassist
      - 18.8.36.2
      - eighteen
      - remedy
      - all

  - name: 18.8.36.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confsolicremoteassist_188362.pol
    when:
      - confsolicremoteassist.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confsolicremoteassist
      - 18.8.36.2
      - eighteen
      - remedy
      - all

  - name: 18.8.37.1 Fetching the rpcemcliauthen value from ansible facts
    win_shell: c:\facts\rpcemcliauthen_188371_audit.ps1
    register: rpcemcliauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - rpcemcliauthen
      - 18.8.37.1
      - eighteen
      - remedy
      - all

  - name: 18.8.37.1 - Transfering the rpcemcliauthen.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/rpcemcliauthen_188371.pol
      dest: C:\facts\policyfiles\rpcemcliauthen_188371.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - rpcemcliauthen.stdout.find("FAILED") != -1
    tags:
      - rpcemcliauthen
      - 18.8.37.1
      - eighteen
      - remedy
      - all

  - name: 18.8.37.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\rpcemcliauthen_188371.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - rpcemcliauthen.stdout.find("FAILED") != -1
    tags:
      - rpcemcliauthen
      - 18.8.37.1
      - eighteen
      - remedy
      - all

  - name: 18.8.37.2 (L2) - Fetching the unauthenrpccli value from ansible facts
    win_shell: c:\facts\unauthenrpccli_188372_audit.ps1
    register: unauthenrpccli
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - unauthenrpccli
      - 18.8.37.2
      - eighteen
      - remedy
      - all

  - name: 18.8.37.2 - Transfering the unauthenrpccli.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/unauthenrpccli_188372.pol
      dest: C:\facts\policyfiles\unauthenrpccli_188372.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - unauthenrpccli.stdout.find("FAILED") != -1
    tags:
      - unauthenrpccli
      - 18.8.37.2
      - eighteen
      - remedy
      - all

  - name: 18.8.37.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\unauthenrpccli_188372.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - unauthenrpccli.stdout.find("FAILED") != -1
    tags:
      - unauthenrpccli
      - 18.8.37.2
      - eighteen
      - remedy
      - all

  - name: 18.8.47.5.1 (L2) - Fetching the msdiagnostictool value from ansible facts
    win_shell: c:\facts\msdiagnostictool_1884751_audit.ps1
    register: msdiagnostictool
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msdiagnostictool
      - 18.8.47.5.1
      - eighteen
      - remedy
      - all

  - name: 18.8.47.5.1 - Transfering the msdiagnostictool.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/msdiagnostictool_1884751.pol
      dest: C:\facts\policyfiles\msdiagnostictool_1884751.pol
    when:
      - msdiagnostictool.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msdiagnostictool
      - 18.8.47.5.1
      - eighteen
      - remedy
      - all

  - name: 18.8.47.5.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\msdiagnostictool_1884751.pol
    when:
      - msdiagnostictool.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - msdiagnostictool
      - 18.8.47.5.1
      - eighteen
      - remedy
      - all

  - name: 18.8.47.11.1 (L2) - Fetching the perftrack value from ansible facts
    win_shell: c:\facts\perftrack_18847111_audit.ps1
    register: perftrack
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - perftrack
      - 18.8.47.11.1
      - eighteen
      - remedy
      - all

  - name: 18.8.47.11.1 - Transfering the perftrack.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/perftrack_18847111.pol
      dest: C:\facts\policyfiles\\perftrack_18847111.pol
    when:
      - perftrack.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - perftrack
      - 18.8.47.11.1
      - eighteen
      - remedy
      - all

  - name: 18.8.47.11.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\perftrack_18847111.pol
    when:
      - perftrack.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - perftrack
      - 18.8.47.11.1
      - eighteen
      - remedy
      - all

  - name: 18.8.49.1 (L2) - Fetching the turnoffadvertid value from ansible facts
    win_shell: c:\facts\turnoffadvertid_188491_audit.ps1
    register: turnoffadvertid
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffadvertid
      - 18.8.49.1
      - eighteen
      - remedy
      - all

  - name: 18.8.49.1 - Transfering the turnoffadvertid.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffadvertid_188491.pol
      dest: C:\facts\policyfiles\turnoffadvertid_188491.pol
    when:
      - turnoffadvertid.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffadvertid
      - 18.8.49.1
      - eighteen
      - remedy
      - all

  - name: 18.8.49.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffadvertid_188491.pol
    when:
      - turnoffadvertid.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffadvertid
      - 18.8.49.1
      - eighteen
      - remedy
      - all

  - name: 18.8.52.1.1 (L2) - Fetching the enablewinntpcli value from ansible facts
    win_shell: c:\facts\enablewinntpcli_1885211_audit.ps1
    register: enablewinntpcli
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablewinntpcli
      - 18.8.52.1.1
      - eighteen
      - remedy
      - all

  - name: 18.8.52.1.1 - Transfering the enablewinntpcli.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enablewinntpcli_1885211.pol
      dest: C:\facts\policyfiles\enablewinntpcli_1885211.pol
    when:
      - enablewinntpcli.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablewinntpcli
      - 18.8.52.1.1
      - eighteen
      - remedy
      - all

  - name: 18.8.52.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enablewinntpcli_1885211.pol
    when:
      - enablewinntpcli.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablewinntpcli
      - 18.8.52.1.1
      - eighteen
      - remedy
      - all

  - name: 18.8.52.1.2 (L2) - Fetching the enablewinntpserv value from ansible facts
    win_shell: c:\facts\enablewinntpserv_1885212_audit.ps1
    register: enablewinntpserv
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
    tags:
      - enablewinntpserv
      - 18.8.52.1.2
      - eighteen
      - remedy
      - all

  - name: 18.8.52.1.2 - Transfering the enablewinntpserv.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enablewinntpserv_1885212.pol
      dest: C:\facts\policyfiles\enablewinntpserv_1885212.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - enablewinntpserv.stdout.find("FAILED") != -1
    tags:
      - enablewinntpserv
      - 18.8.52.1.2
      - eighteen
      - remedy
      - all

  - name: 18.8.52.1.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enablewinntpserv_1885212.pol
    when:
      - (server_type.stdout_lines[1] | regex_search('3')) == '3'
      - enablewinntpserv.stdout.find("FAILED") != -1
    tags:
      - enablewinntpserv
      - 18.8.52.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.6.1 Fetching the allowmsacc value from ansible facts
    win_shell: c:\facts\allowmsacc_18961_audit.ps1
    register: allowmsacc
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowmsacc
      - 18.9.6.1
      - eighteen
      - remedy
      - all

  - name: 18.9.6.1 - Transfering the allowmsacc.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowmsacc_18961.pol
      dest: C:\facts\policyfiles\allowmsacc_18961.pol
    when:
      - allowmsacc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowmsacc
      - 18.9.6.1
      - eighteen
      - remedy
      - all

  - name: 18.9.6.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowmsacc_18961.pol
    when:
      - allowmsacc.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowmsacc
      - 18.9.6.1
      - eighteen
      - remedy
      - all

  - name: 18.9.8.1 Fetching the autoplaynonvoldev value from ansible facts
    win_shell: c:\facts\autoplaynonvoldev_18981_audit.ps1
    register: autoplaynonvoldev
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - autoplaynonvoldev
      - 18.9.8.1
      - eighteen
      - remedy
      - all

  - name: 18.9.8.1 - Transfering the autoplaynonvoldev.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/autoplaynonvoldev_18981.pol
      dest: C:\facts\policyfiles\autoplaynonvoldev_18981.pol
    when:
      - autoplaynonvoldev.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - autoplaynonvoldev
      - 18.9.8.1
      - eighteen
      - remedy
      - all

  - name: 18.9.8.1- Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\autoplaynonvoldev_18981.pol
    when:
      - autoplaynonvoldev.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - autoplaynonvoldev
      - eighteen
      - 18.9.8.1
      - remedy
      - all

  - name: 18.9.8.2 Fetching the defaultautorun value from ansible facts
    win_shell: c:\facts\defaultautorun_18982_audit.ps1
    register: defaultautorun
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - defaultautorun
      - 18.9.8.2
      - eighteen
      - remedy
      - all

  - name: 18.9.8.2 - Transfering the defaultautorun.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/defaultautorun_18982.pol
      dest: C:\facts\policyfiles\defaultautorun_18982.pol
    when:
      - defaultautorun.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - defaultautorun
      - 18.9.8.2
      - eighteen
      - remedy
      - all

  - name: 18.9.8.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\defaultautorun_18982.pol
    when:
      - defaultautorun.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - defaultautorun
      - 18.9.8.2
      - eighteen
      - remedy
      - all
      
  - name: 18.9.8.3 Fetching the turnoffautoplay value from ansible facts
    win_shell: c:\facts\turnoffautoplay_18983_audit.ps1
    register: turnoffautoplay
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffautoplay
      - 18.9.8.3
      - eighteen
      - remedy
      - all

  - name: 18.9.8.3 - Transfering the turnoffautoplay.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffautoplay_18983.pol
      dest: C:\facts\policyfiles\turnoffautoplay_18983.pol
    when:
      - turnoffautoplay.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffautoplay
      - 18.9.8.3
      - eighteen
      - remedy
      - all

  - name: 18.9.8.3- Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffautoplay_18983.pol
    when:
      - turnoffautoplay.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffautoplay
      - 18.9.8.3
      - eighteen
      - remedy
      - all
      
  - name: 18.9.15.1 - Fetching the pwdrevealbutton value from ansible facts
    win_shell: c:\facts\pwdrevealbutton_189151_audit.ps1
    register: pwdrevealbutton
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdrevealbutton
      - 18.9.15.1
      - eighteen
      - remedy
      - all   
      
  - name: 18.9.15.1 - Transfering the pwdrevealbutton.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdrevealbutton_189151.pol
      dest: C:\facts\policyfiles\pwdrevealbutton_189151.pol
    when:
      - pwdrevealbutton.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdrevealbutton
      - 18.9.15.1
      - eighteen
      - remedy
      - all

  - name: 18.9.15.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdrevealbutton_189151.pol
    when:
      - pwdrevealbutton.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdrevealbutton
      - 18.9.15.1
      - eighteen
      - remedy
      - all
      
  - name: 18.9.15.2 - Fetching the admaccelevation value from ansible facts
    win_shell: c:\facts\admaccelevation_189152_audit.ps1
    register: admaccelevation
    ignore_errors: True
    tags:
      - admaccelevation
      - 18.9.15.2
      - eighteen
      - remedy
      - all     
  
  - name: 18.9.15.2 -  Transfering the admaccelevation.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/admaccelevation_189152.pol
      dest: C:\facts\policyfiles\admaccelevation_189152.pol
    when:
      - admaccelevation.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - admaccelevation
      - 18.9.15.2
      - eighteen
      - remedy
      - all

  - name: 18.9.15.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\admaccelevation_189152.pol
    when:
      - admaccelevation.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - admaccelevation
      - 18.9.15.2
      - eighteen
      - remedy
      - all

  - name: 18.9.24.1 - Fetching the emet value from ansible facts
    win_shell: c:\facts\emet_189241_audit.ps1
    register: emet
    ignore_errors: True
    tags:
      - emet
      - eighteen
      - remedy
      - 18.9.24.1
      - all    

  - name: 18.9.24.1 - Copying EMET.msi
    win_copy:
      src: ../files/emet_exe/EMET Setup.msi
      dest: C:\Program Files (x86)\EMET Setup.msi
    when: emet.stdout.find("FAILED") != -1
    tags:
      - emet
      - eighteen
      - remedy
      - 18.9.24.1
      - all

  - name: 18.9.24.1 - Install emet MSI file
    win_package:
      path: C:\Program Files (x86)\EMET Setup.msi
      state: present
    when: emet.stdout.find("FAILED") != -1 
    tags:
      - emet
      - eighteen
      - 18.9.24.1
      - remedy
      - all
  
  - name: 18.9.24.1 - Copy admx file to policy def
    win_copy:
      src: C:\Program Files (x86)\EMET 5.5\Deployment\Group Policy Files\EMET.admx
      dest: C:\Windows\PolicyDefinitions\EMET.admx
      remote_src: yes
    when:
      - emet.stdout.find("FAILED") != -1 
    tags:
      - emet
      - 18.9.24.1
      - eighteen
      - remedy
      - all

  - name: 18.9.24.1 - Copy adml file to policy def
    win_copy:
      src: C:\Program Files (x86)\EMET 5.5\Deployment\Group Policy Files\EMET.adml
      dest: C:\Windows\PolicyDefinitions\en-US\EMET.adml
      remote_src: yes
    when:
      - emet.stdout.find("FAILED") != -1 
    tags:
      - emet
      - 18.9.24.1
      - eighteen
      - remedy
      - all
       
  - pause: seconds=2
    when:
      - emet.stdout.find("FAILED") != -1 
    tags:
      - emet
      - 18.9.24.1
      - eighteen
      - remedy
      - all

  - name: 18.9.24.2 - Fetching enmitigationsetting value from ansible facts
    win_shell: c:\facts\enmitigationsetting_189242_audit.ps1
    register: enmitigationsetting
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enmitigationsetting
      - 18.9.24.2
      - eighteen
      - remedy
      - all

  - name: 18.9.24.2 - Transfering the enmitigationsetting.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enmitigationsetting_189242.pol
      dest: C:\facts\policyfiles\enmitigationsetting_189242.pol
    when:
      - enmitigationsetting.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enmitigationsetting
      - 18.9.24.2
      - eighteen
      - remedy
      - all

  - name: 18.9.24.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enmitigationsetting_189242.pol
    when:
      - enmitigationsetting.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enmitigationsetting
      - 18.9.24.2
      - eighteen
      - remedy
      - all

  - name: 18.9.24.3 - Fetching endefaultie value from ansible facts
    win_shell: c:\facts\endefaultie_189243_audit.ps1
    register: endefaultie
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefaultie
      - 18.9.24.3
      - eighteen
      - remedy
      - all

  - name: 18.9.24.3 - Transfering the endefaultie_189243_audit.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/endefaultie_189243.pol
      dest: C:\facts\policyfiles\endefaultie_189243.pol
    when:
      - endefaultie.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefaultie
      - 18.9.24.3
      - eighteen
      - remedy
      - all

  - name: 18.9.24.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\endefaultie_189243.pol
    when:
      - endefaultie.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefaultie
      - 18.9.24.3
      - eighteen
      - remedy
      - all

  - name: 18.9.24.4 - Fetching endefpopsoftware value from ansible facts
    win_shell: c:\facts\endefpopsoftware_189244_audit.ps1
    register: endefpopsoftware
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefpopsoftware
      - 18.9.24.4
      - eighteen
      - remedy
      - all

  - name: 18.9.24.4 - Transfering the endefpopsoftware.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/endefpopsoftware_189244.pol
      dest: C:\facts\policyfiles\endefpopsoftware_189244.pol
    when:
      - endefpopsoftware.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefpopsoftware
      - 18.9.24.4
      - eighteen
      - remedy
      - all

  - name: 18.9.24.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\endefpopsoftware_189244.pol
    when:
      - endefpopsoftware.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefpopsoftware
      - 18.9.24.4
      - eighteen
      - remedy
      - all

  - name: 18.9.24.5 - Fetching endefrecsofware value from ansible facts
    win_shell: c:\facts\endefrecsofware_189245_audit.ps1
    register: endefrecsofware
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefrecsofware
      - 18.9.24.5
      - eighteen
      - remedy
      - all

  - name: 18.9.24.5 - Transfering the endefrecsofware.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/endefrecsofware_189245.pol
      dest: C:\facts\policyfiles\endefrecsofware_189245.pol
    when:
      - endefrecsofware.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefrecsofware
      - 18.9.24.5
      - eighteen
      - remedy
      - all

  - name: 18.9.24.5 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\endefrecsofware_189245.pol
    when:
      - endefrecsofware.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - endefrecsofware
      - 18.9.24.5
      - eighteen
      - remedy
      - all

  - name: 18.9.24.6 - Fetching enappoptinaslr value from ansible facts
    win_shell: c:\facts\enappoptinaslr_189246_audit.ps1
    register: enappoptinaslr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptinaslr
      - 18.9.24.6
      - eighteen
      - remedy
      - all

  - name: 18.9.24.6 - Transfering the enappoptinaslr.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enappoptinaslr_189246.pol
      dest: C:\facts\policyfiles\enappoptinaslr_189246.pol
    when:
      - enappoptinaslr.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptinaslr
      - 18.9.24.6
      - eighteen
      - remedy
      - all

  - name: 18.9.24.6 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enappoptinaslr_189246.pol
    when:
      - enappoptinaslr.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptinaslr
      - 18.9.24.6
      - eighteen
      - remedy
      - all

  - name: 18.9.24.7 - Fetching enappoptoutdep value from ansible facts
    win_shell: c:\facts\enappoptoutdep_189247_audit.ps1
    register: enappoptoutdep
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptoutdep
      - 18.9.24.7
      - eighteen
      - remedy
      - all

  - name: 18.9.24.7 - Transfering the enappoptoutdep.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enappoptoutdep_189247.pol
      dest: C:\facts\policyfiles\enappoptoutdep_189247.pol
    when:
      - enappoptoutdep.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptoutdep
      - 18.9.24.7
      - eighteen
      - remedy
      - all

  - name: 18.9.24.7 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enappoptoutdep_189247.pol
    when:
      - enappoptoutdep.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptoutdep
      - 18.9.24.7
      - eighteen
      - remedy
      - all

  - name: 18.9.24.8 - Fetching enappoptoutsehop value from ansible facts
    win_shell: c:\facts\enappoptoutsehop_189248_audit.ps1
    register: enappoptoutsehop
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptoutsehop
      - 18.9.24.8
      - eighteen
      - remedy
      - all

  - name: 18.9.24.8 - Transfering the enappoptoutsehop.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enappoptoutsehop_189248.pol
      dest: C:\facts\policyfiles\enappoptoutsehop_189248.pol
    when:
      - enappoptoutsehop.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptoutsehop
      - 18.9.24.8
      - eighteen
      - remedy
      - all

  - name: 18.9.24.8 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enappoptoutsehop_189248.pol
    when:
      - enappoptoutsehop.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enappoptoutsehop
      - 18.9.24.8
      - eighteen
      - remedy
      - all

  - name: 18.9.26.1.1 - Fetching appcontroleventlog value from ansible facts
    win_shell: c:\facts\appcontroleventlog_1892611_audit.ps1
    register: appcontroleventlog
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - appcontroleventlog
      - 18.9.26.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.1.1 - Transfering the appcontroleventlog.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/appcontroleventlog_1892611.pol
      dest: C:\facts\policyfiles\appcontroleventlog_1892611.pol
    when:
      - appcontroleventlog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - appcontroleventlog
      - 18.9.26.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\appcontroleventlog_1892611.pol
    when:
      - appcontroleventlog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - appcontroleventlog
      - 18.9.26.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.1.2 - Fetching the appmaxlogfilesize value from ansible facts
    win_shell: c:\facts\appmaxlogfilesize_1892612_audit.ps1
    register: appmaxlogfilesize
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - appmaxlogfilesize
      - 18.9.26.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.1.2 - Transfering the appmaxlogfilesize.pol file 
    win_copy:
      src: ../files/group_policies/windows2012r2/appmaxlogfilesize_1892612.pol
      dest: C:\facts\policyfiles\appmaxlogfilesize_1892612.pol
    when:
      - appmaxlogfilesize.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - appmaxlogfilesize
      - 18.9.26.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.1.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\appmaxlogfilesize_1892612.pol
    when:
      - appmaxlogfilesize.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - appmaxlogfilesize
      - 18.9.26.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.2.1 - Fetching the securcontroleventlog value from ansible facts
    win_shell: c:\facts\securcontroleventlog_1892621_audit.ps1
    register: securcontroleventlog
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securcontroleventlog
      - 18.9.26.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.2.1 - Transfering the securcontroleventlog.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/securcontroleventlog_1892621.pol
      dest: C:\facts\policyfiles\securcontroleventlog_1892621.pol
    when:
      - securcontroleventlog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securcontroleventlog
      - 18.9.26.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.2.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\securcontroleventlog_1892621.pol
    when:
      - securcontroleventlog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securcontroleventlog
      - 18.9.26.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.2.2 - Fetching the securmaxlogfilesize value from ansible facts
    win_shell: c:\facts\securmaxlogfilesize_1892622_audit.ps1
    register: securmaxlogfilesize
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securmaxlogfilesize
      - 18.9.26.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.2.2 - Transfering the securmaxlogfilesize.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/securmaxlogfilesize_1892622.pol
      dest: C:\facts\policyfiles\securmaxlogfilesize_1892622.pol
    when:
      - securmaxlogfilesize.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securmaxlogfilesize
      - 18.9.26.2.2
      - eighteen
      - remedy
      - all
      
  - name: 18.9.26.2.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\securmaxlogfilesize_1892622.pol
    when:
      - securmaxlogfilesize.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securmaxlogfilesize
      - 18.9.26.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.3.1 - Fetching the setupcontroleventlog value from ansible facts
    win_shell: c:\facts\setupcontroleventlog_1892631_audit.ps1
    register: setupcontroleventlog
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setupcontroleventlog
      - 18.9.26.3.1
      - eighteen
      - remedy
      - all     

  - name: 18.9.26.3.1 - Transfering the setupcontroleventlog.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/setupcontroleventlog_1892631.pol
      dest: C:\facts\policyfiles\setupcontroleventlog_1892631.pol 
    when:
      - setupcontroleventlog.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setupcontroleventlog
      - 18.9.26.3.1
      - eighteen
      - remedy
      - all
  
  - name: 18.9.26.3.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\setupcontroleventlog_1892631.pol
    when:
      - setupcontroleventlog.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setupcontroleventlog
      - 18.9.26.3.1
      - eighteen
      - remedy
      - all
      
  - name: 18.9.26.3.2 - Fetching the setupmaxlogfilesize value from ansible facts
    win_shell: c:\facts\setupmaxlogfilesize_1892632_audit.ps1
    register: setupmaxlogfilesize
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setupmaxlogfilesize
      - 18.9.26.3.2
      - eighteen
      - remedy
      - all         
       
  - name: 18.9.26.3.2 - Transfering the setupmaxlogfilesize.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/setupmaxlogfilesize_1892632.pol
      dest: C:\facts\policyfiles\setupmaxlogfilesize_1892632.pol
    when:
      - setupmaxlogfilesize.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setupmaxlogfilesize
      - 18.9.26.3.2
      - eighteen
      - remedy
      - all
  
  - name: 18.9.26.3.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\setupmaxlogfilesize_1892632.pol
    when:
      - setupmaxlogfilesize.stdout.find("FAILED") != -1 
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setupmaxlogfilesize
      - 18.9.26.3.2
      - eighteen
      - remedy
      - all
      
  - name: 18.9.26.4.1 - Fetching the syscontroleventlog value from ansible facts
    win_shell: c:\facts\syscontroleventlog_1892641_audit.ps1
    register: syscontroleventlog
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - syscontroleventlog
      - 18.9.26.4.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.4.1 - Transfering the syscontroleventlog.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/syscontroleventlog_1892641.pol
      dest: C:\facts\policyfiles\syscontroleventlog_1892641.pol
    when:
      - syscontroleventlog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - syscontroleventlog
      - 18.9.26.4.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.4.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\syscontroleventlog_1892641.pol
    when:
      - syscontroleventlog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - syscontroleventlog
      - 18.9.26.4.1
      - eighteen
      - remedy
      - all

  - name: 18.9.26.4.2 - Fetching the sysmaxlogfilesize value from ansible facts
    win_shell: c:\facts\sysmaxlogfilesize_1892642_audit.ps1
    register: sysmaxlogfilesize
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sysmaxlogfilesize
      - 18.9.26.4.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.4.2 - Transfering the sysmaxlogfilesize.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/sysmaxlogfilesize_1892642.pol
      dest: C:\facts\policyfiles\sysmaxlogfilesize_1892642.pol
    when:
      - sysmaxlogfilesize.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sysmaxlogfilesize
      - 18.9.26.4.2
      - eighteen
      - remedy
      - all

  - name: 18.9.26.4.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\sysmaxlogfilesize_1892642.pol
    when:
      - sysmaxlogfilesize.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - sysmaxlogfilesize
      - 18.9.26.4.2
      - eighteen
      - remedy
      - all

  - name: 18.9.30.2 - Fetching the turnoffdataexec value from ansible facts
    win_shell: c:\facts\turnoffdataexec_189302_audit.ps1
    register: turnoffdataexec
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffdataexec
      - 18.9.30.2
      - eighteen
      - remedy
      - all

  - name: 18.9.30.2 - Transfering the turnoffdataexec.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffdataexec_189302.pol
      dest: C:\facts\policyfiles\turnoffdataexec_189302.pol
    when:
      - turnoffdataexec.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffdataexec
      - 18.9.30.2
      - eighteen
      - remedy
      - all

  - name: 18.9.30.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffdataexec_189302.pol
    when:
      - turnoffdataexec.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffdataexec
      - 18.9.30.2
      - eighteen
      - remedy
      - all

  - name: 18.9.30.3 - Fetching the turnoffheaptermination value from ansible facts
    win_shell: c:\facts\turnoffheaptermination_189303_audit.ps1
    register: turnoffheaptermination
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffheaptermination
      - 18.9.30.3
      - eighteen
      - remedy
      - all

  - name: 18.9.30.3 - Transfering the turnoffheaptermination.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffheaptermination_189303.pol
      dest: C:\facts\policyfiles\turnoffheaptermination_189303.pol
    when:
      - turnoffheaptermination.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffheaptermination
      - 18.9.30.3
      - eighteen
      - remedy
      - all

  - name: 18.9.30.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffheaptermination_189303.pol
    when:
      - turnoffheaptermination.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffheaptermination
      - 18.9.30.3
      - eighteen
      - remedy
      - all

  - name: 18.9.30.4 - Fetching the turnoffshellprotocol value from ansible facts
    win_shell: c:\facts\turnoffshellprotocol_189304_audit.ps1
    register: turnoffshellprotocol
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffshellprotocol
      - 18.9.30.4
      - eighteen
      - remedy
      - all

  - name: 18.9.30.4 - Transfering the turnoffshellprotocol.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffshellprotocol_189304.pol
      dest: C:\facts\policyfiles\turnoffshellprotocol_189304.pol
    when:
      - turnoffshellprotocol.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffshellprotocol
      - 18.9.30.4
      - eighteen
      - remedy
      - all

  - name: 18.9.30.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffshellprotocol_189304.pol
    when:
      - turnoffshellprotocol.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffshellprotocol
      - 18.9.30.4
      - eighteen
      - remedy
      - all

  - name: 18.9.39.1.1 - Fetching the offwinlocprovider value from ansible facts
    win_shell: c:\facts\offwinlocprovider_1893911_audit.ps1
    register: offwinlocprovider
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - offwinlocprovider
      - 18.9.39.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.39.1.1 - Transfering the offwinlocprovider.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/offwinlocprovider_1893911.pol
      dest: C:\facts\policyfiles\offwinlocprovider_1893911.pol
    when:
      - offwinlocprovider.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - offwinlocprovider
      - 18.9.39.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.39.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\offwinlocprovider_1893911.pol
    when:
      - offwinlocprovider.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - offwinlocprovider
      - 18.9.39.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.39.2 - Fetching the turnofflocation value from ansible facts
    win_shell: c:\facts\turnofflocation_189392_audit.ps1
    register: turnofflocation
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofflocation
      - 18.9.39.2
      - eighteen
      - remedy
      - all

  - name: 18.9.39.2 - Transfering the turnofflocation.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnofflocation_189392.pol
      dest: C:\facts\policyfiles\turnofflocation_189392.pol
    when:
      - turnofflocation.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofflocation
      - 18.9.39.2
      - eighteen
      - remedy
      - all

  - name: 18.9.39.2 - Importing the policy settings to group policy 
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnofflocation_189392.pol
    when:
      - turnofflocation.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnofflocation
      - 18.9.39.2
      - eighteen
      - remedy
      - all

  - name: 18.9.52.1 - Fetching the preventonedriveusage value from ansible fact    
    win_shell: c:\facts\preventonedriveusage_189521_audit.ps1
    register: preventonedriveusage
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventonedriveusage
      - 18.9.52.1
      - eighteen
      - remedy
      - all

  - name: 18.9.52.1 - Transfering the preventonedriveusage.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/preventonedriveusage_189521.pol
      dest: C:\facts\policyfiles\preventonedriveusage_189521.pol
    when:
      - preventonedriveusage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventonedriveusage
      - 18.9.52.1
      - eighteen
      - remedy
      - all

  - name: 18.9.52.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\preventonedriveusage_189521.pol
    when:
      - preventonedriveusage.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventonedriveusage
      - 18.9.52.1
      - eighteen
      - remedy
      - all

  - name: 18.9.52.2 - Fetching the preventonedrivewin81 value from ansible facts
    win_shell: c:\facts\preventonedrivewin81_189522_audit.ps1
    register: preventonedrivewin81
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventonedrivewin81
      - 18.9.52.2
      - eighteen
      - remedy
      - all
      
  - name: 18.9.52.2 - Transfering the preventonedrivewin81.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/preventonedrivewin81_189522.pol
      dest: C:\facts\policyfiles\preventonedrivewin81_189522.pol
    when:
      - preventonedrivewin81.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventonedrivewin81
      - 18.9.52.2
      - eighteen
      - remedy
      - all
      
  - name: 18.9.52.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\preventonedrivewin81_189522.pol
    when:
      - preventonedrivewin81.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventonedrivewin81
      - 18.9.52.2
      - eighteen
      - remedy
      - eighteenl

  - name: 18.9.59.2.2 - Fetching the dontallowpwdsaved value from ansible facts
    win_shell: c:\facts\dontallowpwdsaved_1895922_audit.ps1
    register: dontallowpwdsaved
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowpwdsaved
      - 18.9.59.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.2.2 - Transfering the dontallowpwdsaved.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontallowpwdsaved_1895922.pol
      dest: C:\facts\policyfiles\dontallowpwdsaved_1895922.pol
    when:
      - dontallowpwdsaved.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowpwdsaved
      - 18.9.59.2.2
      - eighteen
      - remedy
      - all
 
  - name: 18.9.59.2.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontallowpwdsaved_1895922.pol
    when:
      - dontallowpwdsaved.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowpwdsaved
      - 18.9.59.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.2.1 - Fetching the restrictremdesktopserv value from ansible facts
    win_shell: c:\facts\restrictremdesktopserv_18959321_audit.ps1
    register: restrictremdesktopserv
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restrictremdesktopserv
      - 18.9.59.3.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.2.1 - Transfering the restrictremdesktopserv.pol file 
    win_copy:
      src: ../files/group_policies/windows2012r2/restrictremdesktopserv_18959321.pol
      dest: C:\facts\policyfiles\restrictremdesktopserv_18959321.pol
    when:
      - restrictremdesktopserv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restrictremdesktopserv
      - 18.9.59.3.2.1
      - eighteen
      - remedy
      - all
  
  - name: 18.9.59.3.2.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\restrictremdesktopserv_18959321.pol
    when:
      - restrictremdesktopserv.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - restrictremdesktopserv
      - 18.9.59.3.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.1 (L2) - Fetching the dontallowcomport value from ansible facts
    win_shell: c:\facts\dontallowcomport_18959331_audit.ps1
    register: dontallowcomport
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowcomport
      - 18.9.59.3.3.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.1 - Transfering the dontallowcomport.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontallowcomport_18959331.pol
      dest: C:\facts\policyfiles\dontallowcomport_18959331.pol
    when:
      - dontallowcomport.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowcomport
      - 18.9.59.3.3.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontallowcomport_18959331.pol
    when:
      - dontallowcomport.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowcomport
      - 18.9.59.3.3.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.2 - Fetching the dontallowdrive value from ansible facts
    win_shell: c:\facts\dontallowdrive_18959332_audit.ps1
    register: dontallowdrive
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowdrive
      - 18.9.59.3.3.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.2 - Transfering the dontallowdrive.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontallowdrive_18959332.pol
      dest: C:\facts\policyfiles\dontallowdrive_18959332.pol
    when:
      - dontallowdrive.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowdrive
      - 18.9.59.3.3.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontallowdrive_18959332.pol
    when:
      - dontallowdrive.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowdrive
      - 18.9.59.3.3.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.3 - Fetching the dontallowlptport value from ansible facts
    win_shell: c:\facts\dontallowlptport_18959333_audit.ps1
    register: dontallowlptport
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowlptport
      - 18.9.59.3.3.3
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.3 - Transfering the dontallowlptport.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontallowlptport_18959333.pol
      dest: C:\facts\policyfiles\dontallowlptport_18959333.pol
    when:
      - dontallowlptport.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowlptport
      - 18.9.59.3.3.3
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontallowlptport_18959333.pol
    when:
      - dontallowlptport.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowlptport
      - 18.9.59.3.3.3
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.4  - Fetching the dontallowplugplaydev value from ansible facts
    win_shell: c:\facts\dontallowplugplaydev_18959334_audit.ps1
    register: dontallowplugplaydev
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowplugplaydev
      - 18.9.59.3.3.4
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.4 - Transfering the dontallowplugplaydev.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontallowplugplaydev_18959334.pol
      dest: C:\facts\policyfiles\dontallowplugplaydev_18959334.pol
    when:
      - dontallowplugplaydev.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowplugplaydev
      - 18.9.59.3.3.4
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.3.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontallowplugplaydev_18959334.pol
    when:
      - dontallowplugplaydev.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontallowplugplaydev
      - 18.9.59.3.3.4
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.1 - Fetching the pwdprompt value from ansible facts
    win_shell: c:\facts\pwdprompt_18959391_audit.ps1
    register: pwdprompt
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdprompt
      - 18.9.59.3.9.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.1 - Transfering the pwdprompt.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pwdprompt_18959391.pol
      dest: C:\facts\policyfiles\pwdprompt_18959391.pol
    when:
      - pwdprompt.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdprompt
      - 18.9.59.3.9.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pwdprompt_18959391.pol
    when:
      - pwdprompt.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pwdprompt
      - 18.9.59.3.9.1
      - eighteen
      - remedy
      - all
    
  - name: 18.9.59.3.9.2 - Fetching the securerpccommunic value from ansible facts
    win_shell: c:\facts\securerpccommunic_18959392_audit.ps1
    register: securerpccommunic    
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securerpccommunic
      - 18.9.59.3.9.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.2 - Transfering the securerpccommunic.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/securerpccommunic_18959392.pol
      dest: C:\facts\policyfiles\securerpccommunic_18959392.pol
    when:
      - securerpccommunic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securerpccommunic
      - 18.9.59.3.9.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\securerpccommunic_18959392.pol
    when:
      - securerpccommunic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - securerpccommunic
      - 18.9.59.3.9.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.3 - Fetching the enablerdpssl value from ansible facts
    win_shell: c:\facts\enablerdpssl_18959393_audit.ps1
    register: enablerdpssl
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablerdpssl
      - 18.9.59.3.9.3
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.3 - Transfering the enablerdpssl.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/enablerdpssl_18959393.pol
      dest: C:\facts\policyfiles\enablerdpssl_18959393.pol
    when:
      - enablerdpssl.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablerdpssl
      - 18.9.59.3.9.3
      - eighteen
      - remedy
      - all
 
  - name: 18.9.59.3.9.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\enablerdpssl_18959393.pol
    when:
      - enablerdpssl.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablerdpssl
      - 18.9.59.3.9.3
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.4 - Fetching the ennetlevelauth value from ansible facts
    win_shell: c:\facts\ennetlevelauth_18959394_audit.ps1
    register: ennetlevelauth
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ennetlevelauth
      - 18.9.59.3.9.4
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.4 - Transfering the ennetlevelauth.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/ennetlevelauth_18959394.pol
      dest: C:\facts\policyfiles\ennetlevelauth_18959394.pol
    when:
      - ennetlevelauth.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ennetlevelauth
      - 18.9.59.3.9.4
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\ennetlevelauth_18959394.pol
    when:
      - ennetlevelauth.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - ennetlevelauth
      - 18.9.59.3.9.4
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.5 - Fetching the setclientconn value from ansible facts
    win_shell: c:\facts\setclientconn_18959395_audit.ps1
    register: setclientconn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setclientconn
      - 18.9.59.3.9.5
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.5 - Transfering the setclientconn.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/setclientconn_18959395.pol
      dest: C:\facts\policyfiles\setclientconn_18959395.pol
    when:
      - setclientconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setclientconn
      - 18.9.59.3.9.5
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.9.5 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\setclientconn_18959395.pol
    when:
      - setclientconn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - setclientconn
      - 18.9.59.3.9.5
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.10.1 - Fetching the timelimitactive value from ansible facts
    win_shell: c:\facts\timelimitactive_189593101_audit.ps1
    register: timelimitactive
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - timelimitactive
      - 18.9.59.3.10.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.10.1 - Transfering the timelimitactive.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/timelimitactive_189593101.pol
      dest: C:\facts\policyfiles\timelimitactive_189593101.pol
    when:
      - timelimitactive.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - timelimitactive
      - 18.9.59.3.10.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.10.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\timelimitactive_189593101.pol
    when:
      - timelimitactive.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - timelimitactive
      - 18.9.59.3.10.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.10.2 - Fetching the timelimitdisconsession value from ansible facts
    win_shell: c:\facts\timelimitdisconsession_189593102_audit.ps1
    register: timelimitdisconsession
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - timelimitdisconsession
      - 18.9.59.3.10.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.10.2 - Transfering the timelimitdisconsession.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/timelimitdisconsession_189593102.pol
      dest: C:\facts\policyfiles\timelimitdisconsession_189593102.pol
    when:
      - timelimitdisconsession.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - timelimitdisconsession
      - 18.9.59.3.10.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.10.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\timelimitdisconsession_189593102.pol
    when:
      - timelimitdisconsession.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - timelimitdisconsession
      - 18.9.59.3.10.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.11.1 - Fetching the dontdeltempfolder value from ansible facts
    win_shell: c:\facts\dontdeltempfolder_189593111_audit.ps1
    register: dontdeltempfolder
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdeltempfolder
      - 18.9.59.3.11.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.11.1 - Transfering the dontdeltempfolder.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontdeltempfolder_189593111.pol
      dest: C:\facts\policyfiles\dontdeltempfolder_189593111.pol
    when:
      - dontdeltempfolder.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdeltempfolder
      - 18.9.59.3.11.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.11.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontdeltempfolder_189593111.pol
    when:
      - dontdeltempfolder.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontdeltempfolder
      - 18.9.59.3.11.1
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.11.2 - Fetching the dontusetempfolder value from ansible facts
    win_shell: c:\facts\dontusetempfolder_189593112_audit.ps1
    register: dontusetempfolder
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontusetempfolder
      - 18.9.59.3.11.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.11.2 - Transfering the dontusetempfolder.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/dontusetempfolder_189593112.pol
      dest: C:\facts\policyfiles\dontusetempfolder_189593112.pol
    when:
      - dontusetempfolder.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontusetempfolder
      - 18.9.59.3.11.2
      - eighteen
      - remedy
      - all

  - name: 18.9.59.3.11.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\dontusetempfolder_189593112.pol
    when:
      - dontusetempfolder.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - dontusetempfolder
      - 18.9.59.3.11.2
      - eighteen
      - remedy
      - all

  - name: 18.9.60.1 - Fetching the preventdownload value from ansible facts
    win_shell: c:\facts\preventdownload_189601_audit.ps1
    register: preventdownload
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventdownload
      - 18.9.60.1
      - eighteen
      - remedy
      - all

  - name: 18.9.60.1 - Transfering the preventdownload.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/preventdownload_189601.pol
      dest: C:\facts\policyfiles\preventdownload_189601.pol
    when:
      - preventdownload.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventdownload
      - 18.9.60.1
      - eighteen
      - remedy
      - all

  - name: 18.9.60.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\preventdownload_189601.pol
    when:
      - preventdownload.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - preventdownload
      - 18.9.60.1
      - eighteen
      - remedy
      - all

  - name: 18.9.61.2 - Fetching the allowindexencrypfile value from ansible facts
    win_shell: c:\facts\allowindexencrypfile_189612_audit.ps1
    register: allowindexencrypfile
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowindexencrypfile
      - 18.9.61.2
      - eighteen
      - remedy
      - all

  - name: 18.9.61.2 - Transfering the allowindexencrypfile.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowindexencrypfile_189612.pol
      dest: C:\facts\policyfiles\allowindexencrypfile_189612.pol
    when:
      - allowindexencrypfile.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowindexencrypfile
      - 18.9.61.2
      - eighteen
      - remedy
      - all

  - name: 18.9.61.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowindexencrypfile_189612.pol
    when:
      - allowindexencrypfile.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowindexencrypfile
      - 18.9.61.2
      - eighteen
      - remedy
      - all

  - name: 18.9.61.3 - Fetching the setsharedinfo value from ansible facts
    win_shell: c:\facts\setsharedinfo_189613_audit.ps1
    register: setsharedinfo
    ignore_errors: True
    tags:
      - setsharedinfo
      - 18.9.61.3
      - eighteen
      - remedy
      - all

  - name: 18.9.61.3 - Transfering the setsharedinfo.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/setsharedinfo_189613.pol
      dest: C:\facts\policyfiles\setsharedinfo_189613.pol
    when: setsharedinfo.stdout.find("FAILED") != -1
    tags:
      - setsharedinfo
      - 18.9.61.3
      - eighteen
      - remedy
      - all	  

  - name: 18.9.61.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\setsharedinfo_189613.pol
    when: setsharedinfo.stdout.find("FAILED") != -1
    tags:
      - setsharedinfo
      - 18.9.61.3
      - eighteen
      - remedy
      - all
      
  - name: 18.9.66.1 - Fetching the turnoffkmsclionline value from ansible facts
    win_shell: c:\facts\turnoffkmsclionline_189661_audit.ps1
    register: turnoffkmsclionline
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffkmsclionline
      - 18.9.66.1
      - eighteen
      - remedy
      - all

  - name: 18.9.66.1 - Transfering the turnoffkmsclionline.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffkmsclionline_189661.pol
      dest: C:\facts\policyfiles\turnoffkmsclionline_189661.pol
    when:
      - turnoffkmsclionline.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffkmsclionline
      - 18.9.66.1
      - eighteen
      - remedy
      - all

  - name: 18.9.66.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffkmsclionline_189661.pol
    when:
      - turnoffkmsclionline.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffkmsclionline
      - 18.9.66.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.3.1 - Fetching the confmsmaps value from ansible facts
    win_shell: c:\facts\confmsmaps_1897731_audit.ps1
    register: confmsmaps
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confmsmaps
      - 18.9.77.3.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.3.1 - Transfering the confmsmaps.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confmsmaps_1897731.pol
      dest: C:\facts\policyfiles\confmsmaps_1897731.pol
    when:
      - confmsmaps.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confmsmaps
      - 18.9.77.3.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.3.1 - Importing the policy settings to group policy 
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confmsmaps_1897731.pol
    when:
      - confmsmaps.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confmsmaps
      - 18.9.77.3.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.3.2 - Fetching the joinmsmaps value from ansible facts
    win_shell: c:\facts\joinmsmaps_1897732_audit.ps1
    register: joinmsmaps
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - joinmsmaps
      - 18.9.77.3.2
      - eighteen
      - remedy
      - all

  - name: 18.9.77.3.2 - Transfering the joinmsmaps.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/joinmsmaps_1897732.pol
      dest: C:\facts\policyfiles\joinmsmaps_1897732.pol
    when:
      - joinmsmaps.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - joinmsmaps
      - 18.9.77.3.2
      - eighteen
      - remedy
      - all

  - name: 18.9.77.3.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\joinmsmaps_1897732.pol
    when:
      - joinmsmaps.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - joinmsmaps
      - 18.9.77.3.2
      - eighteen
      - remedy
      - all

  - name: 18.9.77.7.1 - Fetching the turnonmonitoring value from ansible facts
    win_shell: c:\facts\turnonmonitoring_1897771_audit.ps1
    register: turnonmonitoring
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnonmonitoring
      - 18.9.77.7.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.7.1 - Transfering the turnonmonitoring.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnonmonitoring_1897771.pol
      dest: C:\facts\policyfiles\turnonmonitoring_1897771.pol
    when:
      - turnonmonitoring.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnonmonitoring
      - 18.9.77.7.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.7.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnonmonitoring_1897771.pol
    when:
      - turnonmonitoring.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnonmonitoring
      - 18.9.77.7.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.9.1 - Fetching the confwatsonevents value from ansible facts
    win_shell: c:\facts\confwatsonevents_1897791_audit.ps1
    register: confwatsonevents
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwatsonevents
      - 18.9.77.9.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.9.1 - Transfering the confwatsonevents.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confwatsonevents_1897791.pol
      dest: C:\facts\policyfiles\confwatsonevents_1897791.pol
    when:
      - confwatsonevents.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwatsonevents
      - 18.9.77.9.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.9.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confwatsonevents_1897791.pol
    when:
      - confwatsonevents.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwatsonevents
      - 18.9.77.9.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.10.1 - Fetching the scanremovabledriver value from ansible facts
    win_shell: c:\facts\scanremovabledriver_18977101_audit.ps1
    register: scanremovabledriver
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - scanremovabledriver
      - 18.9.77.10.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.10.1 - Transfering the scanremovabledriver.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/scanremovabledriver_18977101.pol
      dest: C:\facts\policyfiles\scanremovabledriver_18977101.pol
    when:
      - scanremovabledriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - scanremovabledriver
      - 18.9.77.10.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.10.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\scanremovabledriver_18977101.pol
    when:
      - scanremovabledriver.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - scanremovabledriver
      - 18.9.77.10.1
      - eighteen
      - remedy
      - all

  - name: 18.9.77.10.2 - Fetching the turnonemailscan value from ansible facts
    win_shell: c:\facts\turnonemailscan_18977102_audit.ps1
    register: turnonemailscan
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnonemailscan
      - 18.9.77.10.2
      - eighteen
      - remedy
      - all

  - name: 18.9.77.10.2 - Transfering the turnonemailscan.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnonemailscan_18977102.pol
      dest: C:\facts\policyfiles\turnonemailscan_18977102.pol
    when:
      - turnonemailscan.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnonemailscan
      - 18.9.77.10.2
      - eighteen
      - remedy
      - all

  - name: 18.9.77.10.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnonemailscan_18977102.pol
    when:
      - turnonemailscan.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnonemailscan
      - 18.9.77.10.2
      - eighteen
      - remedy
      - all

  - name: 18.9.77.14 - Fetching the turnoffwindefenderantivirus value from ansible facts
    win_shell: c:\facts\turnoffwindefenderantivirus_1897714_audit.ps1
    register: turnoffwindefenderantivirus
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwindefenderantivirus
      - 18.9.77.14
      - eighteen
      - remedy
      - all

  - name: 18.9.77.14 - Transfering the turnoffwindefenderantivirus.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/turnoffwindefenderantivirus_1897714.pol
      dest: C:\facts\policyfiles\turnoffwindefenderantivirus_1897714.pol
    when:
      - turnoffwindefenderantivirus.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwindefenderantivirus
      - 18.9.77.14
      - eighteen
      - remedy
      - all

  - name: 18.9.77.14 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\turnoffwindefenderantivirus_1897714.pol
    when:
      - turnoffwindefenderantivirus.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - turnoffwindefenderantivirus
      - 18.9.77.14
      - eighteen
      - remedy
      - all

  - name: 18.9.80.1.1 - Fetching the confwindefendsmartscreen value from ansible facts
    win_shell: c:\facts\confwindefendsmartscreen_1898011_audit.ps1
    register: confwindefendsmartscreen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwindefendsmartscreen
      - 18.9.80.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.80.1.1 - Transfering the confwindefendsmartscreen.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confwindefendsmartscreen_1898011.pol
      dest: C:\facts\policyfiles\confwindefendsmartscreen_1898011.pol
    when:
      - confwindefendsmartscreen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwindefendsmartscreen
      - 18.9.80.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.80.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confwindefendsmartscreen_1898011.pol
    when:
      - confwindefendsmartscreen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confwindefendsmartscreen
      - 18.9.80.1.1
      - eighteen
      - remedy
      - all
  
  - name: 18.9.81.2.1 - Fetching the confdefaultconsent value from ansible facts
    win_shell: c:\facts\confdefaultconsent_1898121_audit.ps1
    register: confdefaultconsent
    ignore_errors: True
    tags:
      - confdefaultconsent
      - 18.9.81.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.81.2.1 - Transfering the confdefaultconsent.pol file
    win_copy:
      src: ../files/group_policies/windows2012nonr2/confdefaultconsent_1898121.pol
      dest: C:\facts\policyfiles\confdefaultconsent_1898121.pol
    when: confdefaultconsent.stdout.find("FAILED") != -1
    tags:
      - confdefaultconsent
      - 18.9.81.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.81.2.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confdefaultconsent_1898121.pol
    when: confdefaultconsent.stdout.find("FAILED") != -1
    tags:
      - confdefaultconsent
      - 18.9.81.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.81.3 - Fetching the disabmemdumprep value from ansible facts
    win_shell: c:\facts\disabmemdumprep_189813_audit.ps1
    register: disabmemdumprep
    ignore_errors: True
    tags:
      - disabmemdumprep
      - 18.9.81.3
      - eighteen
      - remedy
      - all

  - name: 18.9.81.3 - Transfering the disabmemdumprep.pol file
    win_copy:
      src: ../files/group_policies/windows2012nonr2/disabmemdumprep_189813.pol
      dest: C:\facts\policyfiles\disabmemdumprep_189813.pol
    when: disabmemdumprep.stdout.find("FAILED") != -1
    tags:
      - disabmemdumprep
      - 18.9.81.3
      - eighteen
      - remedy
      - all

  - name: 18.9.81.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\disabmemdumprep_189813.pol
    when: disabmemdumprep.stdout.find("FAILED") != -1
    tags:
      - disabmemdumprep
      - 18.9.81.3
      - eighteen
      - remedy
      - all  

  - name: 18.9.85.1 - Fetching the allowusrcontrol value from ansible facts
    win_shell: c:\facts\allowusrcontrol_189851_audit.ps1
    register: allowusrcontrol
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - remedy
      - allowusrcontrol
      - 18.9.85.1
      - eighteen
      - all

  - name: 18.9.85.1 - Transfering the allowusrcontrol.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowusrcontrol_189851.pol
      dest: C:\facts\policyfiles\allowusrcontrol_189851.pol
    when:
      - allowusrcontrol.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowusrcontrol
      - 18.9.85.1
      - eighteen
      - remedy
      - all

  - name: 18.9.85.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowusrcontrol_189851.pol
    when:
      - allowusrcontrol.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowusrcontrol
      - 18.9.85.1
      - eighteen
      - remedy
      - all

  - name: 18.9.85.2 - Fetching the elevatedprivil value from ansible facts
    win_shell: c:\facts\elevatedprivil_189852_audit.ps1
    register: elevatedprivil
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevatedprivil
      - 18.9.85.2
      - eighteen
      - remedy
      - all

  - name: 18.9.85.2 - Transfering the elevatedprivil.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/elevatedprivil_189852.pol
      dest: C:\facts\policyfiles\elevatedprivil_189852.pol
    when:
      - elevatedprivil.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevatedprivil
      - 18.9.85.2
      - eighteen
      - remedy
      - all

  - name: 18.9.85.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\elevatedprivil_189852.pol
    when:
      - elevatedprivil.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - elevatedprivil
      - 18.9.85.2
      - eighteen
      - remedy
      - all

  - name: 18.9.85.3 - Fetching the previesecurprompt value from ansible facts
    win_shell: c:\facts\previesecurprompt_189853_audit.ps1
    register: previesecurprompt
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - previesecurprompt
      - 18.9.85.3
      - eighteen
      - remedy
      - all

  - name: 18.9.85.3 - Transfering the previesecurprompt.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/previesecurprompt_189853.pol
      dest: C:\facts\policyfiles\previesecurprompt_189853.pol
    when:
      - previesecurprompt.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - previesecurprompt
      - 18.9.85.3
      - eighteen
      - remedy
      - all

  - name: 18.9.85.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\previesecurprompt_189853.pol
    when:
      - previesecurprompt.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - previesecurprompt
      - 18.9.85.3
      - eighteen
      - remedy
      - all

  - name: 18.9.86.1 - Fetching the signinlastinteractiveusr value from ansible facts
    win_shell: c:\facts\signinlastinteractiveusr_189861_audit.ps1
    register: signinlastinteractiveusr
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - signinlastinteractiveusr
      - 18.9.86.1
      - eighteen
      - remedy
      - all

  - name: 18.9.86.1 - Transfering the signinlastinteractiveusr.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/signinlastinteractiveusr_189861.pol
      dest: C:\facts\policyfiles\signinlastinteractiveusr_189861.pol
    when:
      - signinlastinteractiveusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - signinlastinteractiveusr
      - 18.9.86.1
      - eighteen
      - remedy
      - all

  - name: 18.9.86.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\signinlastinteractiveusr_189861.pol
    when:
      - signinlastinteractiveusr.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - signinlastinteractiveusr
      - 18.9.86.1
      - eighteen
      - remedy
      - all

  - name: 18.9.95.1 - Fetching the pshellscriptblocklog value from ansible facts
    win_shell: c:\facts\pshellscriptblocklog_189951_audit.ps1
    register: pshellscriptblocklog
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pshellscriptblocklog
      - 18.9.95.1
      - eighteen
      - remedy
      - all

  - name: 18.9.95.1 - Transfering the pshellscriptblocklog.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pshellscriptblocklog_189951.pol
      dest: C:\facts\policyfiles\pshellscriptblocklog_189951.pol
    when:
      - pshellscriptblocklog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pshellscriptblocklog
      - 18.9.95.1
      - eighteen
      - remedy
      - all

  - name: 18.9.95.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pshellscriptblocklog_189951.pol
    when:
      - pshellscriptblocklog.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pshellscriptblocklog
      - 18.9.95.1
      - eighteen
      - remedy
      - all

  - name: 18.9.95.2 - Fetching the pshelltranscription value from ansible facts
    win_shell: c:\facts\pshelltranscription_189952_audit.ps1
    register: pshelltranscription
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pshelltranscription
      - 18.9.95.2
      - eighteen
      - remedy
      - all

  - name: 18.9.95.2 - Transfering the pshelltranscription.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/pshellscriptblocklog_189951.pol
      dest: C:\facts\policyfiles\pshelltranscription_189952.pol
    when:
      - pshelltranscription.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pshelltranscription
      - 18.9.95.2
      - eighteen
      - remedy
      - all

  - name: 18.9.95.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\pshellscriptblocklog_189951.pol
    when:
      - pshelltranscription.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - pshelltranscription
      - 18.9.95.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.1 - Fetching the allowbasicauthen value from ansible facts
    win_shell: c:\facts\allowbasicauthen_1899711_audit.ps1
    register: allowbasicauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowbasicauthen
      - 18.9.97.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.1 - Transfering the allowbasicauthen.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowbasicauthen_1899711.pol
      dest: C:\facts\policyfiles\allowbasicauthen_1899711.pol
    when:
      - allowbasicauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowbasicauthen
      - 18.9.97.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowbasicauthen_1899711.pol
    when:
      - allowbasicauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowbasicauthen
      - 18.9.97.1.1
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.2 - Fetching the allowunencryptraffic value from ansible facts
    win_shell: c:\facts\allowunencryptraffic_1899712_audit.ps1
    register: allowunencryptraffic
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowunencryptraffic
      - 18.9.97.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.2 - Transfering the allowunencryptraffic.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowunencryptraffic_1899712.pol
      dest: C:\facts\policyfiles\allowunencryptraffic_1899712.pol
    when:
      - allowunencryptraffic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowunencryptraffic
      - 18.9.97.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowunencryptraffic_1899712.pol
    when:
      - allowunencryptraffic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowunencryptraffic
      - 18.9.97.1.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.3 - Fetching the disallowdigestauthen value from ansible facts
    win_shell: c:\facts\disallowdigestauthen_1899713_audit.ps1
    register: disallowdigestauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowdigestauthen
      - 18.9.97.1.3
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.3 - Transfering the disallowdigestauthen.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/disallowdigestauthen_1899713.pol
      dest: C:\facts\policyfiles\disallowdigestauthen_1899713.pol
    when:
      - disallowdigestauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowdigestauthen
      - 18.9.97.1.3
      - eighteen
      - remedy
      - all

  - name: 18.9.97.1.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\disallowdigestauthen_1899713.pol
    when:
      - disallowdigestauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowdigestauthen
      - 18.9.97.1.3
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.1 - Fetching the winrmallowbasicauthen value from ansible facts
    win_shell: c:\facts\winrmallowbasicauthen_1899721_audit.ps1
    register: winrmallowbasicauthen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winrmallowbasicauthen
      - 18.9.97.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.1 - Transfering the winrmallowbasicauthen.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/winrmallowbasicauthen_1899721.pol
      dest: C:\facts\policyfiles\winrmallowbasicauthen_1899721.pol
    when:
      - winrmallowbasicauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winrmallowbasicauthen
      - 18.9.97.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\winrmallowbasicauthen_1899721.pol
    when:
      - winrmallowbasicauthen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winrmallowbasicauthen
      - 18.9.97.2.1
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.2 - Fetching the allowremoteservmanagment value from ansible facts
    win_shell: c:\facts\allowremoteservmanagment_1899722_audit.ps1
    register: allowremoteservmanagment
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremoteservmanagment
      - 18.9.97.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.2 - Transfering the allowremoteservmanagment.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowremoteservmanagment_1899722.pol
      dest: C:\facts\policyfiles\allowremoteservmanagment_1899722.pol
    when:
      - allowremoteservmanagment.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremoteservmanagment
      - 18.9.97.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowremoteservmanagment_1899722.pol
    when:
      - allowremoteservmanagment.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremoteservmanagment
      - 18.9.97.2.2
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.3 - Fetching the winrmallowencryptraffic value from ansible facts
    win_shell: c:\facts\winrmallowencryptraffic_1899723_audit.ps1
    register: winrmallowencryptraffic
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winrmallowencryptraffic
      - 18.9.97.2.3
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.3 - Transfering the winrmallowencryptraffic.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/winrmallowencryptraffic_1899723.pol
      dest: C:\facts\policyfiles\winrmallowencryptraffic_1899723.pol
    when:
      - winrmallowencryptraffic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winrmallowencryptraffic
      - 18.9.97.2.3
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\winrmallowencryptraffic_1899723.pol
    when:
      - winrmallowencryptraffic.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - winrmallowencryptraffic
      - 18.9.97.2.3
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.4 - Fetching the disallowwinrm value from ansible facts
    win_shell: c:\facts\disallowwinrm_1899724_audit.ps1
    register: disallowwinrm
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowwinrm
      - 18.9.97.2.4
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.4 - Transfering the disallowwinrm.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/disallowwinrm_1899724.pol
      dest: C:\facts\policyfiles\disallowwinrm_1899724.pol
    when:
      - disallowwinrm.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowwinrm
      - 18.9.97.2.4
      - eighteen
      - remedy
      - all

  - name: 18.9.97.2.4 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\disallowwinrm_1899724.pol
    when:
      - disallowwinrm.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - disallowwinrm
      - 18.9.97.2.4
      - eighteen
      - remedy
      - all

  - name: 18.9.98.1 - Fetching the allowremoteshellaccess value from ansible facts
    win_shell: c:\facts\allowremoteshellaccess_189981_audit.ps1
    register: allowremoteshellaccess
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremoteshellaccess
      - 18.9.98.1
      - eighteen
      - remedy
      - all

  - name: 18.9.98.1 - Transfering the allowremoteshellaccess.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/allowremoteshellaccess_189981.pol
      dest: C:\facts\policyfiles\allowremoteshellaccess_189981.pol
    when:
      - allowremoteshellaccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremoteshellaccess
      - 18.9.98.1
      - eighteen
      - remedy
      - all

  - name: 18.9.98.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\allowremoteshellaccess_189981.pol
    when:
      - allowremoteshellaccess.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - allowremoteshellaccess
      - 18.9.98.1
      - eighteen
      - remedy
      - all

  - name: 18.9.102.1 - Fetching the confautoupdates value from ansible facts
    win_shell: c:\facts\confautoupdates_1891021_audit.ps1
    register: confautoupdates
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confautoupdates
      - 18.9.102.1
      - eighteen
      - remedy
      - all

  - name: 18.9.102.1 - Transfering the confautoupdates.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confautoupdates_1891021.pol
      dest: C:\facts\policyfiles\confautoupdates_1891021.pol
    when:
      - confautoupdates.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confautoupdates
      - 18.9.102.1
      - eighteen
      - remedy
      - all

  - name: 18.9.102.1 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confautoupdates_1891021.pol
    when:
      - confautoupdates.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confautoupdates
      - 18.9.102.1
      - eighteen
      - remedy
      - all

  - name: 18.9.102.2 - Fetching the confautoupdatesday value from ansible facts
    win_shell: c:\facts\confautoupdatesday_1891022_audit.ps1
    register: confautoupdatesday
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confautoupdatesday
      - 18.9.102.2
      - eighteen
      - remedy
      - all

  - name: 18.9.102.2 - Transfering the confautoupdates.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/confautoupdatesday_1891022.pol
      dest: C:\facts\policyfiles\confautoupdatesday_1891022.pol
    when:
      - confautoupdatesday.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confautoupdatesday
      - 18.9.102.2
      - eighteen
      - remedy
      - all

  - name: 18.9.102.2 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\confautoupdatesday_1891022.pol
    when:
      - confautoupdatesday.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - confautoupdatesday
      - 18.9.102.2
      - eighteen
      - remedy
      - all

  - name: 18.9.102.3 - Fetching the noautorestart value from ansible facts
    win_shell: c:\facts\noautorestart_1891023_audit.ps1
    register: noautorestart
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - noautorestart
      - 18.9.102.3
      - eighteen
      - remedy
      - all

  - name: 18.9.102.3 - Transfering the noautorestart.pol file
    win_copy:
      src: ../files/group_policies/windows2012r2/noautorestart_1891023.pol
      dest: C:\facts\policyfiles\noautorestart_1891023.pol
    when:
      - noautorestart.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - noautorestart
      - 18.9.102.3
      - eighteen
      - remedy
      - all

  - name: 18.9.102.3 - Importing the policy settings to group policy
    win_shell: C:\facts\Lgpo\LGPO.exe /m C:\facts\policyfiles\noautorestart_1891023.pol 
    when:
      - noautorestart.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - noautorestart
      - 18.9.102.3
      - eighteen
      - remedy
      - all

  - name: 19.1.3.1 - Fetching the enablescrnsav value from ansible facts
    win_shell: c:\facts\enablescrnsav_19131_audit.ps1
    register: enablescrnsav
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablescrnsav
      - nineteen
      - 19.1.3.1
      - all
      - remedy

  - name: 19.1.3.1 - copying enablescrnsav.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/enablescrnsav_19131.txt
      dest: c:\facts\policyfiles\enablescrnsav_19131.txt
    when:
      - enablescrnsav.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablescrnsav
      - nineteen
      - 19.1.3.1
      - all
      - remedy

  - name: 19.1.3.1 - importing enablescrnsav.txt 
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\enablescrnsav_19131.txt
    when:
      - enablescrnsav.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - enablescrnsav
      - nineteen
      - 19.1.3.1
      - all
      - remedy

  - name: 19.1.3.2 - Fetching the forspecscrnsav value from ansible facts
    win_shell: c:\facts\forspecscrnsav_19132_audit.ps1
    register: forspecscrnsav
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forspecscrnsav
      - nineteen
      - 19.1.3.2
      - all
      - remedy

  - name: 19.1.3.2 - copying forspecscrnsav.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/forspecscrnsav_19132.txt
      dest: c:\facts\policyfiles\forspecscrnsav_19132.txt
    when:
      - forspecscrnsav.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forspecscrnsav
      - nineteen
      - 19.1.3.2
      - all
      - remedy

  - name: 19.1.3.2 - importing forspecscrnsav..txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\forspecscrnsav_19132.txt
    when:
      - forspecscrnsav.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - forspecscrnsav
      - nineteen
      - 19.1.3.2
      - all
      - remedy

  - name: 19.1.3.3 - Fetching the passproscrnsav value from ansible facts
    win_shell: c:\facts\passproscrnsav_19133_audit.ps1
    register: passproscrnsav
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - passproscrnsav
      - nineteen
      - 19.1.3.3
      - all
      - remedy

  - name: 19.1.3.3 - copying passproscrnsav.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/passproscrnsav_19133.txt
      dest: c:\facts\policyfiles\passproscrnsav_19133.txt
    when:
      - passproscrnsav.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - passproscrnsav
      - nineteen
      - 19.1.3.3
      - all
      - remedy

  - name: 19.1.3.3 - inporting passproscrnsav.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\passproscrnsav_19133.txt
    when:
      - passproscrnsav.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - passproscrnsav
      - nineteen
      - 19.1.3.3
      - all
      - remedy

  - name: 19.1.3.4 - Fetching the scrnsavtimeout value from ansible facts
    win_shell: c:\facts\scrnsavtimeout_19134_audit.ps1
    register: scrnsavtimeout
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - scrnsavtimeout
      - nineteen
      - 19.1.3.4
      - all
      - remedy

  - name: 19.1.3.4 - copying scrnsavtimeout.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/scrnsavtimeout_19134.txt
      dest: c:\facts\policyfiles\scrnsavtimeout_19134.txt
    when:
      - scrnsavtimeout.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - scrnsavtimeout
      - nineteen
      - 19.1.3.4
      - all
      - remedy

  - name: 19.1.3.4 - importing scrnsavtimeout.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\scrnsavtimeout_19134.txt
    when:
      - scrnsavtimeout.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - scrnsavtimeout
      - nineteen
      - all
      - 19.1.3.4
      - remedy

  - name: 19.5.1.1 - Fetching the toastnotiflockscrn value from ansible facts
    win_shell: c:\facts\toastnotiflockscrn_19511_audit.ps1
    register: toastnotiflockscrn
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - toastnotiflockscrn
      - nineteen
      - 19.5.1.1
      - all
      - remedy

  - name: 19.5.1.1 - copying toastnotiflockscrn.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/toastnotiflockscrn_19511.txt
      dest: c:\facts\policyfiles\toastnotiflockscrn_19511.txt
    when:
      - toastnotiflockscrn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - toastnotiflockscrn
      - nineteen
      - 19.5.1.1
      - all
      - remedy

  - name: 19.5.1.1 - importing toastnotiflockscrn.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\toastnotiflockscrn_19511.txt
    when:
      - toastnotiflockscrn.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - toastnotiflockscrn
      - nineteen
      - 19.5.1.1
      - all
      - remedy

  - name: 19.6.6.1.1 - Fetching the helpexpimprogram value from ansible facts
    win_shell: c:\facts\helpexpimprogram_196611_audit.ps1
    register: helpexpimprogram
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - helpexpimprogram
      - nineteen
      - 19.6.6.1.1
      - all
      - remedy

  - name: 19.6.6.1.1 - copying helpexpimprogram.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/helpexpimprogram_196611.txt
      dest: c:\facts\policyfiles\helpexpimprogram_196611.txt
    when:
      - helpexpimprogram.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - helpexpimprogram
      - nineteen
      - 19.6.6.1.1
      - all
      - remedy

  - name: 19.6.6.1.1 - importing helpexpimprogram.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\helpexpimprogram_196611.txt
    when:
      - helpexpimprogram.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - helpexpimprogram
      - nineteen
      - 19.6.6.1.1
      - all
      - remedy

  - name: 19.7.4.1 - Fetching the prezoneinfile value from ansible facts
    win_shell: c:\facts\prezoneinfile_19741_audit.ps1
    register: prezoneinfile
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prezoneinfile
      - nineteen
      - 19.7.4.1
      - all
      - remedy

  - name: 19.7.4.1 - copying prezoneinfile.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/prezoneinfile_19741.txt
      dest: c:\facts\policyfiles\prezoneinfile_19741.txt
    when:
      - prezoneinfile.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prezoneinfile
      - nineteen
      - 19.7.4.1
      - all
      - remedy

  - name: 19.7.4.1 - importing prezoneinfile.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\prezoneinfile_19741.txt
    when:
      - prezoneinfile.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prezoneinfile
      - nineteen
      - 19.7.4.1
      - all
      - remedy

  - name: 19.7.4.2 - Fetching the notifyantiprogramopen value from ansible facts
    win_shell: c:\facts\notifyantiprogramopen_19742_audit.ps1
    register: notifyantiprogramopen
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - notifyantiprogramopen
      - nineteen
      - 19.7.4.2
      - all
      - remedy

  - name: 19.7.4.2 - copying notifyantiprogramopen.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/notifyantiprogramopen_19742.txt
      dest: c:\facts\policyfiles\notifyantiprogramopen_19742.txt
    when:
      - notifyantiprogramopen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - notifyantiprogramopen
      - nineteen
      - 19.7.4.2
      - all
      - remedy

  - name: 19.7.4.2 - importing notifyantiprogramopen.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\notifyantiprogramopen_19742.txt
    when:
      - notifyantiprogramopen.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - notifyantiprogramopen
      - nineteen
      - 19.7.4.2
      - all
      - remedy

  - name: 19.7.26.1 - Fetching the prevusersharprof value from ansible facts
    win_shell: c:\facts\prevusersharprof_197261_audit.ps1
    register: prevusersharprof
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prevusersharprof
      - nineteen
      - 19.7.26.1
      - all
      - remedy

  - name: 19.7.26.1 - copying prevusersharprof.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/prevusersharprof_197261.txt
      dest: c:\facts\policyfiles\prevusersharprof_197261.txt
    when:
      - prevusersharprof.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prevusersharprof
      - nineteen
      - 19.7.26.1
      - all
      - remedy

  - name: 19.7.26.1 - running prevusersharprof.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\prevusersharprof_197261.txt
    when:
      - prevusersharprof.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prevusersharprof
      - nineteen
      - 19.7.26.1
      - all
      - remedy

  - name: 19.7.41.1 - Fetching the installelevprivileg value from ansible facts
    win_shell: c:\facts\installelevprivileg_197411_audit.ps1
    register: installelevprivileg
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - installelevprivileg
      - nineteen
      - 19.7.41.1
      - all
      - remedy

  - name: 19.7.41.1 - copying installelevprivileg.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/installelevprivileg_197411.txt
      dest: c:\facts\policyfiles\installelevprivileg_197411.txt
    when:
      - installelevprivileg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - installelevprivileg
      - nineteen
      - 19.7.41.1
      - all
      - remedy

  - name: 19.7.41.1 - importing installelevprivileg.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\installelevprivileg_197411.txt
    when:
      - installelevprivileg.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - installelevprivileg
      - nineteen
      - 19.7.41.1
      - all
      - remedy

  - name: 19.7.45.2.1 - Fetching the prevcodecdown value from ansible facts
    win_shell: c:\facts\prevcodecdown_1974521_audit.ps1
    register: prevcodecdown
    ignore_errors: True
    when:
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prevcodecdown
      - nineteen
      - 19.7.45.2.1
      - all
      - remedy

  - name: 19.7.45.2.1 - copying prevcodecdown.txt
    win_copy:
      src: ../files/group_policies/windows2012r2/prevcodecdown_1974521.txt
      dest: c:\facts\policyfiles\prevcodecdown_1974521.txt
    when:
      - prevcodecdown.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prevcodecdown
      - nineteen
      - 19.7.45.2.1
      - all
      - remedy

  - name: 19.7.45.2.1 - importing prevcodecdown.txt
    win_shell: C:\facts\Lgpo\LGPO.exe /t C:\facts\policyfiles\prevcodecdown_1974521.txt
    when:
      - prevcodecdown.stdout.find("FAILED") != -1
      - (server_type.stdout_lines[1] | regex_search('5')) == '5' or (server_type.stdout_lines[1] | regex_search('3')) == '3' or (server_type.stdout_lines[1] | regex_search('2')) == '2'
    tags:
      - prevcodecdown
      - nineteen
      - 19.7.45.2.1
      - all
      - remedy
   
  - name: Include Database
    include: tasks/after_windows.yml   

